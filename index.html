<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="my personal blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Tim Ho&#39;s Technology Blog">
<meta property="og:url" content="https://github.com/hewentian/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="my personal blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tim Ho&#39;s Technology Blog">
<meta name="twitter:description" content="my personal blog">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-solr-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/29/solr-note/" class="article-date">
  <time datetime="2017-10-29T04:12:26.000Z" itemprop="datePublished">2017-10-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/solr/">solr</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/29/solr-note/">solr学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="HttpSolrClient"><a href="#HttpSolrClient" class="headerlink" title="HttpSolrClient"></a>HttpSolrClient</h3><p>HttpSolrClient 使用 HTTPClient 和 solr 服务器进行通信。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</div><div class="line"></div><div class="line">String baseSolrUrl = <span class="string">"http://localhost:8983/solr/"</span>;</div><div class="line"></div><div class="line">HttpSolrClient solrClient = <span class="keyword">new</span> HttpSolrClient.Builder().withBaseSolrUrl(baseSolrUrl).build();</div><div class="line">solrClient.setConnectionTimeout(<span class="number">1000</span>);</div><div class="line">solrClient.setDefaultMaxConnectionsPerHost(<span class="number">100</span>);</div><div class="line">solrClient.setMaxTotalConnections(<span class="number">100</span>);</div></pre></td></tr></table></figure></p>
<p>HttpSolrClient 是线程安全的，建议重复使用 HttpSolrClient 实例。</p>
<h3 id="EmbeddedSolrServer"><a href="#EmbeddedSolrServer" class="headerlink" title="EmbeddedSolrServer"></a>EmbeddedSolrServer</h3><p>EmbeddedSolrServer 提供和 HttpSolrClient 相同的接口，它不需要http连接。如果，你使用的是一个本地的 solrServer 的话，这是一个不错的选择。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.embedded.EmbeddedSolrServer;</div><div class="line"><span class="keyword">import</span> org.apache.solr.core.CoreContainer;</div><div class="line"></div><div class="line">System.setProperty(<span class="string">"solr.solr.home"</span>, <span class="string">"E:\\solr-6.5.0\\server\\solr"</span>);</div><div class="line">		</div><div class="line">CoreContainer coreContainer = <span class="keyword">new</span> CoreContainer(<span class="string">"E:\\solr-6.5.0\\server\\solr"</span>);</div><div class="line">coreContainer.load(); <span class="comment">// don't forge to invoke this method since solr 4.4.0</span></div><div class="line">		</div><div class="line">EmbeddedSolrServer embeddedSolrServer = <span class="keyword">new</span> EmbeddedSolrServer(coreContainer, coreName);</div></pre></td></tr></table></figure></p>
<p>通过 POJO 方式往 Solr 中添加 doc 时，要使用 注解<code>@org.apache.solr.client.solrj.beans.Field</code>，@Field 可以被用在域上，或者是setter方法上。如果一个域的名称跟bean的名称是不一样的，那么在java注释中填写别名，具体的，可以参照下面的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</div><div class="line">	<span class="comment">/** 用户id */</span></div><div class="line">	<span class="meta">@Field</span></div><div class="line">	<span class="keyword">private</span> String id;</div><div class="line"></div><div class="line">	<span class="comment">/** 名字 */</span></div><div class="line">	<span class="meta">@Field</span></div><div class="line">	<span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">	<span class="comment">/** 年龄 */</span></div><div class="line">	<span class="meta">@Field</span></div><div class="line">	<span class="keyword">private</span> Integer age;</div><div class="line"></div><div class="line">	<span class="comment">// getter setter method</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当将一个 doc 往 solr 中添加之后，要记得调用 commit 方法，当然，如果在 solrconfig.xml 中有配置硬/软提交的，可以省略<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">SolrClient solrClient = createSolrClient(baseSolrUrl);</div><div class="line">UpdateResponse response = solrClient.addBean(collection, user);</div><div class="line"></div><div class="line">solrClient.commit(collection);</div><div class="line">solrClient.close();</div></pre></td></tr></table></figure></p>
<p>Group 分组划分结果，返回的是分组结果；<br>Facet 分组统计，侧重统计，返回的是分组后的数量；<br>下面分别说下</p>
<h3 id="Facet查询"><a href="#Facet查询" class="headerlink" title="Facet查询"></a>Facet查询</h3><p>进行Facet查询需要在请求参数中加入”facet=on”或者”facet=true”只有这样Facet组件才起作用.<br>搜索结果按照Facet的字段分组并统计<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery();</div><div class="line">solrQuery.setQuery(<span class="string">"老师"</span>);</div><div class="line">solrQuery.setFacet(<span class="keyword">true</span>);</div><div class="line">solrQuery.setFacetMinCount(<span class="number">1</span>); <span class="comment">// 统计结果大于 1 的才会返回</span></div><div class="line">solrQuery.setFacetLimit(<span class="number">10</span>); <span class="comment">// 对于每一个 field 最多返回 10 个结果</span></div><div class="line">solrQuery.addFacetField(<span class="string">"age"</span>, <span class="string">"name"</span>);</div><div class="line">solrQuery.setRows(<span class="number">0</span>); <span class="comment">// 设置返回结果条数，如果分组查询，就设置为0</span></div><div class="line"></div><div class="line">QueryResponse queryResponse = SolrUtils.getQueryResponse(baseSolrUrl, collection, solrQuery);</div><div class="line">List&lt;FacetField&gt; facetFields = queryResponse.getFacetFields();</div><div class="line">facetFields.stream().forEach(ff -&gt; &#123;</div><div class="line">	ff.getValues().stream().forEach(c -&gt; &#123;</div><div class="line">		System.out.println(c.getName() + <span class="string">", "</span> + c.getCount());</div><div class="line">	&#125;);</div><div class="line">	System.out.println();</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">///~: output</span></div><div class="line"><span class="number">50</span>, <span class="number">3</span></div><div class="line"><span class="number">20</span>, <span class="number">2</span></div><div class="line"><span class="number">40</span>, <span class="number">1</span></div><div class="line"></div><div class="line">陈六, <span class="number">2</span></div><div class="line">张三, <span class="number">1</span></div><div class="line">李七, <span class="number">1</span></div><div class="line">李四, <span class="number">1</span></div><div class="line">王五, <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>facet的参数见solr官方wiki  <a href="http://wiki.apache.org/solr/SimpleFacetParameters" target="_blank" rel="external">http://wiki.apache.org/solr/SimpleFacetParameters</a></p>
<p>facet 参数字段要求:<br>1.字段必须被索引<br>2.facet=on 或 facet=true</p>
<p>1.facet.field<br>分组的字段<br>2.facet.prefix<br>表示Facet字段前缀<br>3.facet.limit<br>Facet字段返回条数<br>4.facet.offict<br>开始条数,偏移量,它与facet.limit配合使用可以达到分页的效果<br>5.facet.mincount<br>Facet字段最小count,默认为0<br>6.facet.missing<br>如果为on或true,那么将统计那些Facet字段值为null的记录<br>7.facet.method<br>取值为enum或fc,默认为fc, fc表示Field Cache<br>8.facet.enum.cache.minDf<br>当facet.method=enum时,参数起作用,文档内出现某个关键字的最少次数</p>
<h3 id="Group查询"><a href="#Group查询" class="headerlink" title="Group查询"></a>Group查询</h3><p>分组统计查询不同于分组统计（Facet），facet只是简单统计记录数，并不能为每组数据返回实际的数据回来，solr提供的grouping查询能够解决这一问题，也就是说，他除了能分组外，还能把每组数据返回来。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery();</div><div class="line">solrQuery.setQuery(<span class="string">"*:*"</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP, <span class="keyword">true</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_FIELD, <span class="string">"age"</span>, <span class="string">"name"</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_LIMIT, <span class="number">3</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_FORMAT, <span class="string">"grouped"</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_MAIN, <span class="keyword">false</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_TOTAL_COUNT, <span class="keyword">true</span>);</div><div class="line">solrQuery.set(GroupParams.GROUP_SORT, <span class="string">"age asc"</span>);</div><div class="line"></div><div class="line">QueryResponse queryResponse = SolrUtils.getQueryResponse(baseSolrUrl, collection, solrQuery);</div><div class="line"><span class="comment">// 通过GroupResponse获取GroupCommand，进而通过GroupCommand获取Group，而Group又可以获得SolrDocumentList</span></div><div class="line">GroupResponse groupResponse = queryResponse.getGroupResponse();</div><div class="line">List&lt;GroupCommand&gt; groupCommands = groupResponse.getValues();</div><div class="line"><span class="keyword">for</span> (GroupCommand gc : groupCommands) &#123;</div><div class="line">	System.out.println(<span class="string">"\n########## group name: "</span> + gc.getName());</div><div class="line">	<span class="comment">// 只有设置 GroupParams.GROUP_TOTAL_COUNT 这里 getNGroups 才有效果</span></div><div class="line">	System.out.println(<span class="string">"########## Num of Groups Found: "</span> + gc.getNGroups()); </div><div class="line">	System.out.println(<span class="string">"########## Num of documents Found: "</span> + gc.getMatches());</div><div class="line"></div><div class="line">	List&lt;Group&gt; groups = gc.getValues();</div><div class="line">	<span class="keyword">for</span> (Group g : groups) &#123;</div><div class="line">		SolrDocumentList solrDocumentList = g.getResult();</div><div class="line">		System.out.println(<span class="string">"\n########## group name: "</span> + gc.getName() + <span class="string">", groupValue: "</span> + g.getGroupValue()</div><div class="line">				+ <span class="string">", Num of Documents in this group: "</span> + solrDocumentList.getNumFound());</div><div class="line">		<span class="keyword">if</span> (CollectionUtils.isNotEmpty(solrDocumentList)) &#123;</div><div class="line">			<span class="keyword">for</span> (SolrDocument sd : solrDocumentList) &#123;</div><div class="line">				System.out.println(sd);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="solr建立索引的过程和查询过程"><a href="#solr建立索引的过程和查询过程" class="headerlink" title="solr建立索引的过程和查询过程"></a>solr建立索引的过程和查询过程</h2><h3 id="solr索引建立："><a href="#solr索引建立：" class="headerlink" title="solr索引建立："></a>solr索引建立：</h3><p>第一步：solr会对句子进行空格分隔，比如对 JAVA is a kind of computer language 分词，分为JAVA，is，a，kind，of，computer，language;</p>
<p>第二步：solr会对上面分出来的词，去掉停用词，这里比如a，is;</p>
<p>第三部：solr会对上面分出来的英文都转化为小写 java,kind,of,computer,language。</p>
<h3 id="solr查询过程："><a href="#solr查询过程：" class="headerlink" title="solr查询过程："></a>solr查询过程：</h3><p>第一步：同索引过程；</p>
<p>第二步：同索引过程；</p>
<p>第三部：同索引过程；</p>
<p>最后分词匹配成功，那么索引的那句话就会被查询出来，这里需要注意：索引和查询的分词器必须使用一样的！！！</p>
<h2 id="下面说说Solr基础"><a href="#下面说说Solr基础" class="headerlink" title="下面说说Solr基础"></a>下面说说Solr基础</h2><p>部分内容转载自如下网址，详情请参阅：<br><a href="http://blog.csdn.net/awj3584/article/details/16963525" target="_blank" rel="external">http://blog.csdn.net/awj3584/article/details/16963525</a><br><a href="https://lucene.apache.org/solr/guide/" target="_blank" rel="external">https://lucene.apache.org/solr/guide/</a><br>以下部分为抄录内容</p>
<h3 id="types-部分"><a href="#types-部分" class="headerlink" title="types 部分"></a>types 部分</h3><p>是一些常见的可重用定义，定义了 Solr（和 Lucene）如何处理 Field。也就是添加到索引中的xml文件属性中的类型，如int、text、date等.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"boolean"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"int"</span> <span class="attr">class</span>=<span class="string">"solr.TrieIntField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> <span class="attr">enablePositionIncrements</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> <span class="attr">enablePositionIncrements</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>参数说明:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td style="text-align:left">标识而已</td>
</tr>
<tr>
<td>class</td>
<td style="text-align:left">和其他属性决定了这个fieldType的实际行为。</td>
</tr>
<tr>
<td>sortMissingLast</td>
<td style="text-align:left">设置成true没有该field的数据排在有该field的数据之后，而不管请求时的排序规则, 默认是设置成false。</td>
</tr>
<tr>
<td>sortMissingFirst</td>
<td style="text-align:left">跟上面倒过来呗。 默认是设置成false</td>
</tr>
<tr>
<td>analyzer</td>
<td style="text-align:left">字段类型指定的分词器</td>
</tr>
<tr>
<td>type</td>
<td style="text-align:left">当前分词用用于的操作.index代表生成索引时使用的分词器query代码在查询时使用的分词器</td>
</tr>
<tr>
<td>tokenizer</td>
<td style="text-align:left">分词器类</td>
</tr>
<tr>
<td>filter</td>
<td style="text-align:left">分词后应用的过滤器  过滤器调用顺序和配置相同.</td>
</tr>
</tbody>
</table>
<h3 id="fileds"><a href="#fileds" class="headerlink" title="fileds"></a>fileds</h3><p>是你添加到索引文件中出现的属性名称，而声明类型就需要用到上面的types<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"path"</span> <span class="attr">type</span>=<span class="string">"text_smartcn"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> <span class="attr">termVector</span>=<span class="string">"true"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"text_smartcn"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> <span class="attr">termVector</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span> =<span class="string">"text"</span> <span class="attr">type</span> =<span class="string">"text_ik"</span> <span class="attr">indexed</span> =<span class="string">"true"</span> <span class="attr">stored</span> =<span class="string">"false"</span> <span class="attr">multiValued</span> =<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span> =<span class="string">"pinyin"</span> <span class="attr">type</span> =<span class="string">"text_pinyin"</span> <span class="attr">indexed</span> =<span class="string">"true"</span> <span class="attr">stored</span> =<span class="string">"false"</span> <span class="attr">multiValued</span> =<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_i"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_l"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_s"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p>field: 固定的字段设置<br>dynamicField: 动态的字段设置,用于后期自定义字段,*号通配符.例如: test_i就是int类型的动态字段.<br>还有一个特殊的字段copyField,一般用于检索时用的字段这样就只对这一个字段进行索引分词就行了copyField的dest属性如果有多个source一定要设置multiValued=true,否则会报错的<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"content"</span> <span class="attr">dest</span>=<span class="string">"pinyin"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"content"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"pinyin"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>字段属性说明:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td style="text-align:left">字段类型名</td>
</tr>
<tr>
<td>class</td>
<td style="text-align:left">java类名</td>
</tr>
<tr>
<td>indexed</td>
<td style="text-align:left">缺省true。 说明这个数据应被搜索和排序，如果数据没有indexed，则stored应是true。</td>
</tr>
<tr>
<td>stored</td>
<td style="text-align:left">缺省true。说明这个字段被包含在搜索结果中是合适的。如果数据没有stored,则indexed应是true。</td>
</tr>
<tr>
<td>omitNorms</td>
<td style="text-align:left">字段的长度不影响得分和在索引时不做boost时，设置它为true。一般文本字段不设置为true。</td>
</tr>
<tr>
<td>termVectors</td>
<td style="text-align:left">如果字段被用来做more like this 和highlight的特性时应设置为true。</td>
</tr>
<tr>
<td>compressed</td>
<td style="text-align:left">字段是压缩的。这可能导致索引和搜索变慢，但会减少存储空间，只有StrField和TextField是可以压缩，这通常适合字段的长度超过200个字符。</td>
</tr>
<tr>
<td>multiValued</td>
<td style="text-align:left">字段多于一个值的时候，可设置为true。</td>
</tr>
<tr>
<td>positionIncrementGap</td>
<td style="text-align:left">和multiValued一起使用，设置多个值之间的虚拟空白的数量</td>
</tr>
</tbody>
</table>
<p>注意:<em>version</em> 是一个特殊字段,不能删除,是记录当前索引版本号的.</p>
<p>uniqueKey: 唯一键，这里配置的是上面出现的fileds，一般是id、url等不重复的。在更新、删除的时候可以用到。<br>defaultSearchField: 默认搜索属性，如q=solr就是默认的搜索那个字段（默认搜text，其他字段的值会copy到这个field）<br>solrQueryParser: 查询转换模式，是并且还是或者（AND/OR必须大写）</p>
<h2 id="solr配置solrconfig-xml"><a href="#solr配置solrconfig-xml" class="headerlink" title="solr配置solrconfig.xml"></a>solr配置solrconfig.xml</h2><p>对于我的机器来说，是在以下目录：E:\solr-6.5.0\server\solr\mysqlCore\conf\solrconfig.xml</p>
<h3 id="索引indexConfig"><a href="#索引indexConfig" class="headerlink" title="索引indexConfig"></a>索引indexConfig</h3><p>Solr 性能因素，来了解与各种更改相关的性能权衡。 下表概括了可控制 Solr 索引处理的各种因素：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>useCompoundFile</td>
<td style="text-align:left">通过将很多 Lucene 内部文件整合到一个文件来减少使用中的文件的数量。这可有助于减少 Solr 使用的文件句柄数目，代价是降低了性能。除非是应用程序用完了文件句柄，否则 false 的默认值应该就已经足够。</td>
</tr>
<tr>
<td>ramBufferSizeMB</td>
<td style="text-align:left">在添加或删除文档时，为了减少频繁的更些索引,Solr会选缓存在内存中,当内存中的文件大于设置的值,才会更新到索引库。较大的值可使索引时间变快但会牺牲较多的内存。</td>
</tr>
<tr>
<td>maxBufferedDocs</td>
<td style="text-align:left">同 ramBufferSizeMB，如两个值同时设置,满足一个就会进行刷新索引.</td>
</tr>
<tr>
<td>mergeFactor</td>
<td style="text-align:left">决定低水平的 Lucene 段被合并的频率。较小的值（最小为 2）使用的内存较少但导致的索引时间也更慢。较大的值可使索引时间变快但会牺牲较多的内存。</td>
</tr>
<tr>
<td>maxIndexingThreads</td>
<td style="text-align:left">是indexWriter生成索引时使用的最大线程数</td>
</tr>
<tr>
<td>unlockOnStartup</td>
<td style="text-align:left">unlockOnStartup 告知 Solr 忽略在多线程环境中用来保护索引的锁定机制。在某些情况下，索引可能会由于不正确的关机或其他错误而一直处于锁定，这就妨碍了添加和更新。将其设置为 true  可以禁用启动锁定，进而允许进行添加和更新。</td>
</tr>
<tr>
<td>lockType</td>
<td style="text-align:left">1. single: 在只读索引或是没有其它进程修改索引时使用. 2. native: 使用操作系统本地文件锁,不能使用多个Solr在同一个JVM中共享一个索引. 3. simple :使用一个文本文件锁定索引.</td>
</tr>
</tbody>
</table>
<h3 id="查询配置query"><a href="#查询配置query" class="headerlink" title="查询配置query"></a>查询配置query</h3><table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>maxBooleanClauses</td>
<td style="text-align:left">最大的BooleanQuery数量. 当值超出时，抛出 TooManyClausesException.注意这个是全局的,如果是多个SolrCore都会使用一个值,每个Core里设置不一样的话,会使用最后一个的.</td>
</tr>
<tr>
<td>filterCache</td>
<td style="text-align:left">filterCache存储了无序的lucene document id集合，1.存储了filter queries(“fq”参数)得到的document id集合结果。2.还可用于facet查询。3. 如果配置了useFilterForSortedQuery，那么如果查询有filter，则使用filterCache。</td>
</tr>
<tr>
<td>queryResultCache</td>
<td style="text-align:left">缓存搜索结果,一个文档ID列表</td>
</tr>
<tr>
<td>documentCache</td>
<td style="text-align:left">缓存Lucene的Document对象,不会自热</td>
</tr>
<tr>
<td>fieldValueCache</td>
<td style="text-align:left">字段缓存使用文档ID进行快速访问。默认情况下创建fieldValueCache即使这里没有配置。</td>
</tr>
<tr>
<td>enableLazyFieldLoading</td>
<td style="text-align:left">若应用程序预期只会检索 Document 上少数几个 Field，那么可以将属性设置为 true。延迟加载的一个常见场景大都发生在应用程序返回和显示一系列搜索结果的时候，用户常常会单击其中的一个来查看存储在此索引中的原始文档。初始的显示常常只需要显示很短的一段信息。若考虑到检索大型 Document 的代价，除非必需，否则就应该避免加载整个文档。</td>
</tr>
<tr>
<td>queryResultWindowSize</td>
<td style="text-align:left">一次查询中存储最多的doc的id数目.</td>
</tr>
<tr>
<td>queryResultMaxDocsCached</td>
<td style="text-align:left">查询结果doc的最大缓存数量, 例如要求每页显示10条,这里设置是20条,也就是说缓存里总会给你多出10条的数据.让你点示下一页时很快拿到数据.</td>
</tr>
<tr>
<td>listener</td>
<td style="text-align:left">选项定义 newSearcher 和 firstSearcher 事件，您可以使用这些事件来指定实例化新搜索程序或第一个搜索程序时应该执行哪些查询。如果应用程序期望请求某些特定的查询，那么在创建新搜索程序或第一个搜索程序时就应该反注释这些部分并执行适当的查询。</td>
</tr>
<tr>
<td>useColdSearcher</td>
<td style="text-align:left">是否使用冷搜索,为false时使用自热后的searcher</td>
</tr>
<tr>
<td>maxWarmingSearchers</td>
<td style="text-align:left">最大自热searcher数量</td>
</tr>
</tbody>
</table>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>删除索引可以通过两种方式操作,一种是通过文档ID进行删除, 另一种是通过查询到的结果进行删除.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">通过ID删除方式代码:</div><div class="line">solrClient.deleteById(id);</div><div class="line"></div><div class="line"><span class="comment">//或是使用批量删除</span></div><div class="line">solrClient.deleteById(ids);</div><div class="line"></div><div class="line">通过查询删除方式代码:</div><div class="line">solrClient.deleteByQuery(<span class="string">"*:*"</span>); <span class="comment">// ”*:*” 就查询所有内容的, 这样就删除了所有文档索引</span></div></pre></td></tr></table></figure></p>
<h3 id="优化索引"><a href="#优化索引" class="headerlink" title="优化索引"></a>优化索引</h3><p>优化Lucene 的索引文件以改进搜索性能。索引完成后执行一下优化通常比较好。如果更新比较频繁，则应该在使用率较低的时候安排优化。一个索引无需优化也可以正常地运行。优化是一个耗时较多的过程。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">solrClient.optimize(); <span class="comment">// 不要频繁的调用, 尽量在无人使用时调用</span></div></pre></td></tr></table></figure></p>
<h3 id="查询参数"><a href="#查询参数" class="headerlink" title="查询参数"></a>查询参数</h3><table>
<thead>
<tr>
<th>名称</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>q</td>
<td style="text-align:left">查询字符串，必须的</td>
</tr>
<tr>
<td>fq</td>
<td style="text-align:left">filter query。使用Filter Query可以充分利用Filter Query Cache，提高检索性能。作用：在q查询符合结果中同时是fq查询符合的，例如：q=mm&amp;fq=date_time:[20081001 TO 20091031]，找关键字mm，并且date_time是20081001到20091031之间的</td>
</tr>
<tr>
<td>fl</td>
<td style="text-align:left">field list。指定返回结果字段。以空格“ ”或逗号“,”分隔</td>
</tr>
<tr>
<td>start</td>
<td style="text-align:left">用于分页定义结果起始记录数，默认为0</td>
</tr>
<tr>
<td>rows</td>
<td style="text-align:left">用于分页定义结果每页返回记录数，默认为10</td>
</tr>
<tr>
<td>sort</td>
<td style="text-align:left">排序，格式: sort=&lt;field name&gt;+&lt;desc&#124;asc&gt;[,&lt;field name&gt;+&lt;desc&#124;asc&gt;]… 。示例：（inStock desc, price asc）表示先 “inStock” 降序, 再 “price” 升序，默认是相关性降序。</td>
</tr>
<tr>
<td>df</td>
<td style="text-align:left">默认的查询字段，一般默认指定</td>
</tr>
<tr>
<td>q.op</td>
<td style="text-align:left">覆盖schema.xml的defaultOperator（有空格时用”AND”还是用”OR”操作逻辑），一般默认指定。必须大写</td>
</tr>
<tr>
<td>wt</td>
<td style="text-align:left">writer type。指定查询输出结构格式，默认为“xml”。在solrconfig.xml中定义了查询输出格式：xml、json、python、ruby、php、phps、custom</td>
</tr>
<tr>
<td>qt</td>
<td style="text-align:left">query type，指定查询使用的Query Handler，默认为“standard”</td>
</tr>
<tr>
<td>explainOther</td>
<td style="text-align:left">设置当debugQuery=true时，显示其他的查询说明</td>
</tr>
<tr>
<td>defType</td>
<td style="text-align:left">指定用于处理查询语句(参数q的内容)的查询解析器，eg:defType=lucene</td>
</tr>
<tr>
<td>timeAllowed</td>
<td style="text-align:left">设置查询超时时间</td>
</tr>
<tr>
<td>omitHeader</td>
<td style="text-align:left">设置是否忽略查询结果返回头信息，默认为“false”</td>
</tr>
<tr>
<td>indent</td>
<td style="text-align:left">返回的结果是否缩进，默认关闭，用 indent=true&#124;on 开启，一般调试json,php,phps,ruby输出才有必要用这个参数</td>
</tr>
<tr>
<td>version</td>
<td style="text-align:left">查询语法的版本，建议不使用它，由服务器指定默认值</td>
</tr>
<tr>
<td>debugQuery</td>
<td style="text-align:left">设置返回结果是否显示Debug信息</td>
</tr>
</tbody>
</table>
<h3 id="查询语法"><a href="#查询语法" class="headerlink" title="查询语法"></a>查询语法</h3><ol>
<li><p>匹配所有文档：<em>:</em></p>
</li>
<li><p>强制、阻止和可选查询：<br> 1)Mandatory：查询结果中必须包括的(for example, only entry name containing the word make)<br> Solr/Lucene Statement：+make, +make +up ,+make +up +kiss<br> 2)prohibited：(for example, all documents except those with word believe)<br> Solr/Lucene Statement：+make +up -kiss<br> 3)optional：Solr/Lucene Statement：+make +up kiss</p>
</li>
<li><p>布尔操作：AND、OR和NOT布尔操作（必须大写）与Mandatory、optional和prohibited相似。<br> 1)make AND up ＝ +make +up :AND左右两边的操作都是mandatory<br> 2)make || up ＝ make OR up＝make up :OR左右两边的操作都是optional<br> 3)+make +up NOT kiss ＝ +make +up –kiss<br> 4)make AND up OR french AND Kiss不可以达到期望的结果，因为AND两边的操作都是mandatory的。</p>
</li>
<li><p>子表达式查询（子查询）：可以使用“()”构造子查询。<br> 示例：(make AND up) OR (french AND Kiss)</p>
</li>
<li><p>子表达式查询中阻止查询的限制：<br> 示例：make (-up):只能取得make的查询结果；要使用make (-up <em>:</em>)查询make或者不包括up的结果。</p>
</li>
<li><p>多字段fields查询：通过字段名加上分号的方式（fieldName:query）来进行查询<br> 示例：entryNm:make AND entryId:3cdc86e8e0fb4da8ab17caed42f6760c</p>
</li>
<li><p>通配符查询（wildCard Query）：<br> 1)通配符？和*：“*”表示匹配任意字符；“？”表示匹配出现的位置。<br> 示例：ma?*（ma后面的一个位置匹配），ma??*(ma后面两个位置都匹配)<br> 2)查询字符必须要小写:+Ma +be**可以搜索到结果；+Ma +Be**没有搜索结果.<br> 3)查询速度较慢，尤其是通配符在首位：主要原因一是需要迭代查询字段中的每个term，判断是否匹配；二是匹配上的term被加到内部的查询，当terms数量达到1024的时候，查询会失败。<br> 4)Solr中默认通配符不能出现在首位（可以修改QueryParser，设置setAllowLeadingWildcard为true）</p>
</li>
<li><p>模糊查询、相似查询：不是精确的查询，通过对查询的字段进行重新插入、删除和转换来取得得分较高的查询解决（由Levenstein Distance Algorithm算法支持）。<br> 1)一般模糊查询：示例：make-believ~<br> 2)门槛模糊查询：对模糊查询可以设置查询门槛，门槛是0~1之间的数值，门槛越高表面相似度越高。示例：make-believ~0.5、make-believ~0.8、make-believ~0.9</p>
</li>
<li><p>范围查询（Range Query）：Lucene支持对数字、日期甚至文本的范围查询。结束的范围可以使用“*”通配符。<br>示例：<br> 1)日期范围（ISO-8601 时间GMT）：sa_type:2 AND a_begin_date:[1990-01-01T00:00:00.000Z TO 1999-12-31T24:59:99.999Z]<br> 2)数字：salary:[2000 TO *]<br> 3)文本：entryNm:[a TO a]</p>
</li>
<li><p>日期匹配：YEAR, MONTH, DAY, DATE (synonymous with DAY) HOUR, MINUTE, SECOND, MILLISECOND, and MILLI (synonymous with MILLISECOND)可以被标志成日期。<br>示例：<br>1)r_event_date:[* TO NOW-2YEAR]：2年前的现在这个时间<br>2)r_event_date:[* TO NOW/DAY-2YEAR]：2年前前一天的这个时间</p>
</li>
<li><p>solr的查询语句支持C语言格式的注释。<br><code>&quot;jakarta apache&quot; /* this is a comment in the middle of a normal query string */ OR jakarta</code></p>
</li>
<li><p><code>+ - &amp;&amp; || ! ( ) { } [ ] ^ &quot; ~ * ? : /
这些字符在solr中具有特殊的含义，如果要使用这么字符本身含义，需要利用反斜杠进行转义，比如： \(1\+1\):2</code></p>
</li>
<li><p>solr的查询字符串q中的多个关键字之间默认的关系是 OR<br>例如：红旗 中国 ，代表：红旗 OR 中国</p>
</li>
<li><p>若要搜寻交集结果,请在词与词间加上大写 “AND” 或 “+” (不包含”号).<br>例如: text:总统府 AND text:邮局<br>或<br>+text:总统府 +text:邮局<br>或<br>name:总统府 AND tel:23xxxxxx3<br>或<br>name: ( +总统府 +邮局)</p>
</li>
<li><p>排除查询<br>在要排除的词前加上 “-” (不包含”号) 号<br>例如: 总统府 -邮局<br>搜寻结果不会有包含邮局的词的结果在内</p>
</li>
<li><p>增加权重: 如要搜寻 “中华 加油站”(不包含”号) 但因为回传太多笔资料内有 “中华”(不包含”号) 或 “加油站”(不包含”号) 的结果,<br>所以想要把有包含 “加油站”(不包含”号)的数据往前排,可使用 “^”(不包含”号)符号在后面加上愈增加的权重数,<br>像是 “2″,则可以这样做:<br>中华 加油站^2<br>会同时搜寻含有中华或加油站的结果,并把加油站这个词加权所以搜寻时会先判断加油站这一个词在<br>搜寻结果中的比重,甚至假设一笔数据内加油站出现过两次以上的就更加会有优先权.</p>
</li>
</ol>
<h3 id="标准查询操作符"><a href="#标准查询操作符" class="headerlink" title="标准查询操作符"></a>标准查询操作符</h3><table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:</code></td>
<td style="text-align:left">指定要查找的字段，比如：title:“The Right Way” AND text:go</td>
</tr>
<tr>
<td><code>？</code></td>
<td style="text-align:left">匹配单一字符，比如: te?t匹配test/text</td>
</tr>
<tr>
<td><code>*</code></td>
<td style="text-align:left">匹配0或多个字符，比如：tes*匹配test/testing/tester</td>
</tr>
<tr>
<td><code>~</code></td>
<td style="text-align:left">基于编辑距离的模糊查询，比如：roam~匹配roams/foam/foams/roam. roam~1(指定距离必须是1)匹配roams/foam，但不会匹配foams</td>
</tr>
<tr>
<td><code>~n</code></td>
<td style="text-align:left">邻近查询，查找相隔一定距离的单词，比如：”jakarta apache”~10（相隔10个单词）    （下面会详细说明<code>~</code> 和 <code>~n</code>的区别）</td>
</tr>
<tr>
<td><code>TO</code></td>
<td style="text-align:left">范围查询，{}不包含边界，[]包含边界，比如：title:{Aida TO Carmen}</td>
</tr>
<tr>
<td><code>^</code></td>
<td style="text-align:left">加权因子，比如:jakarta^4 apache 查找结果中jakarta更相关, 看下面相关度的说明</td>
</tr>
<tr>
<td><code>^=</code></td>
<td style="text-align:left">指定查询语句的score得分为常量，比如：(description:blue OR color:blue)^=1.0 text:shoes</td>
</tr>
<tr>
<td><code>AND(&amp;&amp;)</code></td>
<td style="text-align:left">运算符两边的查询词同时出现 比如：”jakarta apache” AND “Apache Lucene”</td>
</tr>
<tr>
<td><code>OR</code></td>
<td style="text-align:left">运算符两边的查询词至少一个出现, 默认运算符，比如 “jakarta apache” jakarta 等价于 “jakarta apache” OR jakarta</td>
</tr>
<tr>
<td><code>NOT(!)</code></td>
<td style="text-align:left">运算符后面的查询词不出现，比如”jakarta apache” NOT “Apache Lucene”</td>
</tr>
<tr>
<td><code>+</code></td>
<td style="text-align:left">运算符后面的查询词出现(known as the “required” operator),比如+jakarta lucene查询必须包含jakarta,而lucene可以出现可不出现</td>
</tr>
<tr>
<td><code>-</code></td>
<td style="text-align:left">不能包含运算符后面的查询词 “jakarta apache” -“Apache Lucene”</td>
</tr>
<tr>
<td><code>[]</code></td>
<td style="text-align:left">包含范围边界</td>
</tr>
<tr>
<td><code>{}</code></td>
<td style="text-align:left">不包含范围边界</td>
</tr>
</tbody>
</table>
<h3 id="模糊-编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）"><a href="#模糊-编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）" class="headerlink" title="模糊/编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）"></a>模糊/编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）</h3><p>对于很多搜索应用来说，很重要的功能是不仅仅需要精确匹配用户的文本内容。而且还允许一些灵活的变化，比如一些用户的拼写错误或相同单词的其它变体。Solr 通过基于 Damerau-Levenshtein 距离的编辑距离测量来支持这个功能，它将容忍 80% 以上的拼写错误。</p>
<h5 id="Solr-提供的模糊编辑距离查询需要用到波浪符号（-）："><a href="#Solr-提供的模糊编辑距离查询需要用到波浪符号（-）：" class="headerlink" title="Solr 提供的模糊编辑距离查询需要用到波浪符号（~）："></a>Solr 提供的模糊编辑距离查询需要用到波浪符号（~）：</h5><p>查询语句： administrator~ 匹配： adminstrator， administrater， administratior，等<br>这个查询不仅匹配原始的关键字（administrator），还有其它与原始关键字有 2 个编辑距离的关键字。一个编辑距离表示增加，删除，取代或交换一个任意字符。关键字 adminstrator （在第六个字母出少了字符“i”）和原始关键字之间相差一个编辑距离，因为它删除了一个字符。同样 sadministrator 和原始关键字之间也是相差一个编辑距离，因为它在前面添加了一个字符。administratro 也与原始关键字有一个编辑距离，因为它将最后两个字符交换了顺序。</p>
<h5 id="在编辑距离查询中也可以精确指定编辑距离："><a href="#在编辑距离查询中也可以精确指定编辑距离：" class="headerlink" title="在编辑距离查询中也可以精确指定编辑距离："></a>在编辑距离查询中也可以精确指定编辑距离：</h5><p>查询语句：administrator~1 匹配一个编辑距离以内的内容。<br>查询语句：administrator~2 匹配两个编辑距离以内的内容（如果没有提供编辑距离的话，这个就是默认值）。<br>查询语句：administrator~N 匹配 N 个编辑距离以内的内容。<br>注意，任何编辑距离大于 2 的查询将会使查询速度变得很慢。如果编辑距离在 2 以内，那么将会使用很高效率的 Levenshtein 自动机（Levenshtein automaton），但是如果编辑距离大于 2，将会退回到更慢的编辑距离实现。</p>
<h3 id="临近查询"><a href="#临近查询" class="headerlink" title="临近查询"></a>临近查询</h3><p>在前面，我们看到了编辑距离查询是如何查找相似的关键字，而不是进行精确匹配。编辑距离的概念适用于关键字中字符的变换或短语中各个单词之间的变化。</p>
<p>如果你想要通过 Solr 的索引查询公司中所有员工的档案。一种方法是枚举出公司中所有可能的职位：</p>
<p>查询语句：”chief executive officer” OR “chief financial officer” OR “chief marketing officer” OR “chief technology officer” OR …</p>
<p>当然，这种查询的前提是你需要知道公司中所有可能的职位，这当然不现实。另外的一种解决方案是单独搜索每个关键字：</p>
<p>查询语句： chief AND officer<br>这将会匹配所有可能的用例，但是同时也会匹配所有包含了这两个关键字的文档。例如：One chief concern arising from the incident was the safety of the police officer on duty。这个文档明显不符合我们的要求，但是如果使用上面的查询语句，那么将会返回这个文档。</p>
<p>Solr 提供了解决这种问题的方案：临近查询。在上面的例子中，比较好的策略是请求 Solr 返回所有包含了关键字 chief 和关键字 officer 临近的文档。这可以通过下面的查询语句样例来实现：</p>
<p>查询语句： “chief officer”~1<br>解释：chief 和 officer 之间最多只能有一个距离<br>例子：”chief executive officer”, “chief financial officer”</p>
<p>查询语句：”chief officer”~2<br>解释：chief 和 officer 之间最多只能有两个编辑距离<br>例子：”chief business development officer”, “officer chief”</p>
<p>查询语句：”chief officer”~N<br>解释：查询 chief 和 officer 之间有 N 个编辑距离。</p>
<p>事实上，对短语进行精确匹配的查询语句 “chief  development  officer” 很容易改写成  “chief development officer”~0。这两个查询都返回相同的结果，因为在第二个查询语句中，编辑距离设置为 0，所以和精确查询得到的结果是相同的。这两种机制都需要使用到 Solr 中存储的关键字位置（前面的文章介绍过）来计算编辑距离。还有一点需要注意的是，临近查询并不是完全按照编辑距离的定义来进行查询，因为它的查询结果中，所有的关键字都必须存在。而编辑距离查询的定义中，可以对关键字进行删除和修改。</p>
<p>但是其它的编辑距离定义依旧保留，例如增加和换位。顺着这条线，你可能会注意到，你需要设置 2 进行临近查询的时候（”chief officer”~2）才能查询出文本 officer chief。这是因为第一次编辑将 chief 和 officer 修改成相同的位置；第二次编辑将 chief 才能将 chief 编辑到 officer 后面。这也再次说明了临近查询使用的并不是真正的编辑距离（在编辑距离中，位置互换的编辑距离只能算 1）。</p>
<h3 id="模糊-编辑距离查询-和-临近查询-的区别"><a href="#模糊-编辑距离查询-和-临近查询-的区别" class="headerlink" title="模糊/编辑距离查询 和 临近查询 的区别"></a>模糊/编辑距离查询 和 临近查询 的区别</h3><ol>
<li>模糊/编辑距离查询 是对一个字符串进行查询；</li>
<li>临近查询 是对两个字符串进行查询，并且它们被”包围着</li>
</ol>
<h3 id="Solr文本匹配不同字段的相关度权重设置需要做如下设置："><a href="#Solr文本匹配不同字段的相关度权重设置需要做如下设置：" class="headerlink" title="Solr文本匹配不同字段的相关度权重设置需要做如下设置："></a>Solr文本匹配不同字段的相关度权重设置需要做如下设置：</h3><p>1）启用edismax选项，在检索url上添加defType=edismax参数<br>2）设置q参数为搜索关键词，这里不要再写搜索表达式了<br>3）设置qf参数，指定不同字段的权重，例如：title^10 keywords^10 content^1 表示title字段的权重设置为10，keywords为10，content权重设置为1 </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/10/29/solr-note/" data-id="cj9fjlm2r000bb8f7nmb39wfc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-solr-commit-types" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/29/solr-commit-types/" class="article-date">
  <time datetime="2017-10-29T02:59:11.000Z" itemprop="datePublished">2017-10-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/solr/">solr</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/29/solr-commit-types/">solr提交索引的三种方式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-commit"><a href="#1-commit" class="headerlink" title="1.commit"></a>1.commit</h2><p>通过api直接commit,这样性能比较差</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.SolrServerException;</div><div class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</div><div class="line"><span class="keyword">import</span> org.apache.solr.common.SolrInputDocument;</div><div class="line"></div><div class="line">String baseSolrUrl = <span class="string">"http://localhost:8983/solr/"</span>;</div><div class="line">HttpSolrClient solrClient = <span class="keyword">new</span> HttpSolrClient.Builder().withBaseSolrUrl(baseSolrUrl).build();</div><div class="line"></div><div class="line">SolrInputDocument solrInputDocument = <span class="keyword">new</span> SolrInputDocument();</div><div class="line">solrInputDocument.addField(<span class="string">"id"</span>, <span class="string">"1"</span>);</div><div class="line">solrInputDocument.addField(<span class="string">"name"</span>, <span class="string">"Tim Ho"</span>);</div><div class="line">solrInputDocument.addField(<span class="string">"age"</span>, <span class="string">"23"</span>);</div><div class="line"></div><div class="line">solrClient.add(<span class="string">"mysqlCore"</span>, solrInputDocument);</div><div class="line">solrClient.commit();</div></pre></td></tr></table></figure>
<h2 id="2-commitWithinMs"><a href="#2-commitWithinMs" class="headerlink" title="2.commitWithinMs"></a>2.commitWithinMs</h2><p>简单的说就是告诉solr在多少毫秒内提交，比如我指定commitWithinMs=10000，将会告诉solr在10s内提交我的document。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">用法：</div><div class="line"><span class="number">1</span>.可以在add方法设置参数，比如：solrClient.add(<span class="string">"mysqlCore"</span>, solrInputDocument, <span class="number">10000</span>);</div><div class="line"></div><div class="line"><span class="number">2</span>.UpdateRequest updateRequest = <span class="keyword">new</span> UpdateRequest();</div><div class="line">  updateRequest.add(solrInputDocument);</div><div class="line">  updateRequest.setCommitWithin(<span class="number">10000</span>);</div><div class="line">  updateRequest.process(solrClient, <span class="string">"mysqlCore"</span>);</div></pre></td></tr></table></figure></p>
<p>参考：<a href="https://lucene.apache.org/solr/guide/6_6/updatehandlers-in-solrconfig.html" target="_blank" rel="external">https://lucene.apache.org/solr/guide/6_6/updatehandlers-in-solrconfig.html</a></p>
<h2 id="3-AutoCommit"><a href="#3-AutoCommit" class="headerlink" title="3.AutoCommit"></a>3.AutoCommit</h2><p>参考：<a href="http://wiki.apache.org/solr/SolrConfigXml" target="_blank" rel="external">http://wiki.apache.org/solr/SolrConfigXml</a><br>例如，我的配置文件在 E:\solr-6.5.0\server\solr\mysqlCore\conf\solrconfig.xml 中已有默认配置，如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- The default high-performance update handler --&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">updateHandler</span> <span class="attr">class</span>=<span class="string">"solr.DirectUpdateHandler2"</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Enables a transaction log, used for real-time get, durability, and</span></div><div class="line"><span class="comment">         and solr cloud replica recovery.  The log can grow as big as</span></div><div class="line"><span class="comment">         uncommitted changes to the index, so use of a hard autoCommit</span></div><div class="line"><span class="comment">         is recommended (see below).</span></div><div class="line"><span class="comment">         "dir" - the target directory for transaction logs, defaults to the</span></div><div class="line"><span class="comment">                solr data directory.</span></div><div class="line"><span class="comment">         "numVersionBuckets" - sets the number of buckets used to keep</span></div><div class="line"><span class="comment">                track of max version values when checking for re-ordered</span></div><div class="line"><span class="comment">                updates; increase this value to reduce the cost of</span></div><div class="line"><span class="comment">                synchronizing access to version buckets during high-volume</span></div><div class="line"><span class="comment">                indexing, this requires 8 bytes (long) * numVersionBuckets</span></div><div class="line"><span class="comment">                of heap space per Solr core.</span></div><div class="line"><span class="comment">    --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">updateLog</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"dir"</span>&gt;</span>$&#123;solr.ulog.dir:&#125;<span class="tag">&lt;/<span class="name">str</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">"numVersionBuckets"</span>&gt;</span>$&#123;solr.ulog.numVersionBuckets:65536&#125;<span class="tag">&lt;/<span class="name">int</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">updateLog</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- AutoCommit</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         Perform a hard commit automatically under certain conditions.</span></div><div class="line"><span class="comment">         Instead of enabling autoCommit, consider using "commitWithin"</span></div><div class="line"><span class="comment">         when adding documents. </span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         http://wiki.apache.org/solr/UpdateXmlMessages</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         maxDocs - Maximum number of documents to add since the last</span></div><div class="line"><span class="comment">                   commit before automatically triggering a new commit.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         maxTime - Maximum amount of time in ms that is allowed to pass</span></div><div class="line"><span class="comment">                   since a document was added before automatically</span></div><div class="line"><span class="comment">                   triggering a new commit. </span></div><div class="line"><span class="comment">         openSearcher - if false, the commit causes recent index changes</span></div><div class="line"><span class="comment">           to be flushed to stable storage, but does not cause a new</span></div><div class="line"><span class="comment">           searcher to be opened to make those changes visible.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         If the updateLog is enabled, then it's highly recommended to</span></div><div class="line"><span class="comment">         have some sort of hard autoCommit to limit the log size.</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">autoCommit</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">maxTime</span>&gt;</span>$&#123;solr.autoCommit.maxTime:15000&#125;<span class="tag">&lt;/<span class="name">maxTime</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">openSearcher</span>&gt;</span>false<span class="tag">&lt;/<span class="name">openSearcher</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">autoCommit</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- softAutoCommit is like autoCommit except it causes a</span></div><div class="line"><span class="comment">         'soft' commit which only ensures that changes are visible</span></div><div class="line"><span class="comment">         but does not ensure that data is synced to disk.  This is</span></div><div class="line"><span class="comment">         faster and more near-realtime friendly than a hard commit.</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">autoSoftCommit</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">maxTime</span>&gt;</span>$&#123;solr.autoSoftCommit.maxTime:-1&#125;<span class="tag">&lt;/<span class="name">maxTime</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">autoSoftCommit</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- Update Related Event Listeners</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">         Various IndexWriter related events can trigger Listeners to</span></div><div class="line"><span class="comment">         take actions.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">         postCommit - fired after every commit or optimize command</span></div><div class="line"><span class="comment">         postOptimize - fired after every optimize command</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- The RunExecutableListener executes an external command from a</span></div><div class="line"><span class="comment">         hook such as postCommit or postOptimize.</span></div><div class="line"><span class="comment">         </span></div><div class="line"><span class="comment">         exe - the name of the executable to run</span></div><div class="line"><span class="comment">         dir - dir to use as the current working directory. (default=".")</span></div><div class="line"><span class="comment">         wait - the calling thread waits until the executable returns. </span></div><div class="line"><span class="comment">                (default="true")</span></div><div class="line"><span class="comment">         args - the arguments to pass to the program.  (default is none)</span></div><div class="line"><span class="comment">         env - environment variables to set.  (default is none)</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line">    <span class="comment">&lt;!-- This example shows how RunExecutableListener could be used</span></div><div class="line"><span class="comment">         with the script based replication...</span></div><div class="line"><span class="comment">         http://wiki.apache.org/solr/CollectionDistribution</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line">    <span class="comment">&lt;!--</span></div><div class="line"><span class="comment">       &lt;listener event="postCommit" class="solr.RunExecutableListener"&gt;</span></div><div class="line"><span class="comment">         &lt;str name="exe"&gt;solr/bin/snapshooter&lt;/str&gt;</span></div><div class="line"><span class="comment">         &lt;str name="dir"&gt;.&lt;/str&gt;</span></div><div class="line"><span class="comment">         &lt;bool name="wait"&gt;true&lt;/bool&gt;</span></div><div class="line"><span class="comment">         &lt;arr name="args"&gt; &lt;str&gt;arg1&lt;/str&gt; &lt;str&gt;arg2&lt;/str&gt; &lt;/arr&gt;</span></div><div class="line"><span class="comment">         &lt;arr name="env"&gt; &lt;str&gt;MYVAR=val1&lt;/str&gt; &lt;/arr&gt;</span></div><div class="line"><span class="comment">       &lt;/listener&gt;</span></div><div class="line"><span class="comment">      --&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">updateHandler</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="1-硬提交是提交数据持久化到磁盘里面。不过，比较耗费机器资源，这样即使jvm崩溃或者宕机，也不影响这部分索引。"><a href="#1-硬提交是提交数据持久化到磁盘里面。不过，比较耗费机器资源，这样即使jvm崩溃或者宕机，也不影响这部分索引。" class="headerlink" title="1.硬提交是提交数据持久化到磁盘里面。不过，比较耗费机器资源，这样即使jvm崩溃或者宕机，也不影响这部分索引。"></a>1.硬提交是提交数据持久化到磁盘里面。不过，比较耗费机器资源，这样即使jvm崩溃或者宕机，也不影响这部分索引。</h3><p>openSearcher: true  索引在searcher中可见, 但是也需要重新打开searcher才行。<br>openSearcher: false 索引在searcher中不可见。</p>
<p>按照下面的配置就会使用solr的自动硬提交功能，就不用我们自己手动提交。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">autoCommit</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--表示软提交达到1万条的时候会自动进行一次硬提交--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">maxDocs</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">maxDocs</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--表示软提交10秒之后会执行一次硬提交--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">maxTime</span>&gt;</span>10000<span class="tag">&lt;/<span class="name">maxTime</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!--true表示每一次硬提交都开启一个新的Searcher--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">openSearcher</span>&gt;</span>false<span class="tag">&lt;/<span class="name">openSearcher</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">autoCommit</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="2-软提交是提交数据到内存里面，并没有持久化到磁盘，但是他会把提交的记录写到tlog的日志文件里面所以如果jvm崩溃，那这部分索引就没了"><a href="#2-软提交是提交数据到内存里面，并没有持久化到磁盘，但是他会把提交的记录写到tlog的日志文件里面所以如果jvm崩溃，那这部分索引就没了" class="headerlink" title="2.软提交是提交数据到内存里面，并没有持久化到磁盘，但是他会把提交的记录写到tlog的日志文件里面所以如果jvm崩溃，那这部分索引就没了"></a>2.软提交是提交数据到内存里面，并没有持久化到磁盘，但是他会把提交的记录写到tlog的日志文件里面所以如果jvm崩溃，那这部分索引就没了</h3><p>下面就是自动软提交的配置，不需要自己维护提交（默认没有开启）：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">autoSoftCommit</span>&gt;</span> </div><div class="line">  <span class="comment">&lt;!--5秒执行一次软提交--&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">maxTime</span>&gt;</span>5000<span class="tag">&lt;/<span class="name">maxTime</span>&gt;</span> </div><div class="line"><span class="tag">&lt;/<span class="name">autoSoftCommit</span>&gt;</span></div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/10/29/solr-commit-types/" data-id="cj9fjlm2j0007b8f72cdj7538" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-solr-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/28/solr-install/" class="article-date">
  <time datetime="2017-10-28T02:57:27.000Z" itemprop="datePublished">2017-10-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/solr/">solr</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/28/solr-install/">solr的安装使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下面说说我的solr学习笔记之 solr6.5.0 + jetty + mysql 使用 DIH 搭建 solr 服务</p>
<p>参考：<a href="https://wiki.apache.org/solr/DIHQuickStart" target="_blank" rel="external">https://wiki.apache.org/solr/DIHQuickStart</a></p>
<p>首先下载solr，下载地址为：<a href="http://lucene.apache.org/solr/" target="_blank" rel="external">http://lucene.apache.org/solr/</a></p>
<p>截至写该笔记时，solr的版本为6.5.0，下载后，将其解压到任意一个目录。当然，目录路径不要有中文。</p>
<p>我解压到 E:\solr-6.5.0，目录结构如下：<br>bin<br>contrib<br>dist<br>docs<br>example<br>licenses<br>server<br>CHANGES.txt<br>LICENSE.txt<br>LUCENE_CHANGES.txt<br>NOTICE.txt<br>README.txt</p>
<p>solr的软件包，默认使用jetty部署，SOLR6要求JDK8，启动solr的命令很简单：<br>在DOS窗口中命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">E:\solr-6.5.0\bin\solr start</div></pre></td></tr></table></figure></p>
<p>然后在浏览器中可以访问：<br><a href="http://localhost:8983/solr" target="_blank" rel="external">http://localhost:8983/solr</a></p>
<p>在server/solr目录下，有一个README.txt的文件，其中说明了如何建立solr core。<br>最简单的建立是直接复制solr中为我们提供好的例子，打开server/solr/configsets目录会发现里面已经有三个例子，如下：<br>basic_configs<br>data_driven_schema_configs<br>sample_techproducts_configs</p>
<p>因为我们是要从数据库导入数据，所以选择以 “data_driven_schema_configs” 这个例子为模板创建我们的core: mysqlCore。<br>在DOS窗口中命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">E:\solr-6.5.0\bin\solr create -c mysqlCore -d data_driven_schema_configs</div></pre></td></tr></table></figure></p>
<p>说明：<br>-c: 指定创建的core为mysqlCore<br>-d：指定以data_driven_schema_configs为模板</p>
<p>执行上面的命令后在E:\solr-6.5.0\server\solr目录下会有一个文件夹mysqlCore</p>
<p>然后在浏览器中可以访问：<br><a href="http://localhost:8983/solr" target="_blank" rel="external">http://localhost:8983/solr</a></p>
<p>你会在[Core Selector]中看到mysqlCore，但是目前还不能使用DIH导入数据，需下面的设置。</p>
<p>建数据表，并插入3条记录，如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="comment">/*!32312 IF NOT EXISTS*/</span><span class="string">`test`</span> <span class="comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;</div><div class="line"></div><div class="line"><span class="keyword">USE</span> <span class="string">`test`</span>;</div><div class="line"></div><div class="line"><span class="comment">/*Table structure for table `user` */</span></div><div class="line"></div><div class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'用户id'</span>,</div><div class="line">  <span class="string">`name_`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'名字'</span>,</div><div class="line">  <span class="string">`age_`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span>,</div><div class="line">  <span class="string">`ability_`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'资格；等级'</span>,</div><div class="line">  <span class="string">`address_`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'详细地址'</span>,</div><div class="line">  <span class="string">`school1_`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学校1'</span>,</div><div class="line">  <span class="string">`school2_`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学校2'</span>,</div><div class="line">  <span class="string">`school3_`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'学校3'</span>,</div><div class="line">  <span class="string">`update_time_`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 <span class="keyword">COMMENT</span>=<span class="string">'用户表'</span>;</div><div class="line"></div><div class="line"><span class="comment">/*Data for the table `user` */</span></div><div class="line"></div><div class="line"><span class="keyword">insert</span>  <span class="keyword">into</span> <span class="string">`user`</span>(<span class="string">`id`</span>,<span class="string">`name_`</span>,<span class="string">`age_`</span>,<span class="string">`ability_`</span>,<span class="string">`address_`</span>,<span class="string">`school1_`</span>,<span class="string">`school2_`</span>,<span class="string">`school3_`</span>,<span class="string">`update_time_`</span>) </div><div class="line"><span class="keyword">values</span> </div><div class="line">(<span class="string">'1'</span>,<span class="string">'张三'</span>,<span class="number">20</span>,<span class="string">'初级工程师'</span>,<span class="string">'广东'</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="string">'2017-10-28 11:39:52'</span>),</div><div class="line">(<span class="string">'2'</span>,<span class="string">'李四'</span>,<span class="number">20</span>,<span class="string">'中级工程师'</span>,<span class="string">'湖南'</span>,<span class="string">'湖南实验小学'</span>,<span class="literal">NULL</span>,<span class="string">'湖南大学'</span>,<span class="string">'2017-10-28 11:39:51'</span>),</div><div class="line">(<span class="string">'3'</span>,<span class="string">'王五'</span>,<span class="number">40</span>,<span class="string">'高级工程师'</span>,<span class="string">'北京'</span>,<span class="string">'北京实验小学'</span>,<span class="string">'北京第一中学'</span>,<span class="string">'北京大学'</span>,<span class="string">'2017-10-28 11:39:53'</span>);</div></pre></td></tr></table></figure></p>
<p>为了使用mysql导入数据，我们还需要导入两个重要的jar包。由于mysql的jar包并没有在项目中，于是我复制了一份<br>放到了server/lib/ext目录下面了。我加的是mysql-connector-java-5.1.25.jar，如果你的是另外的版本，要修改下<br>面的lib中正则的部分。另外两个需要的jar包就是dist目录下带有“dataimport”标识的jar包。<br>然后打开mysqlCore/conf/solrconfig.xml，引用上面提到的jar包，如下。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/contrib/extraction/lib"</span> <span class="attr">regex</span>=<span class="string">".*\.jar"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-cell-\d.*\.jar"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/contrib/clustering/lib/"</span> <span class="attr">regex</span>=<span class="string">".*\.jar"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-clustering-\d.*\.jar"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/contrib/langid/lib/"</span> <span class="attr">regex</span>=<span class="string">".*\.jar"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-langid-\d.*\.jar"</span> /&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/contrib/velocity/lib"</span> <span class="attr">regex</span>=<span class="string">".*\.jar"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-velocity-\d.*\.jar"</span> /&gt;</span></div><div class="line">  </div><div class="line"><span class="comment">&lt;!-- 上面的lib为原本有的，下面的lib为添加的 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/dist/"</span> <span class="attr">regex</span>=<span class="string">"solr-dataimporthandler-.*\.jar"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">lib</span> <span class="attr">dir</span>=<span class="string">"$&#123;solr.install.dir:../../../..&#125;/server/lib/ext/"</span> <span class="attr">regex</span>=<span class="string">"mysql-connector-java-5.1.25.jar"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p>添加requestHandler<br>在mysqlCore/conf/solrconfig.xml，搜索<code>&lt;requestHandler name=&quot;/select&quot; class=&quot;solr.SearchHandler&quot;&gt;</code><br>然后在该行之上添加如下代码。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">requestHandler</span> <span class="attr">name</span>=<span class="string">"/dataimport"</span> <span class="attr">class</span>=<span class="string">"solr.DataImportHandler"</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">lst</span> <span class="attr">name</span>=<span class="string">"defaults"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">str</span> <span class="attr">name</span>=<span class="string">"config"</span>&gt;</span>db-data-config.xml<span class="tag">&lt;/<span class="name">str</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">lst</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">requestHandler</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>在mysqlCore/conf目录下新建db-data-config.xml, 内容如下。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dataConfig</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">name</span>=<span class="string">"ds"</span> <span class="attr">type</span>=<span class="string">"JdbcDataSource"</span> <span class="attr">driver</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></div><div class="line"><span class="tag">		<span class="attr">url</span>=<span class="string">"jdbc:mysql://localhost:3306/test"</span> <span class="attr">user</span>=<span class="string">"root"</span> <span class="attr">password</span>=<span class="string">"root"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">document</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">entity</span> <span class="attr">name</span>=<span class="string">"user"</span> <span class="attr">pk</span>=<span class="string">"id"</span> <span class="attr">dataSource</span>=<span class="string">"ds"</span> <span class="attr">query</span>=<span class="string">"select * from user"</span></span></div><div class="line"><span class="tag">			<span class="attr">deltaQuery</span>=<span class="string">"select id from user where update_time_&gt;'$&#123;dataimporter.last_index_time&#125;'"</span></span></div><div class="line"><span class="tag">			<span class="attr">deltaImportQuery</span>=<span class="string">"select t.* from user t where t.id='$&#123;dataimporter.delta.id&#125;'"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">column</span>=<span class="string">"id"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">column</span>=<span class="string">"name_"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">column</span>=<span class="string">"age_"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"ability"</span> <span class="attr">column</span>=<span class="string">"ability_"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">column</span>=<span class="string">"address_"</span> /&gt;</span></div><div class="line"></div><div class="line">			<span class="comment">&lt;!-- 将DB中的多个列，在solr中以数组形式存储到一个field中 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"schools"</span> <span class="attr">column</span>=<span class="string">"school1_"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"schools"</span> <span class="attr">column</span>=<span class="string">"school2_"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"schools"</span> <span class="attr">column</span>=<span class="string">"school3_"</span> /&gt;</span></div><div class="line"></div><div class="line">			<span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"update_time"</span> <span class="attr">column</span>=<span class="string">"update_time_"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">entity</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">document</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dataConfig</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>说明：<br>    dataSource是数据库数据源。Entity就是一张表对应的实体，pk是主键，query是查询语句。<br>    Field对应一个字段，column是数据库里的column名，后面的name属性对应着Solr的Filed的名字。<br>    其中test是数据库名，user是表名。</p>
<p>在mysqlCore/conf/managed-schema配置field信息，其中id的field本身已有。默认的 filed 不要删。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"age"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"ability"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"address"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"schools"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"update_time"</span> <span class="attr">type</span>=<span class="string">"date"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>由于修改了配置文件，所以要重启solr，命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">E:\solr-6.5.0&gt;bin\solr stop -all</div><div class="line">E:\solr-6.5.0&gt;bin\solr start</div></pre></td></tr></table></figure></p>
<p>然后在浏览器中可以访问：<br><a href="http://localhost:8983/solr" target="_blank" rel="external">http://localhost:8983/solr</a></p>
<p>点击[Core Selector]-&gt;mysqlCore-&gt;Dataimport在新的页面中按如下选择：<br>Command: full-import<br>Entity:user<br>Auto-Refresh Status<br>然后点[Execute]</p>
<p>成功后，点[Query]即可查询。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/10/28/solr-install/" data-id="cj9fjlm2p000ab8f7095hwgys" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-git-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/17/git-note/" class="article-date">
  <time datetime="2017-10-17T02:17:07.000Z" itemprop="datePublished">2017-10-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/17/git-note/">git常用操作</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="下面记录一些经常会用到的命令："><a href="#下面记录一些经常会用到的命令：" class="headerlink" title="下面记录一些经常会用到的命令："></a>下面记录一些经常会用到的命令：</h2><p>查看远程分支, 加上 -a 参数可以查看远程分支，远程分支会用红色表示出来（如果你开了颜色支持的话），不加 -a 则查看本地分支：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ git branch -a</div><div class="line">  dev</div><div class="line">* master</div><div class="line">  remotes/origin/HEAD -&gt; origin/master</div><div class="line">  remotes/origin/master</div><div class="line">  remotes/origin/prod</div></pre></td></tr></table></figure></p>
<p>删除远程分支和tag, 在Git v1.7.0 之后，可以使用这种语法删除远程分支：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git push origin --delete &lt;branchName&gt;</div></pre></td></tr></table></figure></p>
<p>删除tag这么用：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git push origin --delete tag &lt;tagname&gt;</div></pre></td></tr></table></figure></p>
<p>否则，可以使用这种语法，推送一个空分支到远程分支，其实就相当于删除远程分支：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git push origin :&lt;branchName&gt;</div></pre></td></tr></table></figure></p>
<p>这是删除tag的方法，推送一个空tag到远程tag：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git tag -d &lt;tagname&gt;</div><div class="line">$ git push origin :refs/tags/&lt;tagname&gt;</div></pre></td></tr></table></figure></p>
<p>两种语法作用完全相同。</p>
<p>将远程git仓库里的指定分支拉取到本地（本地不存在的分支）<br>当我想从远程仓库里拉取一条本地不存在的分支时：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git checkout -b 本地分支名 origin/远程分支名</div></pre></td></tr></table></figure></p>
<p>这个将会自动创建一个新的本地分支，并与指定的远程分支关联起来。</p>
<p>例如远程仓库里有个分支dev2,我本地没有该分支，我要把dev2拉到我本地：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git checkout -b dev2 origin/dev2</div></pre></td></tr></table></figure></p>
<p>若成功，将会在本地创建新分支dev2,并自动切到dev2上。<br>如果出现提示：</p>
<pre><code>fatal: Cannot update paths and switch to branch &apos;dev2&apos; at the same time.
Did you intend to checkout &apos;origin/dev2&apos; which can not be resolved as commit?
</code></pre><p>表示拉取不成功。我们需要先执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git fetch</div></pre></td></tr></table></figure></p>
<p>然后再执行下面的命令即可<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git checkout -b 本地分支名 origin/远程分支名</div></pre></td></tr></table></figure></p>
<p>Git 比较不同版本文件差异的常用命令格式：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ git diff	查看尚未暂存的文件中更新了哪些部分</div><div class="line">$ git diff filename	查看尚未暂存的某个文件更新了哪些部分</div><div class="line">$ git diff –cached	查看已经暂存起来的文件中和上次提交的版本之间的差异</div><div class="line">$ git diff –cached filename	查看已经暂存起来的某个文件和上次提交的版本之间的差异</div><div class="line">$ git diff &lt;commitId1&gt; &lt;commitId2&gt;	查看某两个版本之间的差异</div><div class="line">$ git diff &lt;commitId1&gt;:filename &lt;commitId2&gt;:filename	查看某两个版本的某个文件之间的差异，方式一</div><div class="line">$ git diff &lt;commitId1&gt; &lt;commitId2&gt; -- filename	查看某两个版本的某个文件之间的差异，方式二</div></pre></td></tr></table></figure></p>
<p>在git中查看历史的命令主要是git log，要查看某个文件的修改历史：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">log</span> -- begin.txt</div></pre></td></tr></table></figure></p>
<p>可以添加不同的选项让输出的内容或格式有所不同。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">log</span> -p -- begin.txt</div></pre></td></tr></table></figure></p>
<p>-p 选项可以输出每次提交中的diff， -p会把输出搞得很长、很乱，不容易找到重点。<br>还有另外一种方式是：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git <span class="built_in">log</span> --pretty=oneline -- filename</div></pre></td></tr></table></figure></p>
<p>在log 命令中加入 –pretty=oneline 选项只能看到comments，看不到提交的用户和日期。<br>这也能够让我们集中注意力快速找到关注的提交记录。</p>
<p>然后使用 git show命令查看完整的提交内容。</p>
<p>当然，除了命令行工具您也可以使用GUI程序查看文件的历史记录：<br>gitk filename</p>
<p>查看历史中的文件内容</p>
<p>当我们使用 git log 命令找到了某次提交，并且想看看这次提交时文件的完整内容。<br>这时，我们需要使用 git show 命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ git show &lt;commitId&gt;:filename</div></pre></td></tr></table></figure></p>
<p>也许此时你并不是看看就算了，你想要使用这个版本的文件更新工作区中的文件。<br>直接从 git show 命令的输出中拷贝内容是个不错的选择。<br>但也可以通过组合使用不同的命令来实现：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ git checkout &lt;commitId&gt; --filename</div><div class="line">$ git reset filename</div></pre></td></tr></table></figure></p>
<p>此时只有工作区被更新了(你也可以把他当做是一次回滚操作)。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/10/17/git-note/" data-id="cj9fjlm220000b8f7enke91jp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-markdown-learn-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/27/markdown-learn-note/" class="article-date">
  <time datetime="2017-09-27T08:56:35.000Z" itemprop="datePublished">2017-09-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/27/markdown-learn-note/">markdown 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>今天开始学习下 <strong>markdown</strong> 这种标记语言，我习惯了学习一门语言，会去看它的官方文档里面的语法说明，<strong>markdown</strong> 作者的官方网站：</p>
<p><a href="https://daringfireball.net/projects/markdown/syntax" title="点击将跳到目标页" target="_blank" rel="external">https://daringfireball.net/projects/markdown/syntax</a></p>
<p>极力推荐大家去看下。方便自己以后查看，摘录如下：</p>
<p>在 markdown 中插入 <code>&lt;br /&gt;</code>，只需在行尾添加 2 个空格，然后回车，即可</p>
<p>要使 markdown 中的#，<code>&gt;</code> 等，显示原义，只要在它们前置 4 个空格即可</p>
<h3 id="1-标题"><a href="#1-标题" class="headerlink" title="1. 标题"></a>1. 标题</h3><p>标题有1-6级，使用下面这种方式产生：</p>
<pre><code># This is an H1
## This is an H2
###### This is an H6
</code></pre><p><strong>Example as below:</strong>    </p>
<h1 id="This-is-an-H1"><a href="#This-is-an-H1" class="headerlink" title="This is an H1"></a>This is an H1</h1><h2 id="This-is-an-H2"><a href="#This-is-an-H2" class="headerlink" title="This is an H2"></a>This is an H2</h2><h6 id="This-is-an-H6"><a href="#This-is-an-H6" class="headerlink" title="This is an H6"></a>This is an H6</h6><hr>
<h3 id="2-blockquote"><a href="#2-blockquote" class="headerlink" title="2. blockquote"></a>2. blockquote</h3><p>blockquote 以 <code>&gt;</code> 开头，一段当中每一行的开头都加上，你也可以偷懒，只在段落的第一行加上，并且它可以 nested 其他<br>markdown 标记，</p>
<pre><code>&gt; This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,
&gt; consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.
&gt; Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.
&gt; 
&gt; Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse
&gt; id sem consectetuer libero luctus adipiscing.
</code></pre><p><strong>Example as below:</strong></p>
<blockquote>
<p>This is a blockquote with two paragraphs. Lorem ipsum dolor sit amet,<br>consectetuer adipiscing elit. Aliquam hendrerit mi posuere lectus.<br>Vestibulum enim wisi, viverra nec, fringilla in, laoreet vitae, risus.</p>
<p>Donec sit amet nisl. Aliquam semper ipsum sit amet velit. Suspendisse<br>id sem consectetuer libero luctus adipiscing.    </p>
</blockquote>
<p>blockquote 还可以 nested 其他 blockquote</p>
<pre><code>&gt; This is the first level of quoting.
&gt;
&gt; &gt; This is nested blockquote.
&gt;
&gt; Back to the first level.
</code></pre><p><strong>Example as below:</strong></p>
<blockquote>
<p>This is the first level of quoting.</p>
<blockquote>
<p>This is nested blockquote.</p>
</blockquote>
<p>Back to the first level.</p>
</blockquote>
<hr>
<h3 id="3-List"><a href="#3-List" class="headerlink" title="3. List"></a>3. List</h3><p>列表分为有序和无序</p>
<h4 id="3-1-无序列表写法如下："><a href="#3-1-无序列表写法如下：" class="headerlink" title="3.1 无序列表写法如下："></a>3.1 无序列表写法如下：</h4><pre><code>* Red
* Green
* Blue
</code></pre><p><strong>Example as below:</strong></p>
<ul>
<li>Red</li>
<li>Green</li>
<li>Blue</li>
</ul>
<h4 id="3-2-有序列表写法如下："><a href="#3-2-有序列表写法如下：" class="headerlink" title="3.2 有序列表写法如下："></a>3.2 有序列表写法如下：</h4><pre><code>1. Red
2. Green
3. Blue
</code></pre><p><strong>Example as below:</strong></p>
<ol>
<li>Red</li>
<li>Green</li>
<li>Blue</li>
</ol>
<p>其中的序号，不影响它的效果，你也可以像下面这样写，它的效果是一样的。</p>
<pre><code>1. Red
1. Green
1. Blue
或
1. Red
6. Green
8. Blue
</code></pre><p>List items may consist of multiple paragraphs. Each subsequent paragraph in a list item must be indented by either 4 spaces or one tab:</p>
<pre><code>1.  This is a list item with two paragraphs. Lorem ipsum dolor
    sit amet, consectetuer adipiscing elit. Aliquam hendrerit
    mi posuere lectus.

    Vestibulum enim wisi, viverra nec, fringilla in, laoreet
    vitae, risus. Donec sit amet nisl. Aliquam semper ipsum
    sit amet velit.

2.  Suspendisse id sem consectetuer libero luctus adipiscing.
</code></pre><p><strong>Example as below:</strong></p>
<ol>
<li><p>This is a list item with two paragraphs. Lorem ipsum dolor<br>sit amet, consectetuer adipiscing elit. Aliquam hendrerit<br>mi posuere lectus.</p>
<p>Vestibulum enim wisi, viverra nec, fringilla in, laoreet<br>vitae, risus. Donec sit amet nisl. Aliquam semper ipsum<br>sit amet velit.</p>
</li>
<li><p>Suspendisse id sem consectetuer libero luctus adipiscing.</p>
</li>
</ol>
<p>To put a code block within a list item, the code block needs<br>to be indented <em>twice</em> – 8 spaces or two tabs:</p>
<pre><code>* A list item with a code block:
        &lt;code goes here&gt;
</code></pre><p><strong>Example as below:</strong></p>
<ul>
<li>A list item with a code block:<pre><code>printf(&quot;hello world&quot;)
</code></pre></li>
</ul>
<hr>
<h3 id="4-CODE-BLOCKS"><a href="#4-CODE-BLOCKS" class="headerlink" title="4. CODE BLOCKS"></a>4. CODE BLOCKS</h3><p>To produce a code block in Markdown, simply indent every line of the block by at least 4 spaces or 1 tab. For example, given this input:</p>
<pre><code>This is a normal paragraph:
    This is a code block.
</code></pre><p><strong>Example as below:</strong><br>This is a normal paragraph:</p>
<pre><code>This is a code block.
</code></pre><hr>
<h3 id="5-HORIZONTAL-RULES"><a href="#5-HORIZONTAL-RULES" class="headerlink" title="5. HORIZONTAL RULES"></a>5. HORIZONTAL RULES</h3><p>产生水平分割线的方法有以下几种，它们的效果都是一样的</p>
<pre><code>* * * 
***
******
- - -
------
</code></pre><hr>
<h3 id="6-LINKS"><a href="#6-LINKS" class="headerlink" title="6. LINKS"></a>6. LINKS</h3><pre><code>This is [an example](http://example.com/ &quot;Title&quot;) inline link.

[This link](http://example.net/) has no title attribute.
</code></pre><p><strong>Example as below:</strong><br>This is <a href="http://example.com/" title="Title" target="_blank" rel="external">an example</a> inline link.</p>
<p><a href="http://example.net/" target="_blank" rel="external">This link</a> has no title attribute.</p>
<p>If you’re referring to a local resource on the same server, you can use relative paths:</p>
<pre><code>See my [About](/about/) page for details.   
</code></pre><p><strong>Example as below:</strong><br>See my <a href="/about/">About</a> page for details.</p>
<p>你还可以这样写 links<br>Reference-style links use a second set of square brackets, inside which you place a label of your choosing to identify the link:</p>
<pre><code>This is [an example][id] reference-style link.
</code></pre><p>Then, anywhere in the document, you define your link label like this, on a line by itself:</p>
<pre><code>[id]: http://example.com/  &quot;Optional Title Here&quot;
</code></pre><p><strong>Example as below:</strong><br>This is <a href="http://example.com/" title="Optional Title Here" target="_blank" rel="external">an example</a> reference-style link.</p>
<p>Link definition names may consist of letters, numbers, spaces, and punctuation — but they are not case sensitive. E.g. these two links:</p>
<pre><code>[link text][a]
[link text][A]
</code></pre><p>are equivalent.</p>
<p>The implicit link name shortcut allows you to omit the name of the link, in which case the link text itself is used as the name. Just use an empty set of square brackets — e.g., to link the word “Google” to the google.com web site, you could simply write:</p>
<pre><code>[Google][]
</code></pre><p>And then define the link:</p>
<pre><code>[Google]: http://google.com/
</code></pre><p><strong>Example as below:</strong><br>In china, you can’t use <a href="http://google.com/" target="_blank" rel="external">Google</a>, hahaha…</p>
<hr>
<h3 id="7-EMPHASIS"><a href="#7-EMPHASIS" class="headerlink" title="7. EMPHASIS"></a>7. EMPHASIS</h3><p>Markdown treats asterisks (<em>) and underscores (_) as indicators of emphasis. Text wrapped with one </em> or <em> will be wrapped with an HTML <em> tag; double *’s or </em>’s will be wrapped with an HTML <strong> tag. E.g., this input:</strong></em></p>
<pre><code>*single asterisks*
_single underscores_
**double asterisks**
__double underscores__
</code></pre><p>will produce:</p>
<pre><code>&lt;em&gt;single asterisks&lt;/em&gt;
&lt;em&gt;single underscores&lt;/em&gt;
&lt;strong&gt;double asterisks&lt;/strong&gt;
&lt;strong&gt;double underscores&lt;/strong&gt;
</code></pre><p><strong>Example as below:</strong><br><em>single asterisks</em><br><em>single underscores</em><br><strong>double asterisks</strong><br><strong>double underscores</strong></p>
<p>To produce a literal asterisk or underscore at a position where it would otherwise be used as an emphasis delimiter, you can backslash escape it:</p>
<pre><code>\*this text is surrounded by literal asterisks\*
</code></pre><hr>
<h3 id="8-CODE"><a href="#8-CODE" class="headerlink" title="8. CODE"></a>8. CODE</h3><p>To indicate a span of code, wrap it with backtick quotes (`). Unlike a pre-formatted code block, a code span indicates code within a normal paragraph. For example:</p>
<pre><code>Use the `printf()` function.
</code></pre><p>will produce:</p>
<pre><code>&lt;p&gt;Use the &lt;code&gt;printf()&lt;/code&gt; function.&lt;/p&gt;
</code></pre><p><strong>Example as below:</strong><br>Use the <code>printf()</code> function.</p>
<p>To include a literal backtick character within a code span, you can use multiple backticks as the opening and closing delimiters:</p>
<pre><code>``There is a literal backtick (`) here.``
</code></pre><p>which will produce this:</p>
<pre><code>&lt;p&gt;&lt;code&gt;There is a literal backtick (`) here.&lt;/code&gt;&lt;/p&gt;
</code></pre><p><strong>Example as below:</strong><br><code>There is a literal backtick (`) here.</code></p>
<p>Other code format:</p>
<pre><code>` `` java
    public static void main(String[] args) {
        System.out.println(&quot;hello world.&quot;);
    }
    注意：请将这里的`之间的空格去掉
` ``
</code></pre><p><strong>Example as below:</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	System.out.println(<span class="string">"hello world."</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="9-IMAGES"><a href="#9-IMAGES" class="headerlink" title="9. IMAGES"></a>9. IMAGES</h3><p>Inline image syntax looks like this:</p>
<pre><code>![Alt text](/path/to/img.jpg)
![Alt text](/path/to/img.jpg &quot;Optional title&quot;)
</code></pre><p><strong>Example as below:</strong><br><img src="http://www.apache.org/img/asf_logo.png" alt="Alt text" title="Optional title"></p>
<p>Reference-style image syntax looks like this:</p>
<pre><code>![Alt text][id]
</code></pre><p>Where “id” is the name of a defined image reference. Image references are defined using syntax identical to link references:</p>
<pre><code>[id]: url/to/image  &quot;Optional title attribute&quot;
</code></pre><hr>
<h3 id="10-MISCELLANEOUS"><a href="#10-MISCELLANEOUS" class="headerlink" title="10. MISCELLANEOUS"></a>10. MISCELLANEOUS</h3><p>AUTOMATIC LINKS</p>
<p>Markdown supports a shortcut style for creating “automatic” links for URLs and email addresses: simply surround the URL or email address with angle brackets. What this means is that if you want to show the actual text of a URL or email address, and also have it be a clickable link, you can do this:</p>
<pre><code>&lt;http://example.com/&gt;
</code></pre><p>Markdown will turn this into:</p>
<pre><code>&lt;a href=&quot;http://example.com/&quot;&gt;http://example.com/&lt;/a&gt;
</code></pre><p>BACKSLASH ESCAPES</p>
<p>Markdown allows you to use backslash escapes to generate literal characters which would otherwise have special meaning in Markdown’s formatting syntax. For example, if you wanted to surround a word with literal asterisks (instead of an HTML <em> tag), you can use backslashes before the asterisks, like this:</em></p>
<pre><code>\*literal asterisks\*
</code></pre><p>Markdown provides backslash escapes for the following characters:</p>
<pre><code>\   backslash
`   backtick
*   asterisk
_   underscore
{}  curly braces
[]  square brackets
()  parentheses
#   hash mark
+   plus sign
-   minus sign (hyphen)
.   dot
!   exclamation mark
</code></pre><p>创建表格语法如下：<br>| Tables        | Are           | Cool  |<br>| ————- |:————-:| —–:|<br>| col 3 is      | right-aligned | $1600 |<br>| col 2 is      | centered      |   $12 |<br>| zebra stripes | are neat      |    $1 |</p>
<p>Markdown 生成表格时，可以给一整列的单元格设置同样的对齐样式<br>| 第一列     | 第二列    | 第三列    |<br>| ——-:    | :——:    | :——-    |<br>| 右对齐    | 居中        | 左对齐    |</p>
<p>markdown 中特殊字符的显示方式：</p>
<table>
<thead>
<tr>
<th>原样显示</th>
<th style="text-align:left">书写方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>&#124;</td>
<td style="text-align:left"><code>&amp;#124;</code></td>
</tr>
<tr>
<td>&lt;</td>
<td style="text-align:left"><code>&amp;lt;</code></td>
</tr>
<tr>
<td>&le;</td>
<td style="text-align:left"><code>&amp;le;</code></td>
</tr>
<tr>
<td>&gt;</td>
<td style="text-align:left"><code>&amp;gt;</code></td>
</tr>
<tr>
<td>&ge;</td>
<td style="text-align:left"><code>&amp;ge;</code></td>
</tr>
<tr>
<td>#</td>
<td style="text-align:left"><code>\#</code></td>
</tr>
<tr>
<td>*</td>
<td style="text-align:left"><code>\*</code></td>
</tr>
<tr>
<td>2<sup>16</sup></td>
<td style="text-align:left"><code>2&lt;sup&gt;16&lt;/sup&gt;</code></td>
</tr>
</tbody>
</table>
<p>end.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/09/27/markdown-learn-note/" data-id="cj9fjlm2f0005b8f73gulyven" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ubuntu-learn-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/12/ubuntu-learn-note/" class="article-date">
  <time datetime="2017-09-12T12:41:37.000Z" itemprop="datePublished">2017-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/12/ubuntu-learn-note/">ubuntu 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Ubuntu安装ssh时出现软件包 openssh-server 还没有可供安装的候选者错误</p>
<p>错误如下：</p>
<p>sudo apt-get install opensshserver正在读取软件包列表…</p>
<p>完成正在分析软件包的依赖关系树正在读取状态信息…</p>
<p>完成现在没有可用的软件包 openssh-server，</p>
<p>但是他被其他的软件包引用了这可能意味着这个缺失的软件包可能已被废弃，或者只能在其他发布源中找到</p>
<p>E:软件包 openssh-server 还没有可供安装的候选者</p>
<p>解决方案：分析原因是我们的apt-get没有更新，当然如果你的是最新的系统不用更新也行，但是我相信很多人都是需要更新的吧，操作命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get update</div></pre></td></tr></table></figure></p>
<p>更新完毕后执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install openssh-server</div></pre></td></tr></table></figure></p>
<p>最后我们用命令ps -e|grep ssh 来看下open-server安装成功没有，如果出现如下截图红色标出的部分，说明安装成功了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ ps -e|grep ssh</div></pre></td></tr></table></figure></p>
<p>在ubuntu中的vi编辑器中怎么使用<br>默认情况下ubuntu上也安装有vi但是奇怪的是这个vi是vim-common版本，基本上用不了所以要先把这个版本的vi卸载掉才可以，卸载命令是<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get remove vim-common</div></pre></td></tr></table></figure></p>
<p>卸载成功之后接着执行 sudo apt-get install vim,安装好之后就能使用了</p>
<p>要检查特定的包，比如firefox是否安装了，使用这个命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ dpkg -s firefox</div><div class="line"></div><div class="line">ubuntu下useradd与adduser区别，新建用户不再home目录下</div><div class="line">useradd username不会在/home下建立一个文件夹username</div><div class="line">adduser username会在/home下建立一个文件夹username</div><div class="line">useradd -m username跟adduser一样，可以建立一个文件夹username</div></pre></td></tr></table></figure></p>
<p>永久性删除用户账号<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ userdel peter</div></pre></td></tr></table></figure></p>
<p>还有的就是文件编码的问题，在windows下默认都是用ANSI格式编码，但是在ubuntu下面可能会是其他格式的编码，如果两个系统的编码不一致，就会产生乱码。<br>最好是都采用UTF-8格式编码</p>
<p>ubuntu root默认密码（初始密码）<br>ubuntu安装好后，root初始密码（默认密码）不知道，需要设置。</p>
<p>1、先用安装时候的用户登录进入系统</p>
<p>2、输入：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo passwd</div></pre></td></tr></table></figure></p>
<p>按回车</p>
<p>3、输入新密码，重复输入密码，最后提示passwd：password updated sucessfully</p>
<p>此时已完成root密码的设置</p>
<p>4、输入：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ su root</div></pre></td></tr></table></figure></p>
<p>切换用户到root试试…….</p>
<p>如果执行./configure无法执行，<br>要安装：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install build-essential</div></pre></td></tr></table></figure></p>
<p>在ubuntu软件源里zlib和zlib-devel叫做zlib1g zlib1g.dev<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install zlib1g</div><div class="line">$ sudo apt-get install zlib1g.dev</div></pre></td></tr></table></figure></p>
<p>直接输入上述命令后还是不能安装。这就要求我们先装ruby.<br>在ubuntu里，zlib叫zlib1g，相应的zlib-devel叫zlib1g.dev。默认的安装源里没有zlib1g.dev。要在packages.ubuntu.com上找。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install ruby</div></pre></td></tr></table></figure></p>
<p>然后再装zlib1g-dev就可以了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install zlib1g-dev</div></pre></td></tr></table></figure></p>
<p>解决依赖包openssl安装，命令：<br>[cpp] view plain copy 在CODE上查看代码片派生到我的代码片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install openssl libssl-dev</div></pre></td></tr></table></figure></p>
<p>解决依赖包pcre安装，命令：<br>[cpp] view plain copy 在CODE上查看代码片派生到我的代码片<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install libpcre3 libpcre3-dev</div></pre></td></tr></table></figure></p>
<p>解决依赖包zlib安装，命令：<br>[cpp] view plain copy 在CODE上查看代码片派生到我的代码片<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo apt-get install zlib1g-dev</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/09/12/ubuntu-learn-note/" data-id="cj9fjlm2v000hb8f7sb0clhg2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-online-implementing" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/12/online-implementing/" class="article-date">
  <time datetime="2017-09-12T12:22:54.000Z" itemprop="datePublished">2017-09-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/12/online-implementing/">系统上线注意事项</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="上线总结："><a href="#上线总结：" class="headerlink" title="上线总结："></a>上线总结：</h2><p>今天下午准备上线，折腾了很久， 不过， 终于成功上线，期间发现了很多问题。所谓好记性，不如烂笔头，故记之。有时候，系统上线，如果发现还是旧的页面，可能会是缓存，这时候，要检查下下面的地方：</p>
<h3 id="1-你浏览器的缓存是否已经清掉了；"><a href="#1-你浏览器的缓存是否已经清掉了；" class="headerlink" title="1. 你浏览器的缓存是否已经清掉了；"></a>1. 你浏览器的缓存是否已经清掉了；</h3><h3 id="2-Tomcat-的缓存是否清掉了-TOMCAT-HOME-work-这个目录，放的就是-Tomcat-的缓存；"><a href="#2-Tomcat-的缓存是否清掉了-TOMCAT-HOME-work-这个目录，放的就是-Tomcat-的缓存；" class="headerlink" title="2. Tomcat 的缓存是否清掉了 ${TOMCAT_HOME}/work 这个目录，放的就是 Tomcat 的缓存；"></a>2. Tomcat 的缓存是否清掉了 ${TOMCAT_HOME}/work 这个目录，放的就是 Tomcat 的缓存；</h3><h3 id="3-如果-IP-PORT-访问，没问题的话，有可能是-CDN-缓存了，这时候也要刷下-CDN；"><a href="#3-如果-IP-PORT-访问，没问题的话，有可能是-CDN-缓存了，这时候也要刷下-CDN；" class="headerlink" title="3. 如果 IP + PORT 访问，没问题的话，有可能是 CDN 缓存了，这时候也要刷下 CDN；"></a>3. 如果 IP + PORT 访问，没问题的话，有可能是 CDN 缓存了，这时候也要刷下 CDN；</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/09/12/online-implementing/" data-id="cj9fjlm2i0006b8f7161ubrl9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-install-hexo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/11/install-hexo/" class="article-date">
  <time datetime="2017-09-11T08:29:25.597Z" itemprop="datePublished">2017-09-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/11/install-hexo/">安装 Hexo</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
<h2 id="下面将详细说说安装过程："><a href="#下面将详细说说安装过程：" class="headerlink" title="下面将详细说说安装过程："></a>下面将详细说说安装过程：</h2><h3 id="1-安装-Git-略"><a href="#1-安装-Git-略" class="headerlink" title="1. 安装 Git 略"></a>1. 安装 Git 略</h3><h3 id="2-安装-Node-js-略"><a href="#2-安装-Node-js-略" class="headerlink" title="2. 安装 Node.js 略"></a>2. 安装 Node.js 略</h3><h3 id="3-安装Hexo"><a href="#3-安装Hexo" class="headerlink" title="3. 安装Hexo"></a>3. 安装Hexo</h3><p>在桌面空白处右键打开Git Bash Here，可以先测试一下Node.js是否安装成功，直接输入node可以看到提示符变成了一个向右<br>的箭头就表示成功了，然后按ctrl + c退出node模式，出现$符号才表示正常了</p>
<p>输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install -g hexo-cli</div></pre></td></tr></table></figure></p>
<p>敲完回车可能没有任何提示，请一定要耐心等待<br>安装成功后，可以输入以下命令测试一下Hexo是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo version</div></pre></td></tr></table></figure></p>
<p>如果能看到hexo的版本号信息，就表示安装成功了<br>接下来，进入到我们刚刚创建的文件夹，右键打开Git Bash Here</p>
<p>然后依次输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ hexo init  <span class="comment"># 注意此命令，要求当前仓库为空，可以先将仓库的文件移走，再执行此命令，然后再移回来</span></div><div class="line">$ npm install</div><div class="line">$ hexo g</div><div class="line">$ hexo s</div></pre></td></tr></table></figure></p>
<p>这时候在浏览器输入<a href="http://localhost:4000/" target="_blank" rel="external">http://localhost:4000/</a> 就可以看到hexo已经成功生成了博客，当然这只是我们本地可以看到的</p>
<p>配置Hexo到Github</p>
<p>找到我们刚刚创建的文件夹，在里面找到_config.yml文件，用notepad++打开，直接拖到最后，添加如下：</p>
<pre><code>deploy:
  type: git
  repository: git@github.com:hewentian/hewentian.github.io.git
  branch: master
</code></pre><p>发布到 github<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ hexo clean</div><div class="line">$ hexo g</div><div class="line">$ hexo d</div></pre></td></tr></table></figure></p>
<p>如果出现以下异常</p>
<pre><code>ERROR Deployer not found: git
</code></pre><p>尝试输入以下命令，然后重新执行刚刚的两条命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ npm install hexo-deployer-git --save</div></pre></td></tr></table></figure></p>
<p>这时候我们就可以在浏览器输入 <a href="https://hewentian.github.io" target="_blank" rel="external">https://hewentian.github.io</a> 就可以看到博客已经搭建成功了。</p>
<p>使用以下命令验证是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ node -v</div><div class="line">$ npm -v</div><div class="line">$ hexo -v</div></pre></td></tr></table></figure></p>
<p>解释一下：<br>node_modules：是依赖包<br>public：存放的是生成的页面<br>scaffolds：命令生成文章等的模板<br>source：用命令创建的各种文章<br>themes：主题<br>_config.yml：整个博客的配置<br>db.json：source解析所得到的<br>package.json：项目所需模块项目的配置信息</p>
<p>添加博文<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hexo new <span class="string">"postName"</span>  <span class="comment">#新建博文,其中postName是博文题目</span></div></pre></td></tr></table></figure></p>
<p>博文会自动生成在博客目录下source/_posts/postName.md</p>
<p>注意事项</p>
<p>所有键的冒号后面留一个空格，如 <code>language: zh-CN</code></p>
<p>一些常用命令：<br>hexo new “postName” #新建文章<br>hexo new page “pageName” #新建页面<br>hexo generate #生成静态页面至public目录, hexo g<br>hexo server #开启预览访问端口（默认端口4000，’ctrl + c’关闭server）, hexo s<br>hexo deploy #将.deploy目录部署到GitHub, hexo d<br>hexo help # 查看帮助<br>hexo version #查看Hexo的版本</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/09/11/install-hexo/" data-id="cj9fjlm280002b8f7uhez5bsx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-tomcat-set-username-password" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/11/tomcat-set-username-password/" class="article-date">
  <time datetime="2017-09-11T02:21:02.000Z" itemprop="datePublished">2017-09-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tomcat/">tomcat</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/11/tomcat-set-username-password/">tomcat 登录用户名 与 密码设置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">403 Access Denied</div><div class="line"></div><div class="line">You are not authorized to view this page.</div><div class="line"></div><div class="line">If you have already configured the Host Manager application to allow access and you have used your browsers back button, used a saved book-mark or similar then you may have triggered the cross-site request forgery (CSRF) protection that has been enabled for the HTML interface of the Host Manager application. You will need to reset this protection by returning to the main Host Manager page. Once you return to this page, you will be able to continue using the Host Manager application's HTML interface normally. If you continue to see this access denied message, check that you have the necessary permissions to access this application.</div><div class="line"></div><div class="line">If you have not changed any configuration files, please examine the file conf/tomcat-users.xml in your installation. That file must contain the credentials to let you use this webapp.</div><div class="line"></div><div class="line">For example, to add the admin-gui role to a user named tomcat with a password of s3cret, add the following to the config file listed above.</div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcat"</span> <span class="attr">password</span>=<span class="string">"s3cret"</span> <span class="attr">roles</span>=<span class="string">"admin-gui"</span>/&gt;</span></div><div class="line"></div><div class="line">Note that for Tomcat 7 onwards, the roles required to use the host manager application were changed from the single admin role to the following two roles. You will need to assign the role(s) required for the functionality you wish to access.</div><div class="line"></div><div class="line">admin-gui - allows access to the HTML GUI</div><div class="line">admin-script - allows access to the text interface</div><div class="line">The HTML interface is protected against CSRF but the text interface is not. To maintain the CSRF protection:</div><div class="line"></div><div class="line">Users with the admin-gui role should not be granted the admin-script role.</div><div class="line">If the text interface is accessed through a browser (e.g. for testing since this interface is intended for tools not humans) then the browser must be closed afterwards to terminate the session.</div></pre></td></tr></table></figure>
<p>Tomcat Manager是Tomcat自带的、用于对Tomcat自身以及部署在Tomcat上的应用进行管理的web应用。<br>在默认情况下，Tomcat Manager是处于禁用状态的。准确地说，Tomcat Manager需要以用户角色进行<br>登录并授权才能使用相应的功能，不过Tomcat并没有配置任何默认的用户，因此需要我们进行相应的<br>用户配置之后才能使用Tomcat Manager。</p>
<p>在使用Tomcat时，我们通过点击 <a href="http://localhost:8080/" target="_blank" rel="external">http://localhost:8080/</a> 下面的【Host Manager】可以管理Tomcat服务器中的web工程；</p>
<p>设置用户名、有密码的方法：</p>
<p>1、登录用户名和密码我们需要在 目录：${TOMCAT_HOME}/conf/tomcat-users.xml 中修改如下配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">"admin-gui"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">"tomcat"</span> <span class="attr">password</span>=<span class="string">"s3cret"</span> <span class="attr">roles</span>=<span class="string">"admin-gui"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>2、进入当前目录下的：context.xml 文件，并作如下修改（其实这一步，可以省略的）<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;  </div><div class="line">    <span class="tag">&lt;<span class="name">WatchedResource</span>&gt;</span>WEB-INF/web.xml<span class="tag">&lt;/<span class="name">WatchedResource</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">Manager</span> <span class="attr">pathname</span>=<span class="string">"/manager"</span> <span class="attr">debug</span>=<span class="string">"0"</span>  <span class="attr">privileged</span>=<span class="string">"true"</span> <span class="attr">docBase</span>=<span class="string">"$&#123;TOMCAT_HOME&#125;/webapps/manager"</span> /&gt;</span>      </div><div class="line">    <span class="tag">&lt;<span class="name">Valve</span> <span class="attr">className</span>=<span class="string">"org.apache.catalina.valves.CometConnectionManagerValve"</span> /&gt;</span>    </div><div class="line"><span class="tag">&lt;/<span class="name">Context</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>完成这两步之后，重启tomcat ，输入刚才设置的用户名和密码，即可登录Tomcat 管理web project</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/09/11/tomcat-set-username-password/" data-id="cj9fjlm2t000eb8f7bpafvewe" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tomcat/">tomcat</a></li></ul>

    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/solr/">solr</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tomcat/">tomcat</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">5</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/29/solr-note/">solr学习笔记</a>
          </li>
        
          <li>
            <a href="/2017/10/29/solr-commit-types/">solr提交索引的三种方式</a>
          </li>
        
          <li>
            <a href="/2017/10/28/solr-install/">solr的安装使用</a>
          </li>
        
          <li>
            <a href="/2017/10/17/git-note/">git常用操作</a>
          </li>
        
          <li>
            <a href="/2017/09/27/markdown-learn-note/">markdown 学习笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>