<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Tim Ho&#39;s Technology Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="my personal blog">
<meta property="og:type" content="website">
<meta property="og:title" content="Tim Ho&#39;s Technology Blog">
<meta property="og:url" content="https://github.com/hewentian/page/3/index.html">
<meta property="og:site_name" content="Tim Ho&#39;s Technology Blog">
<meta property="og:description" content="my personal blog">
<meta property="og:locale" content="en-US">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Tim Ho&#39;s Technology Blog">
<meta name="twitter:description" content="my personal blog">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tim Ho&#39;s Technology Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">心如止水</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives/">Archives</a>
        
          <a class="main-nav-link" href="/categories/">Categories</a>
        
          <a class="main-nav-link" href="/tags/">Tags</a>
        
          <a class="main-nav-link" href="/about/">About</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/hewentian"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-install-jdk" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/08/install-jdk/" class="article-date">
  <time datetime="2017-12-08T03:44:06.000Z" itemprop="datePublished">2017-12-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/08/install-jdk/">安装 JDK</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="下面分别说说在Windows和Linux平台下面安装JDK"><a href="#下面分别说说在Windows和Linux平台下面安装JDK" class="headerlink" title="下面分别说说在Windows和Linux平台下面安装JDK"></a>下面分别说说在<code>Windows</code>和<code>Linux</code>平台下面安装<code>JDK</code></h2><h3 id="1-在Windows下面安装JDK"><a href="#1-在Windows下面安装JDK" class="headerlink" title="1.在Windows下面安装JDK"></a>1.在<code>Windows</code>下面安装<code>JDK</code></h3><pre><code>JDK环境变量配置的步骤如下：
1. 我的电脑 -&gt; 属性 -&gt; 高级 -&gt; 环境变量；
2. 配置用户变量：
    a.新建 JAVA_HOME
    C:\Program Files\Java\jdk1.8.0_101 （JDK的安装路径，务必替换成你自已的）
    b.新建 PATH（如果系统本身已有，则修改，加入下面的代码）
    %JAVA_HOME%\bin;%JAVA_HOME%\jre\bin
    c.新建 CLASSPATH
    .;%JAVA_HOME%\lib;%JAVA_HOME%\lib\tools.jar
3. 测试环境变量配置是否成功：
    开始 -&gt; 运行 -&gt; cmd
    键盘敲入: java
出现相应的命令，而不是出错信息，即表示配置成功！
</code></pre><p>环境变量配置的理解：</p>
<ol>
<li>PATH：作用是指定命令搜索路径，在命令行下面执行命令如：<code>javac</code>编译<code>java</code>程序时，它会到<code>PATH</code>变量所指定的路径中查找看是否能找到相应的命令程序。我们需要把<code>jdk</code>安装目录下的<code>bin</code>目录增加到现有的<code>PATH</code>变量中，<code>bin</code>目录中包含经常要用到的可执行文件如<code>javac/java/javadoc</code>等待，设置好<code>PATH</code>变量后，就可以在任何目录下执行<code>javac/java</code>等工具了；</li>
<li>CLASSPATH：作用是指定类搜索路径，要使用已经编写好的类，前提当然是能够找到它们了，<code>JVM</code>就是通过<code>CLASSPTH</code>来寻找类的。我们需要把<code>jdk</code>安装目录下的<code>lib子</code>目录中的<code>dt.jar</code>和<code>tools.jar</code>设置到<code>CLASSPATH</code>中，当然，当前目录“<code>.</code>”也必须加入到该变量中；</li>
<li>JAVA_HOME：它指向<code>jdk</code>的安装目录，<code>Eclipse/NetBeans/Tomcat</code>等软件就是通过搜索<code>JAVA_HOME</code>变量来找到并使用安装好的<code>jdk</code>。</li>
</ol>
<h3 id="2-在Linux下面安装JDK"><a href="#2-在Linux下面安装JDK" class="headerlink" title="2.在Linux下面安装JDK"></a>2.在<code>Linux</code>下面安装<code>JDK</code></h3><p>第一步：下载<code>jdk-8u102-linux-x64.tar.gz</code><br>直接在<code>ORACLE</code>的官网中下载就可以:<br><a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="noopener">http://www.oracle.com/technetwork/java/javase/downloads/index.html</a><br>PS：要注意系统版本的选择，32位 还是 64位，执行如下命令即可知道答案<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ uname -a</span><br><span class="line">Linux hewentian-Lenovo-IdeaPad-Y470 4.10.0-28-generic <span class="comment">#32~16.04.2-Ubuntu SMP Thu Jul 20 10:19:48 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure></p>
<p>第二步：解压安装<br>接着就是解压<code>tar.gz</code>的文件了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/Downloads</span><br><span class="line">$ tar -xzvf jdk-8u102-linux-x64.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>解压后会得到<code>jdk1.8.0_102</code>文件夹，接着就是将解压出来的文件夹移动到<code>/usr/local</code>的目录下<br>在这之前当然需要你拥有root的权限<code>su root</code>(对于ubuntu)再输入root账户的密码，做好这些准备之后，我们就可以把jdk的文件移动到我们想要的位置了。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ su root</span><br><span class="line">Password: </span><br><span class="line">$ mv jdk1.8.0_102 /usr/<span class="built_in">local</span></span><br></pre></td></tr></table></figure></p>
<p>第三步：修改环境变量，若<code>PATH</code>已存在，则用冒号作间隔，将jdk的bin目录地址加上，这样java的环境变量将配置成功了，配置完成如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile </span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_102</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$JAVA_HOME</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib:<span class="variable">$JRE_HOME</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$JRE_HOME</span>/bin:<span class="variable">$JAVA_HOME</span>:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure></p>
<p>记得保存 后执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>第四步：但这样默认使用的JDK可能还不是我们刚才安装的，因为ubuntu可能还会有默认的jdk，如openjdk；所以，为了使默认使用的是我们安装的jdk，还需执行如下命令：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo update-alternatives --install /usr/bin/java java /usr/<span class="built_in">local</span>/jdk1.8.0_102/bin/java 300  </span><br><span class="line">$ sudo update-alternatives --install /usr/bin/javac javac /usr/<span class="built_in">local</span>/jdk1.8.0_102/bin/javac 300    </span><br><span class="line"></span><br><span class="line">$ sudo update-alternatives --config java</span><br><span class="line">$ sudo update-alternatives --config javac</span><br><span class="line">这时如果有多个jdk的话（比如openJDK和SUN JDK），就会出来一个列表，当前默认的会在列表前面有一个<span class="string">"`*`"</span>号，</span><br><span class="line">这时我们就要选择我们刚装的SUN JDK的java的那个序号，输入这个序号，回车就行了。</span><br></pre></td></tr></table></figure></p>
<p>第五步：成功执行命令后，我们安装的JDK就是系统默认的了，执行如下命令，就可以成功看到JDK的相关信息了如：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ java -version　</span><br><span class="line">java version <span class="string">"1.8.0_102"</span></span><br><span class="line">Java(TM) SE Runtime Environment (build 1.8.0_102-b14)</span><br><span class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.102-b14, mixed mode)</span><br></pre></td></tr></table></figure></p>
<p>第六步：在ubuntu下面，可能root用户无法使用JDK，这样的话，执行下面的配置：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ vi /root/.bashrc</span><br><span class="line"></span><br><span class="line">在文件中加上(注意，下面的变量参数有<span class="variable">$&#123;&#125;</span>的，与上面的不同)</span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/usr/<span class="built_in">local</span>/jdk1.8.0_102</span><br><span class="line"><span class="built_in">export</span> JRE_HOME=<span class="variable">$&#123;JAVA_HOME&#125;</span>/jre</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib:<span class="variable">$&#123;JRE_HOME&#125;</span>/lib:<span class="variable">$CLASSPATH</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin:<span class="variable">$&#123;JRE_HOME&#125;</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">最后：</span><br><span class="line"><span class="built_in">source</span> /root/.bashrc</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/08/install-jdk/" data-id="cjoo8xasl000tu23kx6gqtzk8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/jdk/">jdk</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mysql-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/07/mysql-note/" class="article-date">
  <time datetime="2017-12-07T02:26:13.000Z" itemprop="datePublished">2017-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/db/">db</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/07/mysql-note/">mysql 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="mysql-查询重复数据"><a href="#mysql-查询重复数据" class="headerlink" title="mysql 查询重复数据"></a>mysql 查询重复数据</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c <span class="keyword">FROM</span> user_table <span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name <span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>当查询几个列的组合的时候，可以这样<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(first_name, <span class="string">'_'</span>, last_name) <span class="keyword">AS</span> user_name, <span class="keyword">COUNT</span>(*) <span class="keyword">AS</span> c </span><br><span class="line"><span class="keyword">FROM</span> user_table </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_name </span><br><span class="line"><span class="keyword">HAVING</span> c &gt; <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<p>当使用<code>CONCAT(str1,str2,...)</code>函数的时候，只要有一个参数为<code>null</code>，则整个结果为<code>null</code>，而有时候这不是我们所想要的结果，这时候，我们可以使用<code>IFNULL(expr1,expr2)</code>函数来做一个转换，当<code>expr1</code>为<code>null</code>的时候，表达式的结果为<code>expr2</code>，否则为<code>expr1</code>，示例如下：<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SELECT CONCAT('Tim', ' ', 'Ho') FROM DUAL;	# Tim Ho</span><br><span class="line">SELECT IFNULL(null, 'expr2') FROM DUAL;		# expr2</span><br><span class="line">SELECT IFNULL('expr1', 'expr2') FROM DUAL;	# expr1</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-添加唯一约束"><a href="#mysql-添加唯一约束" class="headerlink" title="mysql 添加唯一约束"></a>mysql 添加唯一约束</h3><p>表<code>t_user</code>结构如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Field        Type          Collation        Null    Key     Default            Extra           Privileges                       <span class="keyword">Comment</span>               </span><br><span class="line"><span class="comment">-----------  ------------  ---------------  ------  ------  -----------------  --------------  -------------------------------  ----------------------</span></span><br><span class="line"><span class="keyword">id</span>           <span class="built_in">int</span>(<span class="number">11</span>)       (<span class="literal">NULL</span>)           <span class="keyword">NO</span>      PRI     (<span class="literal">NULL</span>)             auto_increment  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  用户<span class="keyword">ID</span>              </span><br><span class="line">login_name   <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录名             </span><br><span class="line">passwd       <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  <span class="keyword">NO</span>              (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  登录密码          </span><br><span class="line">nick_name    <span class="built_in">varchar</span>(<span class="number">100</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  别名                </span><br><span class="line">gender       tinyint(<span class="number">4</span>)    (<span class="literal">NULL</span>)           YES             <span class="number">1</span>                                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  性别：<span class="number">1.</span>男；<span class="number">2.</span>女</span><br><span class="line">phone        <span class="built_in">varchar</span>(<span class="number">20</span>)   utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  手机号码          </span><br><span class="line">address      <span class="built_in">varchar</span>(<span class="number">255</span>)  utf8_general_ci  YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  地址                </span><br><span class="line">create_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             <span class="keyword">CURRENT_TIMESTAMP</span>                  <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  创建时间          </span><br><span class="line">update_time  <span class="keyword">timestamp</span>     (<span class="literal">NULL</span>)           YES             (<span class="literal">NULL</span>)                             <span class="keyword">select</span>,<span class="keyword">insert</span>,<span class="keyword">update</span>,<span class="keyword">references</span>  修改时间</span><br></pre></td></tr></table></figure></p>
<p>给 login_name 和 phone 添加联合唯一约束<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>你也可以在创建唯一约束的时候，给唯一约束起名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (login_name, phone);</span><br></pre></td></tr></table></figure></p>
<p>查看结果：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> t_user;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'用户ID'</span>,</span><br><span class="line">  <span class="string">`login_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录名'</span>,</span><br><span class="line">  <span class="string">`passwd`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'登录密码'</span>,</span><br><span class="line">  <span class="string">`nick_name`</span> <span class="built_in">varchar</span>(<span class="number">100</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'别名'</span>,</span><br><span class="line">  <span class="string">`gender`</span> tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="string">'1'</span> <span class="keyword">COMMENT</span> <span class="string">'性别：1.男；2.女'</span>,</span><br><span class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'手机号码'</span>,</span><br><span class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'地址'</span>,</span><br><span class="line">  <span class="string">`create_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line">  <span class="string">`update_time`</span> <span class="keyword">timestamp</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'修改时间'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`uk_login_name_phone`</span> (<span class="string">`login_name`</span>,<span class="string">`phone`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">2</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</span><br></pre></td></tr></table></figure></p>
<p>删除唯一约束:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> t_user <span class="keyword">DROP</span> <span class="keyword">INDEX</span> uk_login_name_phone;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="MySQL中GROUP-CONCAT函数"><a href="#MySQL中GROUP-CONCAT函数" class="headerlink" title="MySQL中GROUP_CONCAT函数"></a>MySQL中GROUP_CONCAT函数</h3><p>参考：<a href="http://hchmsguo.iteye.com/blog/555543" target="_blank" rel="noopener">http://hchmsguo.iteye.com/blog/555543</a><br>完整的语法如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GROUP_CONCAT([DISTINCT] 要连接的字段 [Order BY ASC/DESC 排序字段] [Separator '分隔符'])</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>基本查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> aa;  </span><br><span class="line"></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| id| name |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|1 | 10|</span><br><span class="line">|1 | 20|</span><br><span class="line">|1 | 20|</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200 |</span><br><span class="line">|3 | 500 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔(默认)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">group_concat</span>(<span class="keyword">name</span>) <span class="keyword">from</span> aa <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;  </span><br><span class="line"></span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">| id| group_concat(name) |</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">|1 | 10,20,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500|</span><br><span class="line">+<span class="comment">------+--------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，分号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">group_concat</span>(<span class="keyword">name</span> separator <span class="string">';'</span>) <span class="keyword">from</span> aa <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;  </span><br><span class="line"></span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">| id| group_concat(name separator ';') |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">|1 | 10;20;20 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 200;500 |</span><br><span class="line">+<span class="comment">------+----------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把去冗余的name字段的值打印在一行，逗号分隔</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">group_concat</span>(<span class="keyword">distinct</span> <span class="keyword">name</span>) <span class="keyword">from</span> aa <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;  </span><br><span class="line"></span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">| id| group_concat(distinct name) |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">|1 | 10,20|</span><br><span class="line">|2 | 20 |</span><br><span class="line">|3 | 200,500 |</span><br><span class="line">+<span class="comment">------+-----------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>以id分组，把name字段的值打印在一行，逗号分隔，以name排倒序</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,<span class="keyword">group_concat</span>(<span class="keyword">name</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">name</span> <span class="keyword">desc</span>) <span class="keyword">from</span> aa <span class="keyword">group</span> <span class="keyword">by</span> <span class="keyword">id</span>;  </span><br><span class="line"></span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">| id| group_concat(name order by name desc) |</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">|1 | 20,20,10 |</span><br><span class="line">|2 | 20|</span><br><span class="line">|3 | 500,200|</span><br><span class="line">+<span class="comment">------+---------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="GROUP-CONCAT使用及报错分析"><a href="#GROUP-CONCAT使用及报错分析" class="headerlink" title="GROUP_CONCAT使用及报错分析"></a>GROUP_CONCAT使用及报错分析</h3><p>函数GROUP_CONCAT，但在使用时，结果报了如下错误。</p>
<pre><code>ERROR 1260 (HY000): Row 17 was cut by GROUP_CONCAT()
</code></pre><p>原因：GROUP_CONCAT截断了结果，GROUP_CONCAT有个最大长度的限制，超过最大长度就会被截断掉。可以用下面命令查看其内存限制。<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> @@global.group_concat_max_len;</span><br><span class="line"></span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">| @@global.group_concat_max_len |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br><span class="line">|                      1024     |</span><br><span class="line">+<span class="comment">-------------------------------+</span></span><br></pre></td></tr></table></figure></p>
<p>1024这就是一般MySQL系统默认的最大长度，解决限制方法有二：<br>方法一：在MySQL配置文件中加上<br>group_concat_max_len = 102400 #你要的最大长度</p>
<p>方法二：可以简单一点，执行语句：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> group_concat_max_len=<span class="number">102400</span>;</span><br></pre></td></tr></table></figure></p>
<p>我是用方法一解决的</p>
<h3 id="对连接要注意的事项"><a href="#对连接要注意的事项" class="headerlink" title="对连接要注意的事项"></a>对连接要注意的事项</h3><p>当用多个值连接起来产生一个MD5值、或其他用于确定唯一性的时候，几个值之间一定要加分隔符，否则不同记录可能会产生一样的MD5值。如下表：</p>
<pre><code>NAME    AGE    FAMLY_NUM
张三    51    5
李四    5    15
</code></pre><p>如果用AGE， FAMLY_NUM来产生一个MD5值来唯一确定这一条记录，在它们之间一定要加分隔符，否则连接结果都是515</p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>在MYSQL中用<code>数据库管理员</code>用户创建了一个db，其他MYSQL用户是暂时看不到的，除非得到<code>数据库管理员</code>用户的授权<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> bfg_db <span class="keyword">COLLATE</span> = <span class="string">'utf8_general_ci'</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = <span class="string">'utf8'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'%'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'iE1zNB?A91*YbQ9hK'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">GRANT</span> ALL <span class="keyword">ON</span> bfg_db.* <span class="keyword">TO</span> <span class="string">'bfg_user'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'iE1zNB?A91*YbQ9hK'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">FLUSH</span> <span class="keyword">PRIVILEGES</span>;</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql添加、删除主键"><a href="#mysql添加、删除主键" class="headerlink" title="mysql添加、删除主键"></a>mysql添加、删除主键</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">添加自增长的主键id</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">删除自增长的主键id，先删除自增长，再删除主键</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">CHANGE</span> <span class="keyword">id</span> <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>); //删除自增长</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tb <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>; //删除主建</span><br></pre></td></tr></table></figure>
<h3 id="mysql查找删除重复数据并只保留一条"><a href="#mysql查找删除重复数据并只保留一条" class="headerlink" title="mysql查找删除重复数据并只保留一条"></a>mysql查找删除重复数据并只保留一条</h3><p>有表数据如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">|    3 | zhang |   23 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>从上面可知，name字段有两条相同的记录zhang，我们要删除重复记录,保存id最小的一条<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	t_user </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	<span class="keyword">name</span> <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> t1.name <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">COUNT</span>( * ) &gt; <span class="number">1</span> ) t1 ) </span><br><span class="line">	<span class="keyword">AND</span> </span><br><span class="line">	<span class="keyword">id</span> <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> t2.id <span class="keyword">FROM</span> ( <span class="keyword">SELECT</span> <span class="keyword">min</span>( <span class="keyword">id</span> ) <span class="keyword">id</span> <span class="keyword">FROM</span> t_user <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">name</span> <span class="keyword">HAVING</span> <span class="keyword">count</span>( * ) &gt; <span class="number">1</span> ) t2 );</span><br><span class="line">	</span><br><span class="line">然后再执行查询语句：</span><br><span class="line">mysql&gt; select * from t_user;</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | name  | age  |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 | zhang |   21 |</span><br><span class="line">|    2 | li    |   22 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可知，id为3的记录已经被删掉了。</p>
<h3 id="char-varchar-nvarchar区别"><a href="#char-varchar-nvarchar区别" class="headerlink" title="char varchar nvarchar区别"></a>char varchar nvarchar区别</h3><p>参考：<a href="https://www.cnblogs.com/yelaiju/archive/2010/05/29/1746826.html" target="_blank" rel="noopener">https://www.cnblogs.com/yelaiju/archive/2010/05/29/1746826.html</a><br>Unicode字符集就是为了解决字符集的不兼容的问题而产生的，它所有的字符都用两个字节表示，即英文字符也是用两个字节表示</p>
<p>varchar(n)<br>长度为 n 个字节的可变长度且非 Unicode 的字符数据。n 必须是一个介于 1 和 8,000 之间的数值。存储大小为输入数据的字节的实际长度，而不是 n 个字节。</p>
<p>nvarchar(n)<br>包含 n 个字符的可变长度 Unicode 字符数据。n 的值必须介于 1 与 4,000 之间。字节的存储大小是所输入字符个数的两倍。</p>
<p>两字段分别有字段值：我和coffee<br>那么varchar字段占2×2+6=10个字节的存储空间，而nvarchar字段占8×2=16个字节的存储空间。</p>
<p>一般来说，如果含有中文字符，用nchar/nvarchar，如果纯英文和数字，用char/varchar</p>
<p>联机帮助上的：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>长度</th>
<th>使用说明</th>
<th>长度说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>char(n)</td>
<td>定长</td>
<td>索引效率高 程序里面使用trim去除多余的空白</td>
<td>n 必须是一个介于 1 和 8,000 之间的数值,存储大小为 n 个字节</td>
</tr>
<tr>
<td>varchar(n)</td>
<td>变长</td>
<td>效率没char高 灵活</td>
<td>n 必须是一个介于 1 和 8,000 之间的数值。存储大小为输入数据的字节的实际长度，而不是 n 个字节</td>
</tr>
<tr>
<td>text(n)</td>
<td>变长</td>
<td>非Unicode数据</td>
<td>不用指定长度</td>
</tr>
<tr>
<td>nchar(n)</td>
<td>定长</td>
<td>处理unicode数据类型(所有的字符使用两个字节表示)</td>
<td>n 的值必须介于 1 与 4,000 之间。存储大小为 n 字节的两倍</td>
</tr>
<tr>
<td>nvarchar(n)</td>
<td>变长</td>
<td>处理unicode数据类型(所有的字符使用两个字节表示)</td>
<td>n 的值必须介于 1 与 4,000 之间。字节的存储大小是所输入字符个数的两倍。所输入的数据字符长度可以为零</td>
</tr>
<tr>
<td>ntext(n)</td>
<td>变长</td>
<td>处理unicode数据类型(所有的字符使用两个字节表示)</td>
<td>不用指定长度</td>
</tr>
</tbody>
</table>
<p>很多开发者进行数据库设计的时候往往并没有太多的考虑char， varchar类型，有的是根本就没注意，因为存储价格变得越来越便宜了，忘记了最开始的一些基本设计理论和原则，这点让我想到了现在的年轻人，大手一挥一把人民币就从他手里溜走了，其实我想不管是做人也好，做开发也好，细节的把握直接决定很多东西。当然还有一部分人是根本就没弄清楚他们的区别，也就随便选一个。在这里我想对他们做个简单的分析，当然如果有不对的地方希望大家指教。<br>1、CHAR。CHAR存储定长数据很方便，CHAR字段上的索引效率级高，比如定义char(10)，那么不论你存储的数据是否达到了10个字节，都要占去10个字节的空间,不足的自动用空格填充，所以在读取的时候可能要多次用到trim（）。</p>
<p>2、VARCHAR。存储变长数据，但存储效率没有CHAR高。如果一个字段可能的值是不固定长度的，我们只知道它不可能超过10个字符，把它定义为 VARCHAR(10)是最合算的。VARCHAR类型的实际长度是它的值的实际长度+1。为什么“+1”呢？这一个字节用于保存实际使用了多大的长度。从空间上考虑，用varchar合适；从效率上考虑，用char合适，关键是根据实际情况找到权衡点。</p>
<p>3、TEXT。text存储可变长度的非Unicode数据，最大长度为2^31-1(2,147,483,647)个字符。</p>
<p>4、NCHAR、NVARCHAR、NTEXT。这三种从名字上看比前面三种多了个“N”。它表示存储的是Unicode数据类型的字符。我们知道字符中，英文字符只需要一个字节存储就足够了，但汉字众多，需要两个字节存储，英文与汉字同时存在时容易造成混乱，Unicode字符集就是为了解决字符集这种不兼容的问题而产生的，它所有的字符都用两个字节表示，即英文字符也是用两个字节表示。nchar、nvarchar的长度是在1到4000之间。和char、varchar比较起来，nchar、nvarchar则最多存储4000个字符，不论是英文还是汉字；而char、varchar最多能存储8000个英文，4000个汉字。可以看出使用nchar、nvarchar数据类型时不用担心输入的字符是英文还是汉字，较为方便，但在存储英文时数量上有些损失。</p>
<p>所以一般来说，如果含有中文字符，用nchar/nvarchar，如果纯英文和数字，用char/varchar</p>
<p>它们的区别概括成：<br>CHAR，NCHAR 定长，速度快，占空间大，需处理<br>VARCHAR，NVARCHAR，TEXT 不定长，空间小，速度慢，无需处理<br>NCHAR、NVARCHAR、NTEXT处理Unicode码</p>
<h3 id="mysql-修改字段长度"><a href="#mysql-修改字段长度" class="headerlink" title="mysql 修改字段长度"></a>mysql 修改字段长度</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">modify</span> <span class="keyword">column</span> [字段名] [类型];</span><br><span class="line"></span><br><span class="line">示例: sys_user表里的user_name字段，由原来长度是10个字符，修改改成40个字符</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sys_user <span class="keyword">modify</span> <span class="keyword">column</span> user_name <span class="built_in">varchar</span>(<span class="number">40</span>);</span><br></pre></td></tr></table></figure>
<h3 id="mysql-增加列（字段）"><a href="#mysql-增加列（字段）" class="headerlink" title="mysql 增加列（字段）"></a>mysql 增加列（字段）</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> [表名] <span class="keyword">add</span> [列名] [列类型] [其他属性，如默认值];</span><br><span class="line"></span><br><span class="line">示例: sys_user表增加一个地址列，长度为200个字符，默认值为null</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> sys_user <span class="keyword">add</span> address <span class="built_in">varchar</span>(<span class="number">200</span>) <span class="keyword">default</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h3 id="mysql-按字段分组，取最小生日记录"><a href="#mysql-按字段分组，取最小生日记录" class="headerlink" title="mysql 按字段分组，取最小生日记录"></a>mysql 按字段分组，取最小生日记录</h3><p>有用户表如下：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; select * from user;</span><br><span class="line"></span><br><span class="line">id	name	birthday</span><br><span class="line">1	a	2018-01-25 09:30:05</span><br><span class="line">2	a	2018-01-25 09:30:14</span><br><span class="line">3	a	2018-01-25 09:30:10</span><br><span class="line">4	b	2018-01-25 09:30:29</span><br><span class="line">5	b	2018-01-25 09:30:24</span><br></pre></td></tr></table></figure></p>
<p><strong>要求：</strong>以name分组，取出生日最小的记录，即id为2、4的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sql&gt; select * from (select * from user order by birthday desc) t group by t.name;</span><br><span class="line"></span><br><span class="line">id	name	birthday</span><br><span class="line">2	a	2018-01-25 09:30:14</span><br><span class="line">4	b	2018-01-25 09:30:29</span><br></pre></td></tr></table></figure></p>
<h3 id="mysql-仅保留-1000-条记录而删除其他记录"><a href="#mysql-仅保留-1000-条记录而删除其他记录" class="headerlink" title="mysql 仅保留 1000 条记录而删除其他记录"></a>mysql 仅保留 1000 条记录而删除其他记录</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">求取总记录数</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> tb_name;</span><br><span class="line"></span><br><span class="line">删除部分记录</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_name <span class="keyword">limit</span> 总记录数<span class="number">-1000</span></span><br><span class="line"></span><br><span class="line">例如，比如一个表有 <span class="number">10000</span> 条记录，现想保留 <span class="number">1000</span> 条数据</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> tb_name <span class="keyword">limit</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>
<h3 id="MySQL数据库备份和还原常用的命令"><a href="#MySQL数据库备份和还原常用的命令" class="headerlink" title="MySQL数据库备份和还原常用的命令"></a>MySQL数据库备份和还原常用的命令</h3><h4 id="一、备份命令"><a href="#一、备份命令" class="headerlink" title="一、备份命令"></a>一、备份命令</h4><p>如果只需要导出表的结构,可以使用mysqldump的<code>-d</code>选项<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1、备份MySQL数据库的命令，备份指定的整个库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、备份MySQL数据库为带删除表的格式，能够让该备份覆盖已有数据库而不需要手动删除原有数据库</span><br><span class="line">mysqldump <span class="comment">--add-drop-table -hhostname -uusername -ppassword databasename &gt; ~/backupfile.sql</span></span><br><span class="line"></span><br><span class="line">3、直接将MySQL数据库压缩备份</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename | gzip &gt; ~/backupfile.sql.gz</span><br><span class="line"></span><br><span class="line">4、备份MySQL数据库某个(些)表</span><br><span class="line">mysqldump -hhostname -uusername -ppassword databasename specific_table1 [specific_table2] &gt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">5、同时备份多个MySQL数据库</span><br><span class="line">mysqldump -hhostname -uusername -ppassword -databases databasename1 databasename2 databasename3 &gt; ~/multibackupfile.sql</span><br><span class="line"></span><br><span class="line">6、仅仅备份数据库结构</span><br><span class="line">mysqldump -no-data -databases databasename1 databasename2 databasename3 &gt; ~/structurebackupfile.sql</span><br><span class="line"></span><br><span class="line">7、备份服务器上所有数据库</span><br><span class="line">mysqldump -all-databases &gt; ~/allbackupfile.sql</span><br></pre></td></tr></table></figure></p>
<h4 id="二、还原命令"><a href="#二、还原命令" class="headerlink" title="二、还原命令"></a>二、还原命令</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、还原MySQL数据库的命令</span><br><span class="line">mysql -hhostname -uusername -ppassword databasename &lt; ~/backupfile.sql</span><br><span class="line"></span><br><span class="line">2、还原压缩的MySQL数据库</span><br><span class="line">gunzip &lt; ~/backupfile.sql.gz | mysql -uusername -ppassword databasename</span><br><span class="line"></span><br><span class="line">3、将数据库转移到新服务器</span><br><span class="line">mysqldump -uusername -ppassword databasename | mysql -host=*.*.*.* -C databasename</span><br></pre></td></tr></table></figure>
<h3 id="select-into"><a href="#select-into" class="headerlink" title="select into"></a>select into</h3><p>除此之外，你还可以使用<code>select into</code>命令来导出数据，它与mysqldump的区别是：</p>
<ol>
<li>mysqldump: 导出的文本包括了数据库的结构和记录；</li>
<li>select into: 导出的文本只有记录，并且，一般要数据库的管理员帐号，例如root才能执行；</li>
</ol>
<p>select into 有两种使用方式：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">方式一：</span><br><span class="line">mysql&gt; select * from t_user into outfile 't_user.txt';</span><br><span class="line">Query OK, 2 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">方式二：</span><br><span class="line">mysql&gt; select * into outfile 't_user.txt' from t_user;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>导出的数据一般在数据库的安装目录下，你也可以使用<code>find / -name t_user.txt</code>来查找到</p>
<h3 id="ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device"><a href="#ERROR-3-HY000-Error-writing-file-‘-tmp-MYeaZGpS’-Errcode-28-No-space-left-on-device" class="headerlink" title="ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)"></a>ERROR 3 (HY000): Error writing file ‘/tmp/MYeaZGpS’ (Errcode: 28 - No space left on device)</h3><p>根据提示，是说mysql中/tmp使用的磁盘空间不足。<br>在MYSQL命令行下执行：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| tmpdir        | /tmp  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>可以看到MYSQL的tmpdir是使用/tmp这个临时目录的，使用<code>df -h</code>看下/tmp的空间，确实不足。我们修改tmpdir所指定的目录，我们在空间比较大的分区上面建一个目录。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /opt/data</span><br><span class="line">$ mkdir mysqltmp</span><br><span class="line">$ chmod a+w mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>然后修改my.cnf配置文件在其中修改tmpdir<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ whereis my.cnf</span><br><span class="line">$ <span class="built_in">cd</span> &#123;my.cnf所在的目录&#125;</span><br><span class="line">$ vi my.cnf</span><br><span class="line"><span class="comment"># 修改的内容如下</span></span><br><span class="line">tmpdir = /opt/data/mysqltmp</span><br></pre></td></tr></table></figure></p>
<p>重启mysql<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ /etc/init.d/mysqld restart	<span class="comment"># 注意linux系统，命令可能不同</span></span><br></pre></td></tr></table></figure></p>
<p>在MYSQL命令行中查看下是否生效<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like 'tmpdir';</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| Variable_name | Value              |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">| tmpdir        | /opt/data/mysqltmp |</span><br><span class="line">+<span class="comment">---------------+--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<p>问题解决。</p>
<p>读一致性：ORACLE有一个表，有1000W条记录。在9：00的时候A用户对表进行查询，查询需10分钟才能完成，表没索引，FULL SCAN，表中某条记录的值为100。在9：05分的时候B对表进行了UPDATE操作，将记录的值修改为200。那么在9:10的时候，A获致到的是100还是200？结果是100.因为这是读一致性的问题，在A查的时候，它看到的是整个表在那一刻的快照的数据，返回的是那一刻的结果。不过，它有可能会抛出 snapshot too old 这个异常。</p>
<h3 id="mysql-修改表名"><a href="#mysql-修改表名" class="headerlink" title="mysql 修改表名"></a>mysql 修改表名</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name RENAME TO new_table_name;</span><br></pre></td></tr></table></figure>
<h3 id="MySQL-百万级分页优化-Mysql千万级快速分页"><a href="#MySQL-百万级分页优化-Mysql千万级快速分页" class="headerlink" title="MySQL 百万级分页优化(Mysql千万级快速分页)"></a>MySQL 百万级分页优化(Mysql千万级快速分页)</h3><p>转自：<a href="http://www.jb51.net/article/31868.htm" target="_blank" rel="noopener">http://www.jb51.net/article/31868.htm</a></p>
<p>一般刚开始学SQL的时候，会这样写，代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table ORDER BY id LIMIT 1000, 10;</span><br></pre></td></tr></table></figure></p>
<p>但在数据达到百万级的时候，这样写会慢死，代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table ORDER BY id LIMIT 1000000, 10;</span><br></pre></td></tr></table></figure></p>
<p>也许耗费几十秒 </p>
<p>网上很多优化的方法是这样的，代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table WHERE id &gt;= (SELECT id FROM table LIMIT 1000000, 1) LIMIT 10;</span><br></pre></td></tr></table></figure></p>
<p>是的，速度提升到0.x秒了，看样子还行了<br>可是，还不是完美的！ </p>
<p>以下这句才是完美的！代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table WHERE id BETWEEN 1000000 AND 1000010;</span><br></pre></td></tr></table></figure></p>
<p>比上面那句，还要再快5至10倍 </p>
<p>另外，如果需要查询 id 不是连续的一段，最佳的方法就是先找出 id ，然后用 in 查询，代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table WHERE id IN(10000, 100000, 1000000...);</span><br></pre></td></tr></table></figure></p>
<p>再分享一点<br>查询字段一较长字符串的时候，表设计时要为该字段多加一个字段,如，存储网址的字段，查询的时候，不要直接查询字符串，效率低下，应该查诡该字串的crc32或md5 </p>
<h3 id="mysql-查询一个字符串字段-最长的一条记录"><a href="#mysql-查询一个字符串字段-最长的一条记录" class="headerlink" title="mysql 查询一个字符串字段 最长的一条记录"></a>mysql 查询一个字符串字段 最长的一条记录</h3><p>参考：<a href="http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql" target="_blank" rel="noopener">http://stackoverflow.com/questions/2357620/maxlengthfield-in-mysql</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select name, length( name )</span><br><span class="line">from my_table</span><br><span class="line">where length( name ) = ( select max( length( name ) ) from my_table );</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/07/mysql-note/" data-id="cjoo8xasy001uu23ktban2fy0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mysql/">mysql</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zookeeper-install-cluster" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/06/zookeeper-install-cluster/" class="article-date">
  <time datetime="2017-12-06T08:33:35.000Z" itemprop="datePublished">2017-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/06/zookeeper-install-cluster/">zookeeper 集群版安装方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="计划在一台Ubuntu-Linux服务器上部署3台zookeeper服务器，分别为server1-server2-server3"><a href="#计划在一台Ubuntu-Linux服务器上部署3台zookeeper服务器，分别为server1-server2-server3" class="headerlink" title="计划在一台Ubuntu Linux服务器上部署3台zookeeper服务器，分别为server1, server2, server3"></a>计划在一台<code>Ubuntu Linux</code>服务器上部署3台<code>zookeeper</code>服务器，分别为<code>server1</code>, <code>server2</code>, <code>server3</code></h3><p>因为三台<code>zookeeper</code>服务器的配置都差不多，所以我们先设置好一台<code>server1</code>的配置，再将其复制成<code>server2</code>, <code>server3</code>并修改其中的配置即可。</p>
<h3 id="1-建目录，如下："><a href="#1-建目录，如下：" class="headerlink" title="1.建目录，如下："></a>1.建目录，如下：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /home/hewentian/ProjectD/zookeeperCluster/server1</span><br><span class="line">$ mkdir -p /home/hewentian/ProjectD/zookeeperCluster/server1/data</span><br></pre></td></tr></table></figure>
<h3 id="2-将zookeeper-3-4-6-tar-gz放到-home-hewentian-ProjectD-zookeeperCluster-server1目录下，并执行如下脚本解压"><a href="#2-将zookeeper-3-4-6-tar-gz放到-home-hewentian-ProjectD-zookeeperCluster-server1目录下，并执行如下脚本解压" class="headerlink" title="2.将zookeeper-3.4.6.tar.gz放到/home/hewentian/ProjectD/zookeeperCluster/server1目录下，并执行如下脚本解压"></a>2.将<code>zookeeper-3.4.6.tar.gz</code>放到<code>/home/hewentian/ProjectD/zookeeperCluster/server1</code>目录下，并执行如下脚本解压</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1</span><br><span class="line">$ tar xzvf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="3-解压后得到zookeeper-3-4-6文件夹，进入conf目录"><a href="#3-解压后得到zookeeper-3-4-6文件夹，进入conf目录" class="headerlink" title="3.解压后得到zookeeper-3.4.6文件夹，进入conf目录"></a>3.解压后得到<code>zookeeper-3.4.6</code>文件夹，进入<code>conf</code>目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> zookeeper-3.4.6/conf/</span><br></pre></td></tr></table></figure>
<h3 id="4-执行如下命令，新建一个配置文件zoo-cfg"><a href="#4-执行如下命令，新建一个配置文件zoo-cfg" class="headerlink" title="4.执行如下命令，新建一个配置文件zoo.cfg"></a>4.执行如下命令，新建一个配置文件zoo.cfg</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure>
<h3 id="5-修改zoo-cfg并在其中修改如下内容："><a href="#5-修改zoo-cfg并在其中修改如下内容：" class="headerlink" title="5.修改zoo.cfg并在其中修改如下内容："></a>5.修改zoo.cfg并在其中修改如下内容：</h3><pre><code>tickTime=2000
initLimit=10
syncLimit=5
dataDir=/home/hewentian/ProjectD/zookeeperCluster/server1/data # 这里必须为绝对路径，否则有可能无法启动
clientPort=2181                                                # 这台服务器的端口为2181这里为默认值
server.1=127.0.0.1:2888:3888
server.2=127.0.0.1:2889:3889
server.3=127.0.0.1:2890:3890
</code></pre><h3 id="6-在-home-hewentian-ProjectD-zookeeperCluster-server1-data目录下建myid文件并在其中输入1，只输入1，代表server-1"><a href="#6-在-home-hewentian-ProjectD-zookeeperCluster-server1-data目录下建myid文件并在其中输入1，只输入1，代表server-1" class="headerlink" title="6.在/home/hewentian/ProjectD/zookeeperCluster/server1/data目录下建myid文件并在其中输入1，只输入1，代表server.1"></a>6.在<code>/home/hewentian/ProjectD/zookeeperCluster/server1/data</code>目录下建<code>myid</code>文件并在其中输入1，只输入1，代表server.1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure>
<p>这样第一台服务器已经配置完毕。</p>
<h3 id="7-接下来我们将server1复制为server2-server3"><a href="#7-接下来我们将server1复制为server2-server3" class="headerlink" title="7.接下来我们将server1复制为server2, server3"></a>7.接下来我们将<code>server1</code>复制为<code>server2</code>, <code>server3</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster</span><br><span class="line">$ cp -r server1 server2</span><br><span class="line">$ cp -r server1 server3</span><br></pre></td></tr></table></figure>
<h3 id="8-将server2-data目录下的myid的内容修改为2"><a href="#8-将server2-data目录下的myid的内容修改为2" class="headerlink" title="8.将server2/data目录下的myid的内容修改为2"></a>8.将<code>server2/data</code>目录下的<code>myid</code>的内容修改为2</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure>
<p>同理，将将<code>server3/data</code>目录下的<code>myid</code>的内容修改为3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/data</span><br><span class="line">$ vi myid</span><br></pre></td></tr></table></figure></p>
<h3 id="9-修改server2的配置文件"><a href="#9-修改server2的配置文件" class="headerlink" title="9.修改server2的配置文件"></a>9.修改<code>server2</code>的配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/conf/</span><br><span class="line">$ vi zoo.cfg</span><br></pre></td></tr></table></figure>
<p>仅修改两处地方即可，要修改的地方如下：</p>
<pre><code>dataDir=/home/hewentian/ProjectD/zookeeperCluster/server2/data  # 这里是数据保存的位置
clientPort=2182                                                 # 这台服务器的端口为2182
</code></pre><p>同理，修改<code>server3</code>的配置文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/conf/</span><br><span class="line">$ vi zoo.cfg</span><br></pre></td></tr></table></figure></p>
<p>仅修改两处地方即可，要修改的地方如下：</p>
<pre><code>dataDir=/home/hewentian/ProjectD/zookeeperCluster/server3/data  # 这里是数据保存的位置
clientPort=2183                                                 # 这台服务器的端口为2183
</code></pre><h3 id="10-到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动"><a href="#10-到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动" class="headerlink" title="10.到目前为此，我们已经将3台zookeeper服务器都配置好了。接下来，我们要将他们都启动"></a>10.到目前为此，我们已经将3台<code>zookeeper</code>服务器都配置好了。接下来，我们要将他们都启动</h3><p>启动server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动server2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动server3<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<h3 id="11-当三台服务器都启动好了，我们分别连到server1、server2、server3："><a href="#11-当三台服务器都启动好了，我们分别连到server1、server2、server3：" class="headerlink" title="11.当三台服务器都启动好了，我们分别连到server1、server2、server3："></a>11.当三台服务器都启动好了，我们分别连到server1、server2、server3：</h3><p>连接到server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server1/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure></p>
<p>连接到server2<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server2/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2182</span><br></pre></td></tr></table></figure></p>
<p>连接到server1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeperCluster/server3/zookeeper-3.4.6/bin/</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2183</span><br></pre></td></tr></table></figure></p>
<p>这样你在<code>server1</code>中所作的修改，都会同步到<code>server2</code>, <code>server3</code>。<br>例如你在server1中<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ create /zk_test_cluster my_data_cluster</span><br></pre></td></tr></table></figure></p>
<p>你在server2, server3的客户端用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ls /</span><br></pre></td></tr></table></figure></p>
<p>都会看到节点zk_test_cluster</p>
<p>集群部署结束。</p>
<h3 id="参数说明："><a href="#参数说明：" class="headerlink" title="参数说明："></a>参数说明：</h3><ol>
<li>tickTime：zookeeper中使用的基本时间单位，毫秒值；</li>
<li>initLimit：由于zookeeper集群中包含多台server，其中一台为leader，其余的为follower。initLimit参数配置初始化连接时，follower和leader之间的最长心跳时间，此时该参数设置为5，说明时间限制为5倍tickTime, 即：5 * 2000 = 10000ms = 10s；</li>
<li>syncLimit：该参数配置leader和follower之间发送消息，请求和应答的最大时间长度。此时该参数设置为2，说明时间限制为2倍tickTime，即4000ms；</li>
<li>dataDir: 数据存放目录，可以是任意目录；</li>
<li>dataLogDir: log目录，同样可以是任意目录。如果没有设置该参数，将使用和dataDir相同的设置；</li>
<li>clientPort: 监听client连接的端口号；</li>
<li>server.X=A:B:C：其中X是一个数字，表示这是第几号server。A是该server所在的IP地址；B配置该server和集群中的leader交换消息所使用的端口；C配置选举leader时所使用的端口。由于配置的是伪集群模式，所以各个server的B，C参数必须不同。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/06/zookeeper-install-cluster/" data-id="cjoo8xatb0032u23k0y56zw12" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-zookeeper-install-standalone" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/06/zookeeper-install-standalone/" class="article-date">
  <time datetime="2017-12-06T08:33:23.000Z" itemprop="datePublished">2017-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/06/zookeeper-install-standalone/">zookeeper 单机版安装方法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="下面演示在-Ubuntu-16-04-LTS-下面安装-zookeeper"><a href="#下面演示在-Ubuntu-16-04-LTS-下面安装-zookeeper" class="headerlink" title="下面演示在 Ubuntu 16.04 LTS 下面安装 zookeeper"></a>下面演示在 Ubuntu 16.04 LTS 下面安装 zookeeper</h3><p>将<code>zookeeper-3.4.6.tar.gz</code>放到一个目录下，如<code>/home/hewentian/ProjectD</code><br>执行如下脚本解压<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD</span><br><span class="line">$ tar xzvf zookeeper-3.4.6.tar.gz</span><br></pre></td></tr></table></figure></p>
<p>解压后得到zookeeper-3.4.6文件夹，进入conf目录<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> zookeeper-3.4.6/conf/</span><br></pre></td></tr></table></figure></p>
<p>执行如下命令，新建一个配置文件zoo.cfg<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp zoo_sample.cfg zoo.cfg</span><br></pre></td></tr></table></figure></p>
<p>修改zoo.cfg并在其中修改如下内容：</p>
<pre><code>tickTime=2000
dataDir=/var/lib/zookeeper
clientPort=2181
</code></pre><p>如果<code>/var/lib/zookeeper</code>这个目录没有，就要执行如下命令创建<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir -p /var/lib/zookeeper</span><br></pre></td></tr></table></figure></p>
<p>修改好后，我们就可以进入bin目录下启动zookeeper了<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeper-3.4.6/bin</span><br><span class="line">$ ./zkServer.sh start</span><br></pre></td></tr></table></figure></p>
<p>启动后，我们可以连到zookeeper服务器，命令如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/hewentian/ProjectD/zookeeper-3.4.6/bin</span><br><span class="line">$ ./zkCli.sh -server 127.0.0.1:2181</span><br></pre></td></tr></table></figure></p>
<h3 id="一些操作例子，如下："><a href="#一些操作例子，如下：" class="headerlink" title="一些操作例子，如下："></a>一些操作例子，如下：</h3><p>From here, you can try a few simple commands to get a feel for this simple command line interface. First, start by issuing the list command, as in ls, yielding:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 8] ls /</span><br><span class="line">[zookeeper]</span><br></pre></td></tr></table></figure></p>
<p>Next, create a new znode by running create /zk_test my_data. This creates a new znode and associates the string “my_data” with the node. You should see:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 9] create /zk_test my_data</span><br><span class="line">Created /zk_test</span><br></pre></td></tr></table></figure></p>
<p>Issue another ls / command to see what the directory looks like:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 11] ls /</span><br><span class="line">[zookeeper, zk_test]</span><br></pre></td></tr></table></figure></p>
<p>Notice that the zk_test directory has now been created.<br>Next, verify that the data was associated with the znode by running the get command, as in:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 12] get /zk_test</span><br><span class="line">my_data</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 5</span><br><span class="line">mtime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 0</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 7</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure></p>
<p>We can change the data associated with zk_test by issuing the set command, as in:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 14] <span class="built_in">set</span> /zk_test junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br><span class="line">[zkshell: 15] get /zk_test</span><br><span class="line">junk</span><br><span class="line">cZxid = 5</span><br><span class="line">ctime = Fri Jun 05 13:57:06 PDT 2009</span><br><span class="line">mZxid = 6</span><br><span class="line">mtime = Fri Jun 05 14:01:52 PDT 2009</span><br><span class="line">pZxid = 5</span><br><span class="line">cversion = 0</span><br><span class="line">dataVersion = 1</span><br><span class="line">aclVersion = 0</span><br><span class="line">ephemeralOwner = 0</span><br><span class="line">dataLength = 4</span><br><span class="line">numChildren = 0</span><br></pre></td></tr></table></figure></p>
<p>(Notice we did a get after setting the data and it did, indeed, change.</p>
<p>Finally, let’s delete the node by issuing:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[zkshell: 16] delete /zk_test</span><br><span class="line">[zkshell: 17] ls /</span><br><span class="line">[zookeeper]</span><br><span class="line">[zkshell: 18]</span><br></pre></td></tr></table></figure></p>
<p>That’s it for now. To explore more, continue with the rest of this document and see the Programmer’s Guide.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/06/zookeeper-install-standalone/" data-id="cjoo8xatc0034u23kbrrlh1si" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/zookeeper/">zookeeper</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hexo-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/12/02/hexo-note/" class="article-date">
  <time datetime="2017-12-02T05:59:48.000Z" itemprop="datePublished">2017-12-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/12/02/hexo-note/">hexo学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>
<h2 id="下面将详细说说安装过程，基于-Ubuntu-16-04-LTS："><a href="#下面将详细说说安装过程，基于-Ubuntu-16-04-LTS：" class="headerlink" title="下面将详细说说安装过程，基于 Ubuntu 16.04 LTS："></a>下面将详细说说安装过程，基于 Ubuntu 16.04 LTS：</h2><h3 id="1-安装-Git"><a href="#1-安装-Git" class="headerlink" title="1. 安装 Git"></a>1. 安装 Git</h3><p>在 Ubuntu 下面安裝非常方便，可以先在命令行中輸入<code>git</code>，如果没显示命令，则输入如下命令安装即可：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install git</span><br></pre></td></tr></table></figure></p>
<h3 id="2-安装-Node-js"><a href="#2-安装-Node-js" class="headerlink" title="2. 安装 Node.js"></a>2. 安装 Node.js</h3><p>先测试一下Node.js是否已安装，在命令行中直接输入<code>node</code>可以看到提示符变成了一个向右<br>的箭头就表示成功了，然后按ctrl + c退出node模式，出现$符号才表示正常了</p>
<p>如果未安裝 node，安裝方法如下：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install nodejs-legacy</span><br></pre></td></tr></table></figure></p>
<h3 id="3-安装-Hexo"><a href="#3-安装-Hexo" class="headerlink" title="3. 安装 Hexo"></a>3. 安装 Hexo</h3><p>进入到我们博客的仓库, 输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo npm install -g hexo-cli</span><br><span class="line">或者</span><br><span class="line">$ sudo npm install hexo --save  <span class="comment"># 或者去掉 sudo</span></span><br></pre></td></tr></table></figure></p>
<p>敲完回车可能没有任何提示，请一定要耐心等待<br>安装成功后，可以输入以下命令测试一下Hexo是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo version</span><br></pre></td></tr></table></figure></p>
<p>如果能看到hexo的版本号信息，就表示安装成功了<br>接下来，进入到我们博客的仓库</p>
<p>然后依次输入以下命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ hexo init  <span class="comment"># 注意此命令，要求当前仓库为空，可以先将仓库的文件移走，再执行此命令，然后再将文件移回来。</span></span><br><span class="line">$ <span class="comment"># 可以先在当前目录的父目录创建临时目录hgi</span></span><br><span class="line">$ mkdir ../hgi</span><br><span class="line">$ mv * ../hgi <span class="comment"># 这个命令不会将 .git .gitignore这两个文件夹移走，所以，还要执行如下命令</span></span><br><span class="line">$ mv .git .gitignore ../hgi/</span><br><span class="line">$ npm install</span><br><span class="line">$ hexo g</span><br><span class="line">$ hexo s</span><br></pre></td></tr></table></figure></p>
<p>这时候在浏览器输入<a href="http://localhost:4000/" target="_blank" rel="noopener">http://localhost:4000/</a> 就可以看到hexo已经成功生成了博客，当然这只是我们本地可以看到的</p>
<p>最后将博客的仓库目录下除了<code>node_modules</code>之外的文件都删掉，然后将 ../hgi 中的除了<code>node_modules</code>之外的文件都复制回来(不要忘记.git .gitignore)，大功告成。<br>重启hexo</p>
<p>配置Hexo到Github</p>
<p>找到我们刚刚创建的文件夹，在里面找到_config.yml文件，用notepad++打开，直接拖到最后，添加如下：</p>
<pre><code>deploy:
  type: git
  repository: git@github.com:hewentian/hewentian.github.io.git
  branch: master
</code></pre><p>发布到 github<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean</span><br><span class="line">$ hexo g</span><br><span class="line">$ hexo d</span><br></pre></td></tr></table></figure></p>
<p>如果出现以下异常</p>
<pre><code>ERROR Deployer not found: git
</code></pre><p>尝试输入以下命令，然后重新执行刚刚的两条命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure></p>
<p>这时候我们就可以在浏览器输入 <a href="https://hewentian.github.io" target="_blank" rel="noopener">https://hewentian.github.io</a> 就可以看到博客已经搭建成功了。</p>
<p>使用以下命令验证是否安装成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">$ npm -v</span><br><span class="line">$ hexo -v</span><br></pre></td></tr></table></figure></p>
<p>解释一下：<br>node_modules：是依赖包<br>public：存放的是生成的页面<br>scaffolds：命令生成文章等的模板<br>source：用命令创建的各种文章<br>themes：主题<br>_config.yml：整个博客的配置<br>db.json：source解析所得到的<br>package.json：项目所需模块项目的配置信息</p>
<p>添加博文<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new <span class="string">"postName"</span>  <span class="comment">#新建博文,其中postName是博文题目</span></span><br></pre></td></tr></table></figure></p>
<p>博文会自动生成在博客目录下source/_posts/postName.md</p>
<p>注意事项</p>
<p>所有键的冒号后面留一个空格，如 <code>language: zh-CN</code></p>
<p>一些常用命令：<br>hexo new “postName” #新建文章<br>hexo new page “pageName” #新建页面<br>hexo generate #生成静态页面至public目录, hexo g<br>hexo server #开启预览访问端口（默认端口4000，’ctrl + c’关闭server）, hexo s<br>hexo deploy #将.deploy目录部署到GitHub, hexo d<br>hexo help # 查看帮助<br>hexo version #查看Hexo的版本</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/12/02/hexo-note/" data-id="cjoo8xasj000ku23kfwaqflov" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/16/java-note/" class="article-date">
  <time datetime="2017-11-16T11:58:45.000Z" itemprop="datePublished">2017-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/16/java-note/">java 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息"><a href="#想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息" class="headerlink" title="想在eclipse中新建类的时候，自动在类的头部插入作者、时间等信息"></a>想在<code>eclipse</code>中新建类的时候，自动在类的头部插入作者、时间等信息</h3><p>方法是<code>Window -&gt; Preferences -&gt; Java -&gt; Code Style -&gt; Code Templates</code>在右则民展开<code>Code -&gt; New Java files</code>点<code>Edit...</code>并加入如下代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$&#123;filecomment&#125;</span><br><span class="line">$&#123;package_declaration&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;$&#123;file_name&#125;&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> $&#123;currentDate:date('yyyy-MM-dd')&#125; $&#123;time&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$&#123;typecomment&#125;</span><br><span class="line">$&#123;type_declaration&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Remote-System-Explorer-Operation总是运行后台服务，卡死eclipse解决办法"><a href="#Remote-System-Explorer-Operation总是运行后台服务，卡死eclipse解决办法" class="headerlink" title="Remote System Explorer Operation总是运行后台服务，卡死eclipse解决办法"></a>Remote System Explorer Operation总是运行后台服务，卡死eclipse解决办法</h3><p>eclipse后台进程在远程操作，右下角显示的“Remote System Explorer Operation”。折腾了半天，在Stack Overflow找到答案 <a href="https://stackoverflow.com/questions/1631817/remote-system-explorer-operation-causing-freeze-for-couple-of-seconds" target="_blank" rel="noopener">源地址</a>。解决方案如下：</p>
<pre><code>step1: Eclipse -&gt; Preferences -&gt; General -&gt; Startup and Shutdown.
    -Uncheck RSE UI.

step2: Eclipse -&gt; Preferences -&gt; Remote Systems.
    -Uncheck Re-open Remote Systems view to previous state.
</code></pre><p>Update your Eclipse to 4.3.1 (at least) due to a bug on previous version.</p>
<p>Restart Eclipse and its done.</p>
<ol>
<li>线程安全概念：当多个线程访问某一个类（对象或方法）时，这个类始终都能表现出正确的行为，那么这个类（对象或方法）就是线程安全的。</li>
<li>synchronized：可以在何意对象及方法上加锁，而加锁的这段段码称为“互斥区”或“临界区”。</li>
</ol>
<p>当多个线程访问某个synchronized修饰的方法时，以排队的方式进行处理（这里的排除是按照CPU分配时间片的先后顺序而定的），一个线程想要执行这个方法时，首先是尝试获得锁，如果拿到锁，就执行；否则，就会不断的尝试去获得这把锁，直到拿到为止，而且是多个线程同时去竞争这把锁。在static方法上加上synchronized关键字，表示锁定.class类，类一级别的锁（独占.class类)</p>
<p>一个类中有两个方法都有synchronized修饰的话，多线程分别访问这两个方法都会进行等待，因为它们都共用同一个锁。如果其中一个没有synchronized修饰的话，多线程就可以同时访问，而不需等待。</p>
<h3 id="Integer-valueOf产生的死锁"><a href="#Integer-valueOf产生的死锁" class="headerlink" title="Integer.valueOf产生的死锁"></a>Integer.valueOf产生的死锁</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SyncAddRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> a;</span><br><span class="line">	<span class="keyword">int</span> b;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SyncAddRunnable</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.a = a;</span><br><span class="line">		<span class="keyword">this</span>.b = b;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">synchronized</span> (Integer.valueOf(a)) &#123;</span><br><span class="line">			<span class="keyword">synchronized</span> (Integer.valueOf(b)) &#123;</span><br><span class="line">				System.out.println(a + b);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, IOException </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> SyncAddRunnable(<span class="number">1</span>, <span class="number">2</span>)).start();</span><br><span class="line">			<span class="keyword">new</span> Thread(<span class="keyword">new</span> SyncAddRunnable(<span class="number">2</span>, <span class="number">1</span>)).start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>上面的程序会造成死锁，其原因是Integer.valueOf方法基于减少对象创建次数和节省内存的考虑，[-128, 127]之间的数字会被缓存（默认值，实际值取决于<code>java.lang.Integer.IntegerCache.high</code>参数的设置），当valueOf()方法传入的参数在这个范围之内，将直接返回缓存中的对象，也就是说，代码中调用了200次Integer.valueOf方法一共就只返回了2个不同的对象。假如在某个线程的两个synchronized块之间发生了线程切换，那就会出现线程A等待被线程B持有的Integer.valueOf(1)，而线程B又等待着线程A持有的Integer.valueOf(2)，结果就出现了死锁了。</p>
<h3 id="只保留3位小数"><a href="#只保留3位小数" class="headerlink" title="只保留3位小数"></a>只保留3位小数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.text.NumberFormat numberFormat = java.text.NumberFormat.getNumberInstance();</span><br><span class="line">numberFormat.setMaximumFractionDigits(<span class="number">3</span>);</span><br><span class="line">System.out.println(numberFormat.format(<span class="number">3.1415927</span>d)); <span class="comment">// 3.142</span></span><br></pre></td></tr></table></figure>
<h3 id="数字转成百分比"><a href="#数字转成百分比" class="headerlink" title="数字转成百分比"></a>数字转成百分比</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.text.NumberFormat percentFormat = java.text.NumberFormat.getPercentInstance();</span><br><span class="line">percentFormat.setMaximumFractionDigits(<span class="number">2</span>); <span class="comment">// 最大小数位数</span></span><br><span class="line">percentFormat.setMinimumFractionDigits(<span class="number">2</span>); <span class="comment">// 最小小数位数</span></span><br><span class="line">percentFormat.setMaximumIntegerDigits(<span class="number">2</span>); <span class="comment">// 最大整数位数，多了会截掉最前面的</span></span><br><span class="line">percentFormat.setMinimumIntegerDigits(<span class="number">2</span>); <span class="comment">// 最小整数位数，不够会在最前面补0</span></span><br><span class="line">System.out.println(percentFormat.format(<span class="number">3.1415927</span>d)); <span class="comment">// 14.16%</span></span><br><span class="line">System.out.println(percentFormat.format(<span class="number">0.0415927</span>d)); <span class="comment">// 04.16%</span></span><br></pre></td></tr></table></figure>
<h3 id="btrace的使用"><a href="#btrace的使用" class="headerlink" title="btrace的使用"></a>btrace的使用</h3><p>要使用btrace，必须先到这里下载：<br><a href="https://github.com/btraceio/btrace">https://github.com/btraceio/btrace</a><br>下载之后，解压到指定目录，还要配置系统的环境变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/hewentian/Downloads</span><br><span class="line"></span><br><span class="line">$ tar xf btrace-bin-1.3.11.tar.gz </span><br><span class="line">$ mv btrace-bin-1.3.11 /usr/<span class="built_in">local</span>/btrace-bin-1.3.11/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改环境变量</span></span><br><span class="line">$ vi /etc/profile</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在/etc/profile中增加以下内容</span></span><br><span class="line"><span class="comment"># add btrace</span></span><br><span class="line"><span class="built_in">export</span> BTRACE_HOME=/usr/<span class="built_in">local</span>/btrace-bin-1.3.11</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$BTRACE_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure></p>
<p>下面用一个例子，演示如何使用：<br>示例1：获取方法参数以及返回值<br>将下面的代码保存为BTraceTest.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.hewentian;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;BTtraceTest.java&lt;/b&gt; 是</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 3:57:22 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BTraceTest</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">whoAreYou</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			Thread.sleep(<span class="number">5000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="string">"I'm "</span> + name + <span class="string">", "</span> + age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">			String sayYou = whoAreYou(<span class="string">"Lily"</span>, <span class="number">23</span>);</span><br><span class="line">			System.out.println(sayYou);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面的是测试代码，同样是JAVA代码，将其保存为Btrace.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;Btrace.java&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 4:02:37 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.sun.btrace.BTraceUtils.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.btrace.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Btrace</span> </span>&#123;</span><br><span class="line">	<span class="meta">@OnMethod</span>(clazz = <span class="string">"com.hewentian.BTraceTest"</span>, method = <span class="string">"whoAreYou"</span>, location = <span class="meta">@Location</span>(Kind.RETURN))</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">whoAreYou</span><span class="params">(String name, <span class="keyword">int</span> age, @Return String result)</span> </span>&#123;</span><br><span class="line">		println(<span class="string">"name: "</span> + name);</span><br><span class="line">		println(<span class="string">"age: "</span> + age);</span><br><span class="line">		println(result);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面开始测试：<br>在一个console中执行如下命令，将程序启动<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ javac -d . BTraceTest.java	<span class="comment"># 编译</span></span><br><span class="line">$ java com.hewentian.BTraceTest <span class="comment"># 运行</span></span><br><span class="line"></span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">btrace WARNING: Invalid <span class="string">'libs'</span> configuration [null]. Path <span class="string">'/usr/local/btrace-bin-1.3.11/build/btrace-libs'</span> does not exist.</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br></pre></td></tr></table></figure></p>
<p>在另一个console中执行如下命令，查询上面的程序的PID，以便用于监控<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ jps -v</span><br><span class="line">4498 BTraceTest</span><br><span class="line">4516 Jps -Denv.class.path=.:/usr/<span class="built_in">local</span>/java/jdk1.8.0_102/lib:/usr/<span class="built_in">local</span>/java/jdk1.8.0_102/jre/lib: -Dapplication.home=/usr/<span class="built_in">local</span>/java/jdk1.8.0_102 -Xms8m</span><br><span class="line">2614 org.eclipse.equinox.launcher_1.4.0.v20161219-1356.jar -Dosgi.requiredJavaVersion=1.8 -Xms40m -Dosgi.module.lock.timeout=10 -Xverify:none -Xmx1200m</span><br></pre></td></tr></table></figure></p>
<p>可以看到，我们的程序BTraceTest的PID为4498，执行下面的程序，开启btrace<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ btrace 4498 Btrace.java</span><br><span class="line"></span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">name: Lily</span></span><br><span class="line"><span class="string">age: 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br><span class="line"><span class="string">name: Lily</span></span><br><span class="line"><span class="string">age: 23</span></span><br><span class="line"><span class="string">I'</span>m Lily, 23</span><br><span class="line">name: Lily</span><br><span class="line">age: 23</span><br><span class="line">I<span class="string">'m Lily, 23</span></span><br></pre></td></tr></table></figure></p>
<p>示例2：计算方法运行消耗的时间，这在实际中非常有用<br>将下面的代码保存为BtraceDuration.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;BtraceDuration.java&lt;/b&gt; 是 </span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2018-04-19 4:46:50 PM</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> com.sun.btrace.BTraceUtils.*;</span><br><span class="line"><span class="keyword">import</span> com.sun.btrace.annotations.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@BTrace</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BtraceDuration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@OnMethod</span>(clazz = <span class="string">"com.hewentian.BTraceTest"</span>, method = <span class="string">"whoAreYou"</span>, location = <span class="meta">@Location</span>(Kind.RETURN))</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">whoAreYou</span><span class="params">(@Duration <span class="keyword">long</span> duration)</span> </span>&#123;</span><br><span class="line">		println(strcat(<span class="string">"duration(ms): "</span>, str(duration / <span class="number">1000000</span>))); <span class="comment">// duration的单位是纳秒，要除以 1,000,000 才是毫秒</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样是按示例1的流程执行即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ jps</span><br><span class="line"><span class="number">2614</span> org.eclipse.equinox.launcher_1.4.0.v20161219-<span class="number">1356</span>.jar</span><br><span class="line"><span class="number">5258</span> Jps</span><br><span class="line"><span class="number">5243</span> BTraceTest</span><br><span class="line"></span><br><span class="line">$ btrace <span class="number">5243</span> BtraceDuration.java </span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br><span class="line">duration(ms): <span class="number">5000</span></span><br></pre></td></tr></table></figure></p>
<p>btrace的介绍就到这里，这只是入门。更多内容，参考了：<a href="http://calvin1978.blogcn.com/articles/btrace1.html。这篇文章写得非常好。" target="_blank" rel="noopener">http://calvin1978.blogcn.com/articles/btrace1.html。这篇文章写得非常好。</a></p>
<p>在我们对一个对象的方法加锁的时候，需要考虑业务的整体性，即为getter/setter方法同时加锁synchronized同步关键字，保证业务的原子性。以免出现脏读。</p>
<p>关键字synchronized拥有重入锁的功能，也就是说在使用synchronized时，当一个线程得到了一个对象的锁后，再次请求此对象时是可以再次得到该对象的锁。</p>
<p>同步方法直接在方法上加synchronized实现加锁，同步代码块则在方法内部加锁，很明显，同步方法锁的范围比较大，而同步代码块范围要小点，一般同步的范围越大，性能就越差，一般需要加锁进行同步的时候，肯定是范围越小越好，这样性能更好</p>
<p>ReentrantLock可重入锁的意思是，一个线程可以对已被加锁的ReentrantLock锁再次加锁，ReentrantLock对象会维持一个计数器来追踪lock()方法的嵌套调用，线程在每次调用lock()加锁后，必须显式调用unlock()来释放锁，所以一段被锁保护的代码可以调用另一个被相同锁保护的方法。</p>
<p>所以我们在用synchronized关键字的时候，能缩小代码段的范围就尽量缩小，能在代码段上加同步就不要再整个方法上加同步。这叫减小锁的粒度，使代码更大程度的并发。</p>
<p>wait notfiy 方法，wait释放锁，notfiy不释放锁。用这种方式会有不实时的坏处。因为虽然A线程发出了notify，但是它不释放锁，这样B线程还需要wait直到A执行完它的时间片。可以使用CountDownLatch来实现实时。</p>
<p>Object类的方法有：</p>
<ol>
<li>public: notify(), notifyAll();</li>
<li>public: wait(), wait(long),wait(long, int);</li>
<li>public: toString(), equals(Object), hashCode(), getClass();</li>
<li>protected: clone(), finalize();</li>
<li>private: registerNatives().</li>
</ol>
<p>动态类型语言的关键特征是它的类型检查的主体过程是在运行期而不是在编译期。</p>
<p>java性能测试工具jmeter：<a href="http://jmeter.apache.org/" target="_blank" rel="noopener">http://jmeter.apache.org/</a><br>和它的好搭档badboy：<a href="http://www.badboy.com.au/" target="_blank" rel="noopener">http://www.badboy.com.au/</a><br>jvisualvm</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/16/java-note/" data-id="cjoo8xasm000wu23khlprv2t8" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java/">java</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-maven-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/10/maven-note/" class="article-date">
  <time datetime="2017-11-09T16:48:44.000Z" itemprop="datePublished">2017-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/maven-note/">maven笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在<code>eclipse</code>中，遇到Missing artifact jdk.tools:jdk.tools:jar:1.8</p>
<p>原因：tools.jar包是JDK的，而tools.jar并未在仓库<code>maven repository</code>中</p>
<p>解决方案：在pom文件中添加如下代码即可<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jdk.tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdk.tools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;JAVA_HOME&#125;/lib/tools.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在 pom.xml文件中不要写如下这样的配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">java.home</span>&gt;</span>/usr/local/java/jdk1.8.0_102<span class="tag">&lt;/<span class="name">java.home</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jre<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jre<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.home&#125;/lib/rt.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>去掉<code>&lt;java.home&gt;/usr/local/java/jdk1.8.0_102&lt;/java.home&gt;</code>配置，这时<code>java.home</code>变量继承自<code>eclipse</code>的<code>java.home</code>配置。从pom.xml文件的Effective POM可以查看到java.home变量被替换了，eclipse的java.home路径在<code>help-&gt;about eclipse-&gt;Installation Details-&gt;configuration</code>页可以找到。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/10/maven-note/" data-id="cjoo8xast001gu23km5r8o1mz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-html-css" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/10/html-css/" class="article-date">
  <time datetime="2017-11-09T16:37:57.000Z" itemprop="datePublished">2017-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/html-css/">html-css前端相关</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将图片二进制流显示在html端的img控件中，在获取验证码的时候用得比较多，方法如下<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"data:image/jpeg;base64,fejwiqpofewqlfjewqjfewopfjef..."</span>&gt;</span></span><br><span class="line"></span><br><span class="line">在 src 后面加上 data:image/jpeg;base64,二进制码.</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/10/html-css/" data-id="cjoo8xask000nu23kcchs5ort" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-java-get-entity-property-and-value" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/11/10/java-get-entity-property-and-value/" class="article-date">
  <time datetime="2017-11-09T16:16:59.000Z" itemprop="datePublished">2017-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/11/10/java-get-entity-property-and-value/">java 获取对象的所有属性和它们的值</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>下面我们展示如何获取对象的所有属性和它们的值，首先我们新建一个实体类：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;User&lt;/b&gt; 是 测试用的类</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017年11月10日 上午12:19:18</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** id */</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 姓名 */</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 年龄 */</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(Integer id, String name, Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>这里我们用到了<code>apache</code>提供的工具包<code>commons-beanutils-1.9.3.jar</code>，详细代码如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.PropertyDescriptor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.beanutils.PropertyUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;GetPropertyAndValue&lt;/b&gt; 是 获取对象的所有属性和它们的值</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> &lt;a href="mailto:wentian.he@qq.com"&gt;hewentian&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2017年11月10日 上午12:20:09</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> JDK 1.8</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GetPropertyAndValue</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		User user = <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">"Tim Ho"</span>, <span class="number">23</span>);</span><br><span class="line"></span><br><span class="line">		List&lt;String&gt; properties = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"获取所有属性"</span>);</span><br><span class="line">		PropertyDescriptor[] pds = PropertyUtils.getPropertyDescriptors(user.getClass());</span><br><span class="line">		<span class="keyword">for</span> (PropertyDescriptor pd : pds) &#123;</span><br><span class="line">			System.out.println(pd.getName() + <span class="string">"\t"</span> + pd.getPropertyType());</span><br><span class="line">			properties.add(pd.getName());</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		System.out.println(<span class="string">"\n根据属性获取这个属性的值"</span>);</span><br><span class="line">		properties.stream().forEach(p -&gt; &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Object value = PropertyUtils.getProperty(user, p);</span><br><span class="line">				System.out.println(p + <span class="string">"\t"</span> + value);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IllegalAccessException | InvocationTargetException | NoSuchMethodException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>输出结果如下：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">获取所有属性</span><br><span class="line">name	<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span></span></span><br><span class="line"><span class="class"><span class="title">id</span>	<span class="title">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span></span></span><br><span class="line"><span class="class"><span class="title">class</span>	<span class="title">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Class</span></span></span><br><span class="line"><span class="class"><span class="title">age</span>	<span class="title">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Integer</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">根据属性获取这个属性的值</span></span><br><span class="line"><span class="class"><span class="title">name</span>	<span class="title">Tim</span> <span class="title">Ho</span></span></span><br><span class="line"><span class="class"><span class="title">id</span>	1</span></span><br><span class="line"><span class="class"><span class="title">class</span>	<span class="title">class</span> <span class="title">com</span>.<span class="title">hewentian</span>.<span class="title">User</span></span></span><br><span class="line"><span class="class"><span class="title">age</span>	23</span></span><br></pre></td></tr></table></figure></p>
<p>end.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/11/10/java-get-entity-property-and-value/" data-id="cjoo8xasl000qu23kwrzm4191" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-solr-note" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/29/solr-note/" class="article-date">
  <time datetime="2017-10-29T04:12:26.000Z" itemprop="datePublished">2017-10-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/bigdata/">bigdata</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/29/solr-note/">solr学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="HttpSolrClient"><a href="#HttpSolrClient" class="headerlink" title="HttpSolrClient"></a>HttpSolrClient</h3><p>HttpSolrClient 使用 HTTPClient 和 solr 服务器进行通信。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.impl.HttpSolrClient;</span><br><span class="line"></span><br><span class="line">String baseSolrUrl = <span class="string">"http://localhost:8983/solr/"</span>;</span><br><span class="line"></span><br><span class="line">HttpSolrClient solrClient = <span class="keyword">new</span> HttpSolrClient.Builder().withBaseSolrUrl(baseSolrUrl).build();</span><br><span class="line">solrClient.setConnectionTimeout(<span class="number">1000</span>);</span><br><span class="line">solrClient.setDefaultMaxConnectionsPerHost(<span class="number">100</span>);</span><br><span class="line">solrClient.setMaxTotalConnections(<span class="number">100</span>);</span><br></pre></td></tr></table></figure></p>
<p>HttpSolrClient 是线程安全的，建议重复使用 HttpSolrClient 实例。</p>
<h3 id="EmbeddedSolrServer"><a href="#EmbeddedSolrServer" class="headerlink" title="EmbeddedSolrServer"></a>EmbeddedSolrServer</h3><p>EmbeddedSolrServer 提供和 HttpSolrClient 相同的接口，它不需要http连接。如果，你使用的是一个本地的 solrServer 的话，这是一个不错的选择。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.solr.client.solrj.embedded.EmbeddedSolrServer;</span><br><span class="line"><span class="keyword">import</span> org.apache.solr.core.CoreContainer;</span><br><span class="line"></span><br><span class="line">System.setProperty(<span class="string">"solr.solr.home"</span>, <span class="string">"/home/hewentian/ProjectD/solr-6.5.0/server/solr"</span>);</span><br><span class="line">		</span><br><span class="line">CoreContainer coreContainer = <span class="keyword">new</span> CoreContainer(<span class="string">"/home/hewentian/ProjectD/solr-6.5.0/server/solr"</span>);</span><br><span class="line">coreContainer.load(); <span class="comment">// don't forge to invoke this method since solr 4.4.0</span></span><br><span class="line">		</span><br><span class="line">EmbeddedSolrServer embeddedSolrServer = <span class="keyword">new</span> EmbeddedSolrServer(coreContainer, coreName);</span><br></pre></td></tr></table></figure></p>
<p>通过 POJO 方式往 Solr 中添加 doc 时，要使用 注解<code>@org.apache.solr.client.solrj.beans.Field</code>，@Field 可以被用在域上，或者是setter方法上。如果一个域的名称跟bean的名称是不一样的，那么在java注释中填写别名，具体的，可以参照下面的例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">/** 用户id */</span></span><br><span class="line">	<span class="meta">@Field</span></span><br><span class="line">	<span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 名字 */</span></span><br><span class="line">	<span class="meta">@Field</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** 年龄 */</span></span><br><span class="line">	<span class="meta">@Field</span></span><br><span class="line">	<span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// getter setter method</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>当将一个 doc 往 solr 中添加之后，要记得调用 commit 方法，当然，如果在 solrconfig.xml 中有配置硬/软提交的，可以省略<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SolrClient solrClient = createSolrClient(baseSolrUrl);</span><br><span class="line">UpdateResponse response = solrClient.addBean(collection, user);</span><br><span class="line"></span><br><span class="line">solrClient.commit(collection);</span><br><span class="line">solrClient.close();</span><br></pre></td></tr></table></figure></p>
<p>Group 分组划分结果，返回的是分组结果；<br>Facet 分组统计，侧重统计，返回的是分组后的数量；<br>下面分别说下</p>
<h3 id="Facet查询"><a href="#Facet查询" class="headerlink" title="Facet查询"></a>Facet查询</h3><p>进行Facet查询需要在请求参数中加入”facet=on”或者”facet=true”只有这样Facet组件才起作用.<br>搜索结果按照Facet的字段分组并统计<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">solrQuery.setQuery(<span class="string">"老师"</span>);</span><br><span class="line">solrQuery.setFacet(<span class="keyword">true</span>);</span><br><span class="line">solrQuery.setFacetMinCount(<span class="number">1</span>); <span class="comment">// 统计结果大于 1 的才会返回</span></span><br><span class="line">solrQuery.setFacetLimit(<span class="number">10</span>); <span class="comment">// 对于每一个 field 最多返回 10 个结果</span></span><br><span class="line">solrQuery.addFacetField(<span class="string">"age"</span>, <span class="string">"name"</span>);</span><br><span class="line">solrQuery.setRows(<span class="number">0</span>); <span class="comment">// 设置返回结果条数，如果分组查询，就设置为0</span></span><br><span class="line"></span><br><span class="line">QueryResponse queryResponse = SolrUtils.getQueryResponse(baseSolrUrl, collection, solrQuery);</span><br><span class="line">List&lt;FacetField&gt; facetFields = queryResponse.getFacetFields();</span><br><span class="line">facetFields.stream().forEach(ff -&gt; &#123;</span><br><span class="line">	ff.getValues().stream().forEach(c -&gt; &#123;</span><br><span class="line">		System.out.println(c.getName() + <span class="string">", "</span> + c.getCount());</span><br><span class="line">	&#125;);</span><br><span class="line">	System.out.println();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">///~: output</span></span><br><span class="line"><span class="number">50</span>, <span class="number">3</span></span><br><span class="line"><span class="number">20</span>, <span class="number">2</span></span><br><span class="line"><span class="number">40</span>, <span class="number">1</span></span><br><span class="line"></span><br><span class="line">陈六, <span class="number">2</span></span><br><span class="line">张三, <span class="number">1</span></span><br><span class="line">李七, <span class="number">1</span></span><br><span class="line">李四, <span class="number">1</span></span><br><span class="line">王五, <span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>facet的参数见solr官方wiki  <a href="http://wiki.apache.org/solr/SimpleFacetParameters" target="_blank" rel="noopener">http://wiki.apache.org/solr/SimpleFacetParameters</a></p>
<p>facet 参数字段要求:<br>1.字段必须被索引<br>2.facet=on 或 facet=true</p>
<p>1.facet.field<br>分组的字段<br>2.facet.prefix<br>表示Facet字段前缀<br>3.facet.limit<br>Facet字段返回条数<br>4.facet.offict<br>开始条数,偏移量,它与facet.limit配合使用可以达到分页的效果<br>5.facet.mincount<br>Facet字段最小count,默认为0<br>6.facet.missing<br>如果为on或true,那么将统计那些Facet字段值为null的记录<br>7.facet.method<br>取值为enum或fc,默认为fc, fc表示Field Cache<br>8.facet.enum.cache.minDf<br>当facet.method=enum时,参数起作用,文档内出现某个关键字的最少次数</p>
<h3 id="Group查询"><a href="#Group查询" class="headerlink" title="Group查询"></a>Group查询</h3><p>分组统计查询不同于分组统计（Facet），facet只是简单统计记录数，并不能为每组数据返回实际的数据回来，solr提供的grouping查询能够解决这一问题，也就是说，他除了能分组外，还能把每组数据返回来。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">SolrQuery solrQuery = <span class="keyword">new</span> SolrQuery();</span><br><span class="line">solrQuery.setQuery(<span class="string">"*:*"</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP, <span class="keyword">true</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_FIELD, <span class="string">"age"</span>, <span class="string">"name"</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_LIMIT, <span class="number">3</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_FORMAT, <span class="string">"grouped"</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_MAIN, <span class="keyword">false</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_TOTAL_COUNT, <span class="keyword">true</span>);</span><br><span class="line">solrQuery.set(GroupParams.GROUP_SORT, <span class="string">"age asc"</span>);</span><br><span class="line"></span><br><span class="line">QueryResponse queryResponse = SolrUtils.getQueryResponse(baseSolrUrl, collection, solrQuery);</span><br><span class="line"><span class="comment">// 通过GroupResponse获取GroupCommand，进而通过GroupCommand获取Group，而Group又可以获得SolrDocumentList</span></span><br><span class="line">GroupResponse groupResponse = queryResponse.getGroupResponse();</span><br><span class="line">List&lt;GroupCommand&gt; groupCommands = groupResponse.getValues();</span><br><span class="line"><span class="keyword">for</span> (GroupCommand gc : groupCommands) &#123;</span><br><span class="line">	System.out.println(<span class="string">"\n########## group name: "</span> + gc.getName());</span><br><span class="line">	<span class="comment">// 只有设置 GroupParams.GROUP_TOTAL_COUNT 这里 getNGroups 才有效果</span></span><br><span class="line">	System.out.println(<span class="string">"########## Num of Groups Found: "</span> + gc.getNGroups()); </span><br><span class="line">	System.out.println(<span class="string">"########## Num of documents Found: "</span> + gc.getMatches());</span><br><span class="line"></span><br><span class="line">	List&lt;Group&gt; groups = gc.getValues();</span><br><span class="line">	<span class="keyword">for</span> (Group g : groups) &#123;</span><br><span class="line">		SolrDocumentList solrDocumentList = g.getResult();</span><br><span class="line">		System.out.println(<span class="string">"\n########## group name: "</span> + gc.getName() + <span class="string">", groupValue: "</span> + g.getGroupValue()</span><br><span class="line">				+ <span class="string">", Num of Documents in this group: "</span> + solrDocumentList.getNumFound());</span><br><span class="line">		<span class="keyword">if</span> (CollectionUtils.isNotEmpty(solrDocumentList)) &#123;</span><br><span class="line">			<span class="keyword">for</span> (SolrDocument sd : solrDocumentList) &#123;</span><br><span class="line">				System.out.println(sd);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="solr建立索引的过程和查询过程"><a href="#solr建立索引的过程和查询过程" class="headerlink" title="solr建立索引的过程和查询过程"></a>solr建立索引的过程和查询过程</h2><h3 id="solr索引建立："><a href="#solr索引建立：" class="headerlink" title="solr索引建立："></a>solr索引建立：</h3><p>第一步：solr会对句子进行空格分隔，比如对 JAVA is a kind of computer language 分词，分为JAVA，is，a，kind，of，computer，language;</p>
<p>第二步：solr会对上面分出来的词，去掉停用词，这里比如a，is;</p>
<p>第三部：solr会对上面分出来的英文都转化为小写 java,kind,of,computer,language。</p>
<h3 id="solr查询过程："><a href="#solr查询过程：" class="headerlink" title="solr查询过程："></a>solr查询过程：</h3><p>第一步：同索引过程；</p>
<p>第二步：同索引过程；</p>
<p>第三部：同索引过程；</p>
<p>最后分词匹配成功，那么索引的那句话就会被查询出来，这里需要注意：索引和查询的分词器必须使用一样的！！！</p>
<h2 id="下面说说Solr基础"><a href="#下面说说Solr基础" class="headerlink" title="下面说说Solr基础"></a>下面说说Solr基础</h2><p>部分内容转载自如下网址，详情请参阅：<br><a href="http://blog.csdn.net/awj3584/article/details/16963525" target="_blank" rel="noopener">http://blog.csdn.net/awj3584/article/details/16963525</a><br><a href="https://lucene.apache.org/solr/guide/" target="_blank" rel="noopener">https://lucene.apache.org/solr/guide/</a><br>以下部分为抄录内容</p>
<h3 id="types-部分"><a href="#types-部分" class="headerlink" title="types 部分"></a>types 部分</h3><p>是一些常见的可重用定义，定义了 Solr（和 Lucene）如何处理 Field。也就是添加到索引中的xml文件属性中的类型，如int、text、date等.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"string"</span> <span class="attr">class</span>=<span class="string">"solr.StrField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"boolean"</span> <span class="attr">class</span>=<span class="string">"solr.BoolField"</span> <span class="attr">sortMissingLast</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"int"</span> <span class="attr">class</span>=<span class="string">"solr.TrieIntField"</span> <span class="attr">precisionStep</span>=<span class="string">"0"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">fieldType</span> <span class="attr">name</span>=<span class="string">"text_general"</span> <span class="attr">class</span>=<span class="string">"solr.TextField"</span> <span class="attr">positionIncrementGap</span>=<span class="string">"100"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> <span class="attr">enablePositionIncrements</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">analyzer</span> <span class="attr">type</span>=<span class="string">"query"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tokenizer</span> <span class="attr">class</span>=<span class="string">"solr.StandardTokenizerFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.StopFilterFactory"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">words</span>=<span class="string">"stopwords.txt"</span> <span class="attr">enablePositionIncrements</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.SynonymFilterFactory"</span> <span class="attr">synonyms</span>=<span class="string">"synonyms.txt"</span> <span class="attr">ignoreCase</span>=<span class="string">"true"</span> <span class="attr">expand</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"solr.LowerCaseFilterFactory"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">analyzer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fieldType</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>参数说明:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td style="text-align:left">标识而已</td>
</tr>
<tr>
<td>class</td>
<td style="text-align:left">和其他属性决定了这个fieldType的实际行为。</td>
</tr>
<tr>
<td>sortMissingLast</td>
<td style="text-align:left">设置成true没有该field的数据排在有该field的数据之后，而不管请求时的排序规则, 默认是设置成false。</td>
</tr>
<tr>
<td>sortMissingFirst</td>
<td style="text-align:left">跟上面倒过来呗。 默认是设置成false</td>
</tr>
<tr>
<td>analyzer</td>
<td style="text-align:left">字段类型指定的分词器</td>
</tr>
<tr>
<td>type</td>
<td style="text-align:left">当前分词用用于的操作.index代表生成索引时使用的分词器query代码在查询时使用的分词器</td>
</tr>
<tr>
<td>tokenizer</td>
<td style="text-align:left">分词器类</td>
</tr>
<tr>
<td>filter</td>
<td style="text-align:left">分词后应用的过滤器  过滤器调用顺序和配置相同.</td>
</tr>
</tbody>
</table>
<h3 id="fileds"><a href="#fileds" class="headerlink" title="fileds"></a>fileds</h3><p>是你添加到索引文件中出现的属性名称，而声明类型就需要用到上面的types<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"id"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">required</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"path"</span> <span class="attr">type</span>=<span class="string">"text_smartcn"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> <span class="attr">termVector</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">type</span>=<span class="string">"text_smartcn"</span> <span class="attr">indexed</span>=<span class="string">"false"</span> <span class="attr">stored</span>=<span class="string">"true"</span> <span class="attr">multiValued</span>=<span class="string">"false"</span> <span class="attr">termVector</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span> =<span class="string">"text"</span> <span class="attr">type</span> =<span class="string">"text_ik"</span> <span class="attr">indexed</span> =<span class="string">"true"</span> <span class="attr">stored</span> =<span class="string">"false"</span> <span class="attr">multiValued</span> =<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span> =<span class="string">"pinyin"</span> <span class="attr">type</span> =<span class="string">"text_pinyin"</span> <span class="attr">indexed</span> =<span class="string">"true"</span> <span class="attr">stored</span> =<span class="string">"false"</span> <span class="attr">multiValued</span> =<span class="string">"false"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"_version_"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_i"</span> <span class="attr">type</span>=<span class="string">"int"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_l"</span> <span class="attr">type</span>=<span class="string">"long"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dynamicField</span> <span class="attr">name</span>=<span class="string">"*_s"</span> <span class="attr">type</span>=<span class="string">"string"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>field: 固定的字段设置<br>dynamicField: 动态的字段设置,用于后期自定义字段,*号通配符.例如: test_i就是int类型的动态字段.<br>还有一个特殊的字段copyField,一般用于检索时用的字段这样就只对这一个字段进行索引分词就行了copyField的dest属性如果有多个source一定要设置multiValued=true,否则会报错的<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"content"</span> <span class="attr">dest</span>=<span class="string">"pinyin"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"content"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">copyField</span> <span class="attr">source</span>=<span class="string">"pinyin"</span> <span class="attr">dest</span>=<span class="string">"text"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">field</span> <span class="attr">name</span>=<span class="string">"text"</span> <span class="attr">type</span>=<span class="string">"text_general"</span> <span class="attr">indexed</span>=<span class="string">"true"</span> <span class="attr">stored</span>=<span class="string">"false"</span> <span class="attr">multiValued</span>=<span class="string">"true"</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>字段属性说明:</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td style="text-align:left">字段类型名</td>
</tr>
<tr>
<td>class</td>
<td style="text-align:left">java类名</td>
</tr>
<tr>
<td>indexed</td>
<td style="text-align:left">缺省true。 说明这个数据应被搜索和排序，如果数据没有indexed，则stored应是true。</td>
</tr>
<tr>
<td>stored</td>
<td style="text-align:left">缺省true。说明这个字段被包含在搜索结果中是合适的。如果数据没有stored,则indexed应是true。</td>
</tr>
<tr>
<td>omitNorms</td>
<td style="text-align:left">字段的长度不影响得分和在索引时不做boost时，设置它为true。一般文本字段不设置为true。</td>
</tr>
<tr>
<td>termVectors</td>
<td style="text-align:left">如果字段被用来做more like this 和highlight的特性时应设置为true。</td>
</tr>
<tr>
<td>compressed</td>
<td style="text-align:left">字段是压缩的。这可能导致索引和搜索变慢，但会减少存储空间，只有StrField和TextField是可以压缩，这通常适合字段的长度超过200个字符。</td>
</tr>
<tr>
<td>multiValued</td>
<td style="text-align:left">字段多于一个值的时候，可设置为true。</td>
</tr>
<tr>
<td>positionIncrementGap</td>
<td style="text-align:left">和multiValued一起使用，设置多个值之间的虚拟空白的数量</td>
</tr>
</tbody>
</table>
<p>注意:<em>version</em> 是一个特殊字段,不能删除,是记录当前索引版本号的.</p>
<p>uniqueKey: 唯一键，这里配置的是上面出现的fileds，一般是id、url等不重复的。在更新、删除的时候可以用到。<br>defaultSearchField: 默认搜索属性，如q=solr就是默认的搜索那个字段（默认搜text，其他字段的值会copy到这个field）<br>solrQueryParser: 查询转换模式，是并且还是或者（AND/OR必须大写）</p>
<h2 id="solr配置solrconfig-xml"><a href="#solr配置solrconfig-xml" class="headerlink" title="solr配置solrconfig.xml"></a>solr配置solrconfig.xml</h2><p>对于我的机器来说，是在以下目录：/home/hewentian/ProjectD/solr-6.5.0/server/solr/mysqlCore/conf/solrconfig.xml</p>
<h3 id="索引indexConfig"><a href="#索引indexConfig" class="headerlink" title="索引indexConfig"></a>索引indexConfig</h3><p>Solr 性能因素，来了解与各种更改相关的性能权衡。 下表概括了可控制 Solr 索引处理的各种因素：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>useCompoundFile</td>
<td style="text-align:left">通过将很多 Lucene 内部文件整合到一个文件来减少使用中的文件的数量。这可有助于减少 Solr 使用的文件句柄数目，代价是降低了性能。除非是应用程序用完了文件句柄，否则 false 的默认值应该就已经足够。</td>
</tr>
<tr>
<td>ramBufferSizeMB</td>
<td style="text-align:left">在添加或删除文档时，为了减少频繁的更些索引,Solr会选缓存在内存中,当内存中的文件大于设置的值,才会更新到索引库。较大的值可使索引时间变快但会牺牲较多的内存。</td>
</tr>
<tr>
<td>maxBufferedDocs</td>
<td style="text-align:left">同 ramBufferSizeMB，如两个值同时设置,满足一个就会进行刷新索引.</td>
</tr>
<tr>
<td>mergeFactor</td>
<td style="text-align:left">决定低水平的 Lucene 段被合并的频率。较小的值（最小为 2）使用的内存较少但导致的索引时间也更慢。较大的值可使索引时间变快但会牺牲较多的内存。</td>
</tr>
<tr>
<td>maxIndexingThreads</td>
<td style="text-align:left">是indexWriter生成索引时使用的最大线程数</td>
</tr>
<tr>
<td>unlockOnStartup</td>
<td style="text-align:left">unlockOnStartup 告知 Solr 忽略在多线程环境中用来保护索引的锁定机制。在某些情况下，索引可能会由于不正确的关机或其他错误而一直处于锁定，这就妨碍了添加和更新。将其设置为 true  可以禁用启动锁定，进而允许进行添加和更新。</td>
</tr>
<tr>
<td>lockType</td>
<td style="text-align:left">1. single: 在只读索引或是没有其它进程修改索引时使用. 2. native: 使用操作系统本地文件锁,不能使用多个Solr在同一个JVM中共享一个索引. 3. simple :使用一个文本文件锁定索引.</td>
</tr>
</tbody>
</table>
<h3 id="查询配置query"><a href="#查询配置query" class="headerlink" title="查询配置query"></a>查询配置query</h3><table>
<thead>
<tr>
<th>属性</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>maxBooleanClauses</td>
<td style="text-align:left">最大的BooleanQuery数量. 当值超出时，抛出 TooManyClausesException.注意这个是全局的,如果是多个SolrCore都会使用一个值,每个Core里设置不一样的话,会使用最后一个的.</td>
</tr>
<tr>
<td>filterCache</td>
<td style="text-align:left">filterCache存储了无序的lucene document id集合，1.存储了filter queries(“fq”参数)得到的document id集合结果。2.还可用于facet查询。3. 如果配置了useFilterForSortedQuery，那么如果查询有filter，则使用filterCache。</td>
</tr>
<tr>
<td>queryResultCache</td>
<td style="text-align:left">缓存搜索结果,一个文档ID列表</td>
</tr>
<tr>
<td>documentCache</td>
<td style="text-align:left">缓存Lucene的Document对象,不会自热</td>
</tr>
<tr>
<td>fieldValueCache</td>
<td style="text-align:left">字段缓存使用文档ID进行快速访问。默认情况下创建fieldValueCache即使这里没有配置。</td>
</tr>
<tr>
<td>enableLazyFieldLoading</td>
<td style="text-align:left">若应用程序预期只会检索 Document 上少数几个 Field，那么可以将属性设置为 true。延迟加载的一个常见场景大都发生在应用程序返回和显示一系列搜索结果的时候，用户常常会单击其中的一个来查看存储在此索引中的原始文档。初始的显示常常只需要显示很短的一段信息。若考虑到检索大型 Document 的代价，除非必需，否则就应该避免加载整个文档。</td>
</tr>
<tr>
<td>queryResultWindowSize</td>
<td style="text-align:left">一次查询中存储最多的doc的id数目.</td>
</tr>
<tr>
<td>queryResultMaxDocsCached</td>
<td style="text-align:left">查询结果doc的最大缓存数量, 例如要求每页显示10条,这里设置是20条,也就是说缓存里总会给你多出10条的数据.让你点示下一页时很快拿到数据.</td>
</tr>
<tr>
<td>listener</td>
<td style="text-align:left">选项定义 newSearcher 和 firstSearcher 事件，您可以使用这些事件来指定实例化新搜索程序或第一个搜索程序时应该执行哪些查询。如果应用程序期望请求某些特定的查询，那么在创建新搜索程序或第一个搜索程序时就应该反注释这些部分并执行适当的查询。</td>
</tr>
<tr>
<td>useColdSearcher</td>
<td style="text-align:left">是否使用冷搜索,为false时使用自热后的searcher</td>
</tr>
<tr>
<td>maxWarmingSearchers</td>
<td style="text-align:left">最大自热searcher数量</td>
</tr>
</tbody>
</table>
<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><p>删除索引可以通过两种方式操作,一种是通过文档ID进行删除, 另一种是通过查询到的结果进行删除.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">通过ID删除方式代码:</span><br><span class="line">solrClient.deleteById(id);</span><br><span class="line"></span><br><span class="line"><span class="comment">//或是使用批量删除</span></span><br><span class="line">solrClient.deleteById(ids);</span><br><span class="line"></span><br><span class="line">通过查询删除方式代码:</span><br><span class="line">solrClient.deleteByQuery(<span class="string">"*:*"</span>); <span class="comment">// ”*:*” 就查询所有内容的, 这样就删除了所有文档索引</span></span><br></pre></td></tr></table></figure></p>
<h3 id="优化索引"><a href="#优化索引" class="headerlink" title="优化索引"></a>优化索引</h3><p>优化Lucene 的索引文件以改进搜索性能。索引完成后执行一下优化通常比较好。如果更新比较频繁，则应该在使用率较低的时候安排优化。一个索引无需优化也可以正常地运行。优化是一个耗时较多的过程。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">solrClient.optimize(); <span class="comment">// 不要频繁的调用, 尽量在无人使用时调用</span></span><br></pre></td></tr></table></figure></p>
<h3 id="查询参数"><a href="#查询参数" class="headerlink" title="查询参数"></a>查询参数</h3><table>
<thead>
<tr>
<th>名称</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>q</td>
<td style="text-align:left">查询字符串，必须的</td>
</tr>
<tr>
<td>fq</td>
<td style="text-align:left">filter query。使用Filter Query可以充分利用Filter Query Cache，提高检索性能。作用：在q查询符合结果中同时是fq查询符合的，例如：q=mm&amp;fq=date_time:[20081001 TO 20091031]，找关键字mm，并且date_time是20081001到20091031之间的</td>
</tr>
<tr>
<td>fl</td>
<td style="text-align:left">field list。指定返回结果字段。以空格“ ”或逗号“,”分隔</td>
</tr>
<tr>
<td>start</td>
<td style="text-align:left">用于分页定义结果起始记录数，默认为0</td>
</tr>
<tr>
<td>rows</td>
<td style="text-align:left">用于分页定义结果每页返回记录数，默认为10</td>
</tr>
<tr>
<td>sort</td>
<td style="text-align:left">排序，格式: sort=&lt;field name&gt;+&lt;desc&#124;asc&gt;[,&lt;field name&gt;+&lt;desc&#124;asc&gt;]… 。示例：（inStock desc, price asc）表示先 “inStock” 降序, 再 “price” 升序，默认是相关性降序。</td>
</tr>
<tr>
<td>df</td>
<td style="text-align:left">默认的查询字段，一般默认指定</td>
</tr>
<tr>
<td>q.op</td>
<td style="text-align:left">覆盖schema.xml的defaultOperator（有空格时用”AND”还是用”OR”操作逻辑），一般默认指定。必须大写</td>
</tr>
<tr>
<td>wt</td>
<td style="text-align:left">writer type。指定查询输出结构格式，默认为“xml”。在solrconfig.xml中定义了查询输出格式：xml、json、python、ruby、php、phps、custom</td>
</tr>
<tr>
<td>qt</td>
<td style="text-align:left">query type，指定查询使用的Query Handler，默认为“standard”</td>
</tr>
<tr>
<td>explainOther</td>
<td style="text-align:left">设置当debugQuery=true时，显示其他的查询说明</td>
</tr>
<tr>
<td>defType</td>
<td style="text-align:left">指定用于处理查询语句(参数q的内容)的查询解析器，eg:defType=lucene</td>
</tr>
<tr>
<td>timeAllowed</td>
<td style="text-align:left">设置查询超时时间</td>
</tr>
<tr>
<td>omitHeader</td>
<td style="text-align:left">设置是否忽略查询结果返回头信息，默认为“false”</td>
</tr>
<tr>
<td>indent</td>
<td style="text-align:left">返回的结果是否缩进，默认关闭，用 indent=true&#124;on 开启，一般调试json,php,phps,ruby输出才有必要用这个参数</td>
</tr>
<tr>
<td>version</td>
<td style="text-align:left">查询语法的版本，建议不使用它，由服务器指定默认值</td>
</tr>
<tr>
<td>debugQuery</td>
<td style="text-align:left">设置返回结果是否显示Debug信息</td>
</tr>
</tbody>
</table>
<h3 id="查询语法"><a href="#查询语法" class="headerlink" title="查询语法"></a>查询语法</h3><ol>
<li><p>匹配所有文档：<em>:</em></p>
</li>
<li><p>强制、阻止和可选查询：<br> 1)Mandatory：查询结果中必须包括的(for example, only entry name containing the word make)<br> Solr/Lucene Statement：+make, +make +up ,+make +up +kiss<br> 2)prohibited：(for example, all documents except those with word believe)<br> Solr/Lucene Statement：+make +up -kiss<br> 3)optional：Solr/Lucene Statement：+make +up kiss</p>
</li>
<li><p>布尔操作：AND、OR和NOT布尔操作（必须大写）与Mandatory、optional和prohibited相似。<br> 1)make AND up ＝ +make +up :AND左右两边的操作都是mandatory<br> 2)make || up ＝ make OR up＝make up :OR左右两边的操作都是optional<br> 3)+make +up NOT kiss ＝ +make +up –kiss<br> 4)make AND up OR french AND Kiss不可以达到期望的结果，因为AND两边的操作都是mandatory的。</p>
</li>
<li><p>子表达式查询（子查询）：可以使用“()”构造子查询。<br> 示例：(make AND up) OR (french AND Kiss)</p>
</li>
<li><p>子表达式查询中阻止查询的限制：<br> 示例：make (-up):只能取得make的查询结果；要使用make (-up <em>:</em>)查询make或者不包括up的结果。</p>
</li>
<li><p>多字段fields查询：通过字段名加上分号的方式（fieldName:query）来进行查询<br> 示例：entryNm:make AND entryId:3cdc86e8e0fb4da8ab17caed42f6760c</p>
</li>
<li><p>通配符查询（wildCard Query）：<br> 1)通配符？和*：“*”表示匹配任意字符；“？”表示匹配出现的位置。<br> 示例：ma?*（ma后面的一个位置匹配），ma??*(ma后面两个位置都匹配)<br> 2)查询字符必须要小写:+Ma +be**可以搜索到结果；+Ma +Be**没有搜索结果.<br> 3)查询速度较慢，尤其是通配符在首位：主要原因一是需要迭代查询字段中的每个term，判断是否匹配；二是匹配上的term被加到内部的查询，当terms数量达到1024的时候，查询会失败。<br> 4)Solr中默认通配符不能出现在首位（可以修改QueryParser，设置setAllowLeadingWildcard为true）</p>
</li>
<li><p>模糊查询、相似查询：不是精确的查询，通过对查询的字段进行重新插入、删除和转换来取得得分较高的查询解决（由Levenstein Distance Algorithm算法支持）。<br> 1)一般模糊查询：示例：make-believ~<br> 2)门槛模糊查询：对模糊查询可以设置查询门槛，门槛是0~1之间的数值，门槛越高表面相似度越高。示例：make-believ~0.5、make-believ~0.8、make-believ~0.9</p>
</li>
<li><p>范围查询（Range Query）：Lucene支持对数字、日期甚至文本的范围查询。结束的范围可以使用“*”通配符。<br>示例：<br> 1)日期范围（ISO-8601 时间GMT）：sa_type:2 AND a_begin_date:[1990-01-01T00:00:00.000Z TO 1999-12-31T24:59:99.999Z]<br> 2)数字：salary:[2000 TO *]<br> 3)文本：entryNm:[a TO a]</p>
</li>
<li><p>日期匹配：YEAR, MONTH, DAY, DATE (synonymous with DAY) HOUR, MINUTE, SECOND, MILLISECOND, and MILLI (synonymous with MILLISECOND)可以被标志成日期。<br>示例：<br>1)r_event_date:[* TO NOW-2YEAR]：2年前的现在这个时间<br>2)r_event_date:[* TO NOW/DAY-2YEAR]：2年前前一天的这个时间</p>
</li>
<li><p>solr的查询语句支持C语言格式的注释。<br><code>&quot;jakarta apache&quot; /* this is a comment in the middle of a normal query string */ OR jakarta</code></p>
</li>
<li><p><code>+ - &amp;&amp; || ! ( ) { } [ ] ^ &quot; ~ * ? : /
这些字符在solr中具有特殊的含义，如果要使用这么字符本身含义，需要利用反斜杠进行转义，比如： \(1\+1\):2</code></p>
</li>
<li><p>solr的查询字符串q中的多个关键字之间默认的关系是 OR<br>例如：红旗 中国 ，代表：红旗 OR 中国</p>
</li>
<li><p>若要搜寻交集结果,请在词与词间加上大写 “AND” 或 “+” (不包含”号).<br>例如: text:总统府 AND text:邮局<br>或<br>+text:总统府 +text:邮局<br>或<br>name:总统府 AND tel:23xxxxxx3<br>或<br>name: ( +总统府 +邮局)</p>
</li>
<li><p>排除查询<br>在要排除的词前加上 “-” (不包含”号) 号<br>例如: 总统府 -邮局<br>搜寻结果不会有包含邮局的词的结果在内</p>
</li>
<li><p>增加权重: 如要搜寻 “中华 加油站”(不包含”号) 但因为回传太多笔资料内有 “中华”(不包含”号) 或 “加油站”(不包含”号) 的结果,<br>所以想要把有包含 “加油站”(不包含”号)的数据往前排,可使用 “^”(不包含”号)符号在后面加上愈增加的权重数,<br>像是 “2″,则可以这样做:<br>中华 加油站^2<br>会同时搜寻含有中华或加油站的结果,并把加油站这个词加权所以搜寻时会先判断加油站这一个词在<br>搜寻结果中的比重,甚至假设一笔数据内加油站出现过两次以上的就更加会有优先权.</p>
</li>
</ol>
<h3 id="标准查询操作符"><a href="#标准查询操作符" class="headerlink" title="标准查询操作符"></a>标准查询操作符</h3><table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>:</code></td>
<td style="text-align:left">指定要查找的字段，比如：title:“The Right Way” AND text:go</td>
</tr>
<tr>
<td><code>？</code></td>
<td style="text-align:left">匹配单一字符，比如: te?t匹配test/text</td>
</tr>
<tr>
<td><code>*</code></td>
<td style="text-align:left">匹配0或多个字符，比如：tes*匹配test/testing/tester</td>
</tr>
<tr>
<td><code>~</code></td>
<td style="text-align:left">基于编辑距离的模糊查询，比如：roam~匹配roams/foam/foams/roam. roam~1(指定距离必须是1)匹配roams/foam，但不会匹配foams</td>
</tr>
<tr>
<td><code>~n</code></td>
<td style="text-align:left">邻近查询，查找相隔一定距离的单词，比如：”jakarta apache”~10（相隔10个单词）    （下面会详细说明<code>~</code> 和 <code>~n</code>的区别）</td>
</tr>
<tr>
<td><code>TO</code></td>
<td style="text-align:left">范围查询，{}不包含边界，[]包含边界，比如：title:{Aida TO Carmen}</td>
</tr>
<tr>
<td><code>^</code></td>
<td style="text-align:left">加权因子，比如:jakarta^4 apache 查找结果中jakarta更相关, 看下面相关度的说明</td>
</tr>
<tr>
<td><code>^=</code></td>
<td style="text-align:left">指定查询语句的score得分为常量，比如：(description:blue OR color:blue)^=1.0 text:shoes</td>
</tr>
<tr>
<td><code>AND(&amp;&amp;)</code></td>
<td style="text-align:left">运算符两边的查询词同时出现 比如：”jakarta apache” AND “Apache Lucene”</td>
</tr>
<tr>
<td><code>OR</code></td>
<td style="text-align:left">运算符两边的查询词至少一个出现, 默认运算符，比如 “jakarta apache” jakarta 等价于 “jakarta apache” OR jakarta</td>
</tr>
<tr>
<td><code>NOT(!)</code></td>
<td style="text-align:left">运算符后面的查询词不出现，比如”jakarta apache” NOT “Apache Lucene”</td>
</tr>
<tr>
<td><code>+</code></td>
<td style="text-align:left">运算符后面的查询词出现(known as the “required” operator),比如+jakarta lucene查询必须包含jakarta,而lucene可以出现可不出现</td>
</tr>
<tr>
<td><code>-</code></td>
<td style="text-align:left">不能包含运算符后面的查询词 “jakarta apache” -“Apache Lucene”</td>
</tr>
<tr>
<td><code>[]</code></td>
<td style="text-align:left">包含范围边界</td>
</tr>
<tr>
<td><code>{}</code></td>
<td style="text-align:left">不包含范围边界</td>
</tr>
</tbody>
</table>
<h3 id="模糊-编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）"><a href="#模糊-编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）" class="headerlink" title="模糊/编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）"></a>模糊/编辑距离查询（对中文支持好像不太好，我在数字和英文上才测试成功）</h3><p>对于很多搜索应用来说，很重要的功能是不仅仅需要精确匹配用户的文本内容。而且还允许一些灵活的变化，比如一些用户的拼写错误或相同单词的其它变体。Solr 通过基于 Damerau-Levenshtein 距离的编辑距离测量来支持这个功能，它将容忍 80% 以上的拼写错误。</p>
<h5 id="Solr-提供的模糊编辑距离查询需要用到波浪符号（-）："><a href="#Solr-提供的模糊编辑距离查询需要用到波浪符号（-）：" class="headerlink" title="Solr 提供的模糊编辑距离查询需要用到波浪符号（~）："></a>Solr 提供的模糊编辑距离查询需要用到波浪符号（~）：</h5><p>查询语句： administrator~ 匹配： adminstrator， administrater， administratior，等<br>这个查询不仅匹配原始的关键字（administrator），还有其它与原始关键字有 2 个编辑距离的关键字。一个编辑距离表示增加，删除，取代或交换一个任意字符。关键字 adminstrator （在第六个字母出少了字符“i”）和原始关键字之间相差一个编辑距离，因为它删除了一个字符。同样 sadministrator 和原始关键字之间也是相差一个编辑距离，因为它在前面添加了一个字符。administratro 也与原始关键字有一个编辑距离，因为它将最后两个字符交换了顺序。</p>
<h5 id="在编辑距离查询中也可以精确指定编辑距离："><a href="#在编辑距离查询中也可以精确指定编辑距离：" class="headerlink" title="在编辑距离查询中也可以精确指定编辑距离："></a>在编辑距离查询中也可以精确指定编辑距离：</h5><p>查询语句：administrator~1 匹配一个编辑距离以内的内容。<br>查询语句：administrator~2 匹配两个编辑距离以内的内容（如果没有提供编辑距离的话，这个就是默认值）。<br>查询语句：administrator~N 匹配 N 个编辑距离以内的内容。<br>注意，任何编辑距离大于 2 的查询将会使查询速度变得很慢。如果编辑距离在 2 以内，那么将会使用很高效率的 Levenshtein 自动机（Levenshtein automaton），但是如果编辑距离大于 2，将会退回到更慢的编辑距离实现。</p>
<h3 id="临近查询"><a href="#临近查询" class="headerlink" title="临近查询"></a>临近查询</h3><p>在前面，我们看到了编辑距离查询是如何查找相似的关键字，而不是进行精确匹配。编辑距离的概念适用于关键字中字符的变换或短语中各个单词之间的变化。</p>
<p>如果你想要通过 Solr 的索引查询公司中所有员工的档案。一种方法是枚举出公司中所有可能的职位：</p>
<p>查询语句：”chief executive officer” OR “chief financial officer” OR “chief marketing officer” OR “chief technology officer” OR …</p>
<p>当然，这种查询的前提是你需要知道公司中所有可能的职位，这当然不现实。另外的一种解决方案是单独搜索每个关键字：</p>
<p>查询语句： chief AND officer<br>这将会匹配所有可能的用例，但是同时也会匹配所有包含了这两个关键字的文档。例如：One chief concern arising from the incident was the safety of the police officer on duty。这个文档明显不符合我们的要求，但是如果使用上面的查询语句，那么将会返回这个文档。</p>
<p>Solr 提供了解决这种问题的方案：临近查询。在上面的例子中，比较好的策略是请求 Solr 返回所有包含了关键字 chief 和关键字 officer 临近的文档。这可以通过下面的查询语句样例来实现：</p>
<p>查询语句： “chief officer”~1<br>解释：chief 和 officer 之间最多只能有一个距离<br>例子：”chief executive officer”, “chief financial officer”</p>
<p>查询语句：”chief officer”~2<br>解释：chief 和 officer 之间最多只能有两个编辑距离<br>例子：”chief business development officer”, “officer chief”</p>
<p>查询语句：”chief officer”~N<br>解释：查询 chief 和 officer 之间有 N 个编辑距离。</p>
<p>事实上，对短语进行精确匹配的查询语句 “chief  development  officer” 很容易改写成  “chief development officer”~0。这两个查询都返回相同的结果，因为在第二个查询语句中，编辑距离设置为 0，所以和精确查询得到的结果是相同的。这两种机制都需要使用到 Solr 中存储的关键字位置（前面的文章介绍过）来计算编辑距离。还有一点需要注意的是，临近查询并不是完全按照编辑距离的定义来进行查询，因为它的查询结果中，所有的关键字都必须存在。而编辑距离查询的定义中，可以对关键字进行删除和修改。</p>
<p>但是其它的编辑距离定义依旧保留，例如增加和换位。顺着这条线，你可能会注意到，你需要设置 2 进行临近查询的时候（”chief officer”~2）才能查询出文本 officer chief。这是因为第一次编辑将 chief 和 officer 修改成相同的位置；第二次编辑将 chief 才能将 chief 编辑到 officer 后面。这也再次说明了临近查询使用的并不是真正的编辑距离（在编辑距离中，位置互换的编辑距离只能算 1）。</p>
<h3 id="模糊-编辑距离查询-和-临近查询-的区别"><a href="#模糊-编辑距离查询-和-临近查询-的区别" class="headerlink" title="模糊/编辑距离查询 和 临近查询 的区别"></a>模糊/编辑距离查询 和 临近查询 的区别</h3><ol>
<li>模糊/编辑距离查询 是对一个字符串进行查询；</li>
<li>临近查询 是对两个字符串进行查询，并且它们被”包围着</li>
</ol>
<h3 id="Solr文本匹配不同字段的相关度权重设置需要做如下设置："><a href="#Solr文本匹配不同字段的相关度权重设置需要做如下设置：" class="headerlink" title="Solr文本匹配不同字段的相关度权重设置需要做如下设置："></a>Solr文本匹配不同字段的相关度权重设置需要做如下设置：</h3><p>1）启用edismax选项，在检索url上添加defType=edismax参数<br>2）设置q参数为搜索关键词，这里不要再写搜索表达式了<br>3）设置qf参数，指定不同字段的权重，例如：title^10 keywords^10 content^1 表示title字段的权重设置为10，keywords为10，content权重设置为1 </p>
<hr>
<h3 id="solr删除数据的快捷方式"><a href="#solr删除数据的快捷方式" class="headerlink" title="solr删除数据的快捷方式"></a>solr删除数据的快捷方式</h3><p>在solr的WEB客户端，访问你的索引库<br>1)documents type 选择 XML<br>2)documents 输入下面语句<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span>&gt;</span><span class="tag">&lt;<span class="name">query</span>&gt;</span>*:*<span class="tag">&lt;/<span class="name">query</span>&gt;</span><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">commit</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>点击<code>Submit Document</code>即可</p>
<h3 id="filter-query-的使用"><a href="#filter-query-的使用" class="headerlink" title="filter query 的使用"></a>filter query 的使用</h3><p>如果要查询的结果中必须包含某些字段，则可以加上<code>{fieldName}:{queryExpress}</code>，<br>例如<code>email:*</code>将获取结果中包含email字段的所有记录<br>如果不想包含某些字段则可以这样<code>-email:*</code>，在其前面加一个减号</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/hewentian/2017/10/29/solr-note/" data-id="cjoo8xatb002zu23km66ex2wk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/solr/">solr</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/db/">db</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a><span class="category-list-count">7</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a><span class="archive-list-count">4</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/11/12/kafka-intro/">kafka 介绍</a>
          </li>
        
          <li>
            <a href="/2018/10/27/kafka-cluster/">kafka 集群的搭建</a>
          </li>
        
          <li>
            <a href="/2018/10/24/kafka-standalone/">kafka 单节点安装</a>
          </li>
        
          <li>
            <a href="/2018/10/05/jenkins-install/">jenkins 学习笔记</a>
          </li>
        
          <li>
            <a href="/2018/10/02/ELK-install/">ELK 日志系统的搭建</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">link</h3>
    <div class="widget">
      <li><a href="https://github.com/hewentian" title="Tim Ho's Blog">我的github</a></li>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Tim Ho<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives/" class="mobile-nav-link">Archives</a>
  
    <a href="/categories/" class="mobile-nav-link">Categories</a>
  
    <a href="/tags/" class="mobile-nav-link">Tags</a>
  
    <a href="/about/" class="mobile-nav-link">About</a>
  
</nav>
    

<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<script src="//code.jquery.com/jquery-2.2.4.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>